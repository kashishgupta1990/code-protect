Options +FollowSymLinks
RewriteEngine On

# disallow all website cloning crawlers
RewriteCond %{HTTP_USER_AGENT} (httrack|GermCrawler|squider|mbot) [NC]
RewriteRule .* - [G]

# only images should be allowed for AWS crawler
RewriteCond %{HTTP_USER_AGENT} Amazon.CloudFront
RewriteRule ^robots\.txt$ robots-cdn.txt [L]

# 301 redirect proptiger.com to www.proptiger.com
RewriteCond %{HTTP_HOST} ^proptiger.com
RewriteRule ^(.*)$ https://www.proptiger.com/$1 [NE,R=301,L,QSA]

# for non production servers disallow all
RewriteCond %{HTTP_HOST} !www\.proptiger\.([a-z\.]+)$
RewriteRule ^robots.txt /robots_static.txt [L]

# 301 redirect to https protocol
RewriteCond %{HTTPS} off
RewriteRule !^(lead|wishListHandler|who-am-i|forum/userLogin|forum/checkuser|forum/register|forum/forgotpass)\.php$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 301 redirect IP to DNS name
RewriteCond %{HTTP_HOST} ^54\.255\.197\.4 [OR]
RewriteCond %{HTTP_HOST} ^54\.179\.139\.15
RewriteRule (.*) https://www.proptiger.com/$1 [NE,R=301,L,QSA]

# 301 redirect of budget URL 
RewriteRule ^(.*)\/(.*)*-[\d]*-(lacs|crores)(.*)$ $1$5 [R=301,L,QSA]

# 301 redirect of city amenities to city listing page
RewriteRule ^(.*)([\w]*+)-real-estate/(schools|atms|banks|petrol-pumps|hospitals|restaurants) $1-real-estate [R=301,L]

# 301 redirect of SUBURB amenities
RewriteRule ^(.*)([\w]*+)\/([\w\-]+-1\d{4,4})/(schools|atms|banks|petrol-pumps|hospitals|restaurants) $1/property-sale-$2-1$3 [R=301,L]

# 301 redirect of locality amenities pages
RewriteRule ^(.*)([\w]*+)-real-estate/([\w\-]+-\d{5,5}/)(schools|atms|banks|petrol-pumps|hospitals|restaurants) $1/$3$4 [R=301,L]

# 301 redirect of grand diwali mela
RewriteRule ^(.*)grand-diwali-mela(.*)$ /mega-property-sale$2 [R=301,L]
RewriteRule ^google_gosf(.*)$ /mega-property-sale$1 [R=301,L]

# redirect sitemap.php to homepage
RewriteRule ^sitemap.php / [NE,R=301,L,QSA]

# redirect all sitemap url to corresponding city overview page
RewriteRule ^([\-\w]+)-real-estate/\1-sitemap\.php$ $1-real-estate [NE,R=301,L,QSA]
RewriteRule ^residential-apartments-flats-([\w\-]+)\.php$ $1-real-estate [NE,R=301,L,QSA]

# redirect rule to server php page
RewriteRule ^real-estate-india$ /real-estate-india.php [L,QSA]

# need this redirect to reduce google errors, can remove it after some time
RewriteRule ^careers.php$ careers [R=301,L]
RewriteRule ^app_launch.php$ mobile-apps [R=301,L]
RewriteRule ^my-accounts.php$ portfolio/my-account [R=301,L]
RewriteRule ^forgotpass.php$ reset-password [R=301,L,QSA]
RewriteRule ^([\w]+)-real-estate/localities$ $1/all-localities [R=301,L]
RewriteRule ^resale-property-in-(.*).php$ $1/resale-property [NE,R=301,L,QSA]
RewriteRule ^property-portfolio-tracker.php$ property-portfolio-tracker [R=301,L]

RewriteRule ^properties-in-(.*).php$ google_page_9.php?newLaunch=$1 [QSA]
RewriteRule ^google_page\.php$ /google_page_4.php [QSA,R=301]
RewriteRule ^google_page_[123567]\.php$ /google_page_4.php [QSA]

# temporary 302 redirect
RewriteRule ^mumbai/ville-parle-east/kolte-patil-jay-vijay-655908 mumbai/property-sale-ville-parle-east-50333 [R=302,L,QSA]

# for mobile google page 10 for mobile from desktop site
RewriteCond %{HTTP_USER_AGENT} (android|blackberry|googlebot-mobile|iemobile|iphone|ipod|opera\ mobile|palmos|webos|Android) [NC]
RewriteRule ^flats-apartments-property-offers.php$ http://mob.proptiger.com/google_page_13.php$1 [QSA,P,L]

RewriteRule ^flats-apartments-property-offers.php$ google_page_10.php$1 [L,QSA]

# for mobile google page 21 for mobile from desktop site
RewriteCond %{HTTP_USER_AGENT} (android|blackberry|googlebot-mobile|iemobile|iphone|ipod|opera\ mobile|palmos|webos|Android) [NC]
RewriteRule ^property-projects-flats.php$ http://mob.proptiger.com/google_page_13.php$1 [QSA,P,L]

RewriteRule ^property-projects-flats.php$ google_page_21.php$1 [L,QSA]

# for mobile serve escape_fragment pages of desktop site
RewriteCond %{HTTP_USER_AGENT} !(android|blackberry|googlebot-mobile|iemobile|iphone|ipod|opera\ mobile|palmos|webos|Android) [NC]
RewriteRule .* - [S=2] 
RewriteRule ^(.*?)$_escaped_fragment_=(.*)$ http://www.proptiger.com/$1$2 [L,NC,R]
RewriteRule ^google_page_4.php(.*) http://mob.proptiger.com/google_page_4.php$1 [P,L]

# serve these mobile pages on desktop
RewriteRule ^mega-property-sale(.*)$ http://mob.proptiger.com/mega-property-sale$1 [P,L]
RewriteRule ^google_gosf(.*)$ http://mob.proptiger.com/google_gosf$1 [P,L]
RewriteRule ^transaction(.*)$ http://mob.proptiger.com/transaction$1 [P,L]
RewriteRule ^xhr/mega-property-sale(.*)$ http://mob.proptiger.com/xhr/mega-property-sale$1 [P,L]
RewriteRule ^xhr/google_gosf(.*)$ http://mob.proptiger.com/xhr/google_gosf$1 [P,L]
RewriteRule ^xhr/transaction(.*)$ http://mob.proptiger.com/xhr/transaction$1 [P,L]
RewriteRule ^responsive(.*)$ http://mob.proptiger.com/responsive$1 [P,L]
RewriteRule ^(city|locality|builder|project|listing)/(.*)$ http://mob.proptiger.com/$1/$2 [P,L]

# serve following url to desktop from mobile
RewriteCond %{REQUEST_URI}  ^/gallery [NC,OR]
RewriteCond %{REQUEST_URI}  ^/buzz [NC,OR]
RewriteCond %{REQUEST_URI}  ^/.*(careers|culture|aboutus|nepal-earthquake-relief-fund|reset-password-submit|reset-password|schools|atms|petrol-pumps|banks|restaurants|hospitals|all-builders|all-cities|all-localities|all-suburbs|user-dashboard)$ [NC,OR]
RewriteCond %{REQUEST_URI}  ^/.*(google_page_12|google_page_13|google_page_14|google_page_15)\.php$
RewriteRule ^(.*)$ http://mob.proptiger.com/$1  [P,L]

# compare locality URL
RewriteCond %{REQUEST_URI}  ^/compare [NC]
#RewriteCond %{REQUEST_URI} (.*)-([5-9]\d{4})$
RewriteRule ^(.*)$ http://mob.proptiger.com/$1 [P,L]

# serve following pages to mobile from desktop
RewriteCond %{HTTP_USER_AGENT} (android|blackberry|googlebot-mobile|iemobile|iphone|ipod|opera\ mobile|palmos|webos|Android) [NC]
RewriteCond %{REQUEST_URI}  !^/.*((sitemap-details|builders-in|lead|localities_in_city|wishListHandler|who-am-i|userLogin|checkuser|register|forgotpass|User_Login_Form|logout)\.php|robots.txt|xml|xml.gz|sitemap|localities|emi|homeloan|documents|faqs|vaastu|nri|builderpartner|management-team|ourservices|proptiger-media|property-insight)$
RewriteCond %{REQUEST_URI} !(\.html|\.php|\.css|\.json|\.woff|\.woff2|\.ttf)$
RewriteCond %{QUERY_STRING} !^force=desktop
RewriteCond %{HTTP_HOST} !^(.*)datalabs.proptiger(.*).com
RewriteRule ^(.*)$ http://mob.proptiger.com/$1  [P,L]

# serve all escape fragment pages from seo machine
RewriteCond %{QUERY_STRING} _escaped_fragment_=
RewriteRule ^(.*)$ http://seo.proptiger.com/fetch/$1? [QSA,P,L]

# take all request to index page, from there angular will bootstraps
RewriteRule ^$ /index.php [L]

# serve all social media bots pages from seo machine
RewriteCond %{HTTP_USER_AGENT} (facebookexternalhit/[0-9]|Twitterbot|Pinterest|Google.*snippet) [NC]
RewriteRule ^(.*)$ http://seo.proptiger.com/fetch/$1? [QSA,P,L]

# serve all search bots other then googlebot pages from seo machine
RewriteCond %{HTTP_USER_AGENT} (Slurp|Baiduspider|msnbot|bingbot) [NC]
RewriteRule ^(.*)$ http://seo.proptiger.com/fetch/$1? [QSA,P,L]

RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-s
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !/styles
RewriteCond %{REQUEST_URI} !/index.php
RewriteRule ^(.*) index.php [L,QSA]

<Files  ~ "\.less$">
  Order allow,deny
  Deny from all
</Files>

# compress text, html, javascript, css, xml:
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript

<FilesMatch "\.(eot|font.css|otf|ttc|ttf|woff)$">
  Header set Access-Control-Allow-Origin "*"
</FilesMatch>
