define("text!views/directives/b2b/dashboard/key-data-grid.html",[],function(){return'<div class="kd-cntnr" id="accordion2">\n\n    <div class="pt_row kd-head">\n    	<div class="kd-title pt_col-1-{{tableColomns}}" >Key Data</div>\n        <div data-ng-repeat="mo in data.sortedIntervals" class="pt_col-1-{{tableColomns}}">\n        <div class="time-col-name">{{ data[durationType][mo].toString() }}</div>\n        </div>\n        <div class="pt_col-1-{{tableColomns}} pull-right">\n            <div data-ga-category="Dashboard" pt-interval data-ga-title = "Key Data" duration-changed="periodChanged(data)" duration="intervalDefault" constant="yearConstant"></div>\n        </div>\n    </div>\n    <div class="kd-group" data-ng-repeat="opt in options">\n        <div class="hdng" once-text="opt.text"></div>\n        <div class="pt_row kd-set" >\n            <div pt-loading-block class="keyloading key-data-grid-keyloading" icon-styling-class="loading-icon-size">loading..</div>\n            <div class="pt_col-{{tableColomns-1}}-{{tableColomns}}" data-ng-if="!opt._display">\n                <div class="kd-city-set" data-ng-repeat="(id, obj) in data.data">\n                    <div class="pt_row">\n                    	<div class="kd-city-title pt_col-1-{{tableColomns-1}}">\n                        	<span  data-ng-if="cityCount>1" once-text="data.city[id]"></span>\n                        	<span  data-ng-if="cityCount==1" once-text="data.city[id]"></span>\n                        </div>\n                        <div class="pt_col-1-{{tableColomns-1}}" data-ng-repeat="mo in data.sortedIntervals">\n                            <div class="time-col-data"\n                                 data-ng-click="displayTopProjects(opt, mo, id)">\n                                <a analytics-on\n                                   data-analytics-event="Click_{{opt.title}}"\n                                   data-analytics-category="Dashboard"\n                                   data-analytics-label=""\n                                   href="javascript:void(0);"  data-ng-class="opt.key !== \'inventoryOverhang\' ? [\'link\'] : [\'no-link\']">{{ obj[mo][opt.key] | round | number_in:\'0\' }}</a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="pt_col-1-{{tableColomns}}">\n                <div class="btn-accordion-wrap pull-right marginR10 marginB10 toggle-graph">\n                    <button class="btn btn-lg" data-ng-click="toggleGraph(opt); opt._display=!opt._display;"><i data-ng-class="(opt._display)?[\'pt pt-icon-list-alt\']:[\'pt pt-icon-bar-chart-o\']"></i></button>\n                </div>\n            </div>\n            <div class="kd-graph-cntnr margin10" data-ng-if="opt._display">\n                <div pt-widgetchart widget-data="trend[opt.key]"></div>\n            </div>\n        </div>\n        <div class="pt_row kd-set" data-ng-if="opt._display || opt._dataClicked">\n             <div class="kd-graph-cntnr margin10">\n                <div pt-loading-block data-ng-if="!projectData[detail.userType][durationType][opt.key][keyDateState[opt.key].idStr][keyDateState[opt.key].startDate].top && opt.key !== \'inventoryOverhang\'"></div>\n                <div class="time-summry-wrap" data-ng-if="projectData[detail.userType][durationType][opt.key][keyDateState[opt.key].idStr][keyDateState[opt.key].startDate].top && topProjectCheck(opt.key,projectData[detail.userType][durationType][opt.key][keyDateState[opt.key].idStr][keyDateState[opt.key].startDate].top)">\n                    <h4>\n\n                        <span class="">Top Projects in {{data.city[specificId]}} by {{ opt.title }} in <span class="highlight">{{ keyDateState[opt.key].toString() }}</span></span>\n                        <a class="sub-link" href="javascript:void(0);"\n                           analytics-on\n                           data-analytics-event="{{opt.title}}_View all projects_Open"\n                           data-analytics-category="Dashboard"\n                           data-analytics-label=""\n                           data-ng-click="viewAllProjectsModal(opt, projectData[detail.userType][durationType][opt.key][keyDateState[opt.key].idStr][keyDateState[opt.key].startDate],keyDateState[opt.key].dateEpoch,specificId,data.city[specificId],keyDateState[opt.key].toString())"\n                           title="View all Projects">View all Projects</a>\n\n                    </h4>\n                    <div class="pt_row pt_row_pad10rt0 row-head">\n                        <div class="pt_col-2-10">Project Name</div>\n                        <div class="pt_col-1-10">&nbsp;</div>\n                        <div class="pt_col-1-10">Locality</div>\n                        <div class="pt_col-2-10">Status</div>\n                        <div data-ng-show="enableTypeField" class="pt_col-1-10">Type</div>\n                        <div class="pt_col-1-10">Rate(<i class="pt  pt-icon-inr"></i>/sq ft)</div>\n                        <div class="pt_col-1-10">Total Sold(%)</div>\n                        <div class="pt_col-1-10">{{ opt.title }}</div>\n                    </div>\n                    <div class="pt_row pt_row_pad10rt0 row-body"\n                         data-ng-repeat="project in projectData[detail.userType][durationType][opt.key][keyDateState[opt.key].idStr][keyDateState[opt.key].startDate].top"\n                         data-ng-if="project.extraAttributes[opt.key]">\n                        <div class="pt_col-2-10 textWrap" tooltip="{{ project.projectFullName }}">\n                            <a analytics-on\n                               data-analytics-event="Click_{{opt.title}}_Top 5 Projects"\n                               data-analytics-category="Dashboard"\n                               data-analytics-label="Project Id: {{project.projectId}}, Project Rank: {{($index+1)}}, Project Name: {{project.projectName}}"\n                               data-ng-href="/phase-detail?projectId={{project.projectId}}"\n                               target="_blank">{{ project.projectFullName}}</a>\n                        </div>\n                        <div class="pt_col-1-10 textWrap">\n                            <i class="pt-icon-info-circle" ng-hide="project.clicked"  data-ng-click="getBuilderInfoFromId(project, opt.title, $index)" tooltip="click for contact info"></i>\n                            <i ng-show="project.clicked" tooltip="{{ project.builderAddress }}" class="pt-icon-info-circle" ></i>\n                        </div>\n                        <div class="pt_col-1-10 textWrap" tooltip="{{ project.localityName || \'NA\' }}">{{ project.localityName || \'NA\' }}</div>\n                        <div class="pt_col-2-10 textWrap" tooltip="{{ project.constructionStatus || \'NA\' }}">{{ project.constructionStatus || \'NA\' }}</div>\n                        <div data-ng-show="project.extraAttributes.groupConcatDistinctUnitType && project.extraAttributes.groupConcatDistinctUnitType.length > 0" class="pt_col-1-10">\n                            <i data-ng-repeat="icn in project.extraAttributes.groupConcatDistinctUnitType" class="pt-icon-{{icn | lowercase }}" tooltip="{{icn}}"></i>\n                        </div>\n                        <div data-ng-show="project.extraAttributes.groupConcatDistinctUnitType &&\n                        project.extraAttributes.groupConcatDistinctUnitType.length === 0" class="pt_col-1-10">&nbsp</div>\n                        <div class="pt_col-1-10" tooltip="{{ project.wavgPricePerUnitAreaOnLtdSupplyHover | round | figureFMT}}">{{ project.extraAttributes.wavgPricePerUnitAreaOnLtdSupply | round | figureFMT}}</div>\n                        <div class="pt_col-1-10" tooltip="{{ project.soldPercentageHover }}">{{ project.soldPercentage }}</div>\n                        <div class="pt_col-1-10">{{ project.extraAttributes[opt.key] | round | number_in:\'0\' }}</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("services/b2b/dataService",["app"],function(a){a.config(["$httpProvider",function(a){delete a.defaults.headers.common["X-Requested-With"]}]).factory("DataService",["GlobalService","$http","GetHttpService","$q",function(a,b,c,d){"use strict";var e=function(d,e,f,g){return g||(g=!1),b({method:"GET",cache:g,url:a.getAPIURL(d+e)}).success(function(a){var b=!1;c.commonResponseData(a,"",b),f&&a.statusCode&&"2"===a.statusCode.substring(0,1)&&f(a,200)}).error(function(a){!f||!a||a.statusCode&&"5"!==a.statusCode.substring(0,1)||f(void 0,500)})},f=function(a,b){var c="data/v1/price-trend/hitherto?filters=";return e(c,a,b)},g=function(a,b,c){var d="data/v1/trend/hitherto?filters=";return e(d,a,b,c)},h=function(a,b){var c="data/v1/trend-list?filters=";return e(c,a,b)},i=function(a,b){var c="data/v1/trend-list/hitherto?filters=";return e(c,a,b)},j=function(a,b){var c="data/v1/trend/current?filters=";return e(c,a,b)},k=function(a,b){var c="data/v1/entity/project?selector=";return e(c,a,b)};return{trendList:h,trendHitherto:g,trendListHitherto:i,priceTrendHitherto:f,trendCurrent:j,getPropertyUnitTypesByProjectIds:k}}])}),define("parsers/priceTrend",["app"],function(a){a.factory("PriceTrendParser",["$filter",function(a){var b=a("priceFormat"),c=(a("dateFormat"),a("dateFormatForGraphs")),d=a("sortBy");return{priceTrendData:function(a,e,f,g){var h,i,j,k,l,m,n,o,p,q='<i class="pt pt-icon-inr"></i>',r={locality:{},data:[]};r[e]={};for(h in a.data){j=a.data[h],o={};for(m in j){for(i=j[m],l=0,k=i.length;k>l;l++){switch(r.locality[h]=i[l].localityName,n=i[l].extraAttributes,e){case"month":p="MMM `yy";break;case"year":case"financialYear":p={frequency:"year",yearType:g};break;case"quarter":p={frequency:"quarter",yearType:g}}r[e][m]=c(m,p)}n.price=b(n.wavgPricePerUnitAreaOnLtdSupply,void 0,void 0,void 0,-1),n.resale=b(n.wavgSecondaryPricePerUnitAreaOnLtdSupply,void 0,void 0,void 0,-1),"NA"!==n.price&&(n.price=q+n.price),"NA"!==n.resale&&(n.resale=q+n.resale),o[m]=n}r.data.push({id:h,sale:o})}return r.sortedIntervals=j=d(Object.keys(r[e]),-1),k=j.length,f?(r.data=_.sortBy(r.data,function(a){if("priceAppreciation"===f[0]){var b=a.sale[j[0]]?a.sale[j[0]].wavgPricePerUnitAreaOnLtdSupply:void 0,c=a.sale[j[k-1]]?a.sale[j[k-1]].wavgPricePerUnitAreaOnLtdSupply:void 0;return b&&c?-((c-b)/b):9999}if("sumInventory"===f[0])return-a.sale[j[k-1]].sumInventory;for(var d=0,e=0;e<j.length;e++)a.sale[j[e]]&&(d+=a.sale[j[e]][f]);return-d}),r):r},keyData:function(a,b,e){var f,g,h,i,j,k,l,m,n={city:{},data:[]};n[b]={};for(f in a.data){h=a.data[f];for(k in h){for(g=h[k],j=0,i=g.length;i>j;j++){switch(n.city[f]=g[j].cityName,l=g[j].extraAttributes,b){case"month":m="MMM `yy";break;case"year":case"financialYear":m={frequency:"year",yearType:e};break;case"quarter":m={frequency:"quarter",yearType:e}}n[b][k]={epoch:k,toString:function(){return c(this.epoch,m)}}}h[k]={sumUnitsSold:l.sumUnitsSold?l.sumUnitsSold:"NA",sumLaunchedUnit:l.sumLaunchedUnit?l.sumLaunchedUnit:"NA",sumInventory:l.sumInventory?l.sumInventory:"NA",sumUnitsDelivered:l.sumUnitsDelivered?l.sumUnitsDelivered:"NA",wavgInventoryOverhangOnInventory:l.wavgInventoryOverhangOnInventory?l.wavgInventoryOverhangOnInventory:"NA",inventoryOverhang:l.sumInventory&&l.sumRateOfSale?l.sumInventory/l.sumRateOfSale:"NA",areaLaunched:l.wavgSizeOnLaunchedUnit*l.sumLaunchedUnit||"NA",areaSold:l.wavgSizeOnUnitsSold*l.sumUnitsSold||"NA",areaUnsold:l.wavgSizeOnInventory*l.sumInventory||"NA",areaDelivered:l.wavgSizeOnUnitsDelivered*l.sumUnitsDelivered||"NA",wavgSizeOnLaunchedUnit:l.wavgSizeOnLaunchedUnit?l.wavgSizeOnLaunchedUnit:"NA",wavgSizeOnUnitsSold:l.wavgSizeOnUnitsSold?l.wavgSizeOnUnitsSold:"NA",wavgSizeOnInventory:l.wavgSizeOnInventory?l.wavgSizeOnInventory:"NA",wavgSizeOnUnitsDelivered:l.wavgSizeOnUnitsDelivered?l.wavgSizeOnUnitsDelivered:"NA"}}}return n.sortedIntervals=h=d(Object.keys(n[b]),-1),i=h.length,n.data=a.data,n}}}])}),define("configs/widgetConfig",["app"],function(a){a.factory("WidgetConfig",[function(){return{B2BDashBoard:{PriceTrend:{name:"Price Trend",title:{text:"Price Trend"},tag:"",type:"graph",widgetData:{displayInfo:{title:{text:"Graph / Chart"},chart:{type:"spline",backgroundColor:"#e7efef",borderRadius:0},subtype:"line",tooltip:{crosshairs:!0,pointFormat:'<span style="color:{series.color}">{series.name}</span>: ₹{point.y}<br/>'},xAxis:{categories:[],tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{gridLineWidth:0,title:{text:"Price (Rs per sq ft)"},labels:{format:"{value}",formatter:function(){return"₹"+Highcharts.numberFormat(this.value,0,"",",")}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Print",onclick:function(){this.print()}},{text:"Save as PNG",onclick:function(){this.exportChart({type:"image/png"})},separator:!1}]}}},plotOptions:{line:{events:{legendItemClick:function(){return!0}}}},seriesMeta:{name:[],data:"price"},series:[],noData:{style:{fontWeight:"bold",fontSize:"18px",fontFamily:"Lato Bold",color:"#6b727a"}},lang:{noData:"No matching projects found to plot in the graph"}},entities:["price","effectiveDate"]}},KeyData:{name:"Key Data",title:{text:"Key Data"},tag:"",type:"column",widgetData:{displayInfo:{title:{text:"Graph / Chart"},chart:{backgroundColor:"#e7efef",borderRadius:0},subtype:"column",xAxis:{categories:[],tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{gridLineWidth:0,title:{text:""},labels:{format:"{value}",formatter:function(){return Highcharts.numberFormat(this.value,0,"",",")}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Print",onclick:function(){this.print()}},{text:"Save as PNG",onclick:function(){this.exportChart({type:"image/png"})},separator:!1}]}}},plotOptions:{line:{events:{legendItemClick:function(){return!0}}}},seriesMeta:{name:[],data:"price"},series:[],noData:{style:{fontWeight:"bold",fontSize:"18px",fontFamily:"Lato Bold",color:"#6b727a"}},lang:{noData:"No matching projects found to plot in the graph"}},entities:["price","effectiveDate"]}}},GraphAnalysis:{chart:{backgroundColor:"transparent"},xAxis:{},yAxis:{title:{text:null},allowDecimals:!1,gridLineWidth:0,minorGridLineWidth:0,labels:{format:"{value}",formatter:function(){return Highcharts.numberFormat(this.value,0,"",",")}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Print",onclick:function(){this.print()}},{text:"Save as PNG",onclick:function(){this.exportChart({type:"image/png"})},separator:!1}]}}},credits:!1,noData:{style:{fontWeight:"bold",fontSize:"18px",fontFamily:"Lato Bold",color:"#6b727a"}},lang:{noData:"No matching projects found to plot in the graph"}}}}])}),define("directives/base/pt-chart",["app"],function(a){a.directive("ptChart",["$timeout",function(a){return{restrict:"A",template:"<div></div>",scope:{chartOptions:"=chartConfig",size:"=chartSize"},link:function(b,c,d){function e(b){if(b){var c=!0,d={};$.extend(c,d,g,b),f&&f.destroy(),require(["highcharts","highchartsMore"],function(){f=new Highcharts.Chart(d),a(function(){h()})})}}var f,g;g={chart:{renderTo:c[0],height:b.size&&!isNaN(b.size.height)?b.size.height:null,width:b.size&&!isNaN(b.size.width)?b.size.width:null}};var h=function(a){a?f&&f.setSize(a.width,a.height,!0):$(window).resize()};b.$on("$destroy",function(){f&&f.destroy()}),b.$watch("chartOptions",e,!0),b.$watch("size",h,!0)}}}])}),define("configs/chartConfig",["app"],function(a){a.factory("ChartConfig",[function(){return{"default":{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],chart:{backgroundColor:"none",type:"line",reflow:!0},credits:{enabled:!1},series:{negativeColor:"#df2034"},yAxis:[{title:{style:{color:"#848484",fontSize:"11"}}},{title:{style:{color:"#848484",fontSize:"11"}},opposite:!0}],legend:{layout:"horizontal",align:"left",verticalAlign:"bottom",borderWidth:"0"}},bar:{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],yAxis:{title:{style:{color:"#505050",fontFamily:"arial",fontSize:12,fontWeight:"bold"}}},xAxis:{title:{style:{color:"#505050",fontFamily:"arial",fontSize:12,fontWeight:"bold"}}},title:{style:{fontFamily:"arial",fontSize:16,fontWeight:"normal",color:"#505050"},margin:30},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:"0",itemStyle:{color:"#505050",fontSize:"11"}},credits:{enabled:!1}},"bar-line":{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],chart:{reflow:!0},yAxis:{title:{style:{color:"#848484"}}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:"0",itemStyle:{color:"#505050",fontSize:"11"}},credits:{enabled:!1},series:[{type:"column"},{type:"spline"},{negativeColor:"#df2034"}]},column:{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],chart:{type:"column",reflow:!0},credits:{enabled:!1},series:{negativeColor:"#df2034"},yAxis:{title:{style:{color:"#505050",fontFamily:"arial",fontSize:12,fontWeight:"bold"}}},title:{style:{fontFamily:"arial",fontSize:16,fontWeight:"normal",color:"#505050"},margin:30},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:"0",itemStyle:{color:"#505050",fontSize:"11"}}},"column-stacked":{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],chart:{type:"column",reflow:!0},credits:{enabled:!1},title:{style:{fontFamily:"arial",fontSize:16,fontWeight:"normal",color:"#505050"},margin:30},yAxis:{title:{style:{color:"#848484"}}},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1,color:"white"},events:{legendItemClick:function(){return!1}}}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:"0",itemStyle:{color:"#505050",fontSize:"11"}}},area:{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],chart:{type:"area",reflow:!0},credits:{enabled:!1},series:{negativeColor:"#df2034"},yAxis:{title:{style:{color:"#505050",fontFamily:"arial",fontSize:12,fontWeight:"bold"}}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:"0",itemStyle:{color:"#505050",fontSize:"11"}}},line:{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],chart:{type:"line",reflow:!0},credits:{enabled:!1},title:{style:{fontFamily:"arial",fontSize:16,fontWeight:"normal",color:"#505050"},margin:30},series:{negativeColor:"#df2034"},yAxis:{title:{style:{color:"#505050",fontFamily:"arial",fontSize:12,fontWeight:"bold"}}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:"0",itemStyle:{color:"#505050",fontSize:"11"}}},pie:{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,reflow:!0},title:{style:{fontFamily:"arial",fontSize:16,fontWeight:"normal",color:"#505050"},margin:30},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,slicedOffset:5,cursor:"pointer",dataLabels:{enabled:!0,distance:15,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} Lacs"}}}},funnel:{chart:{type:"funnel",reflow:!0},plotOptions:{series:{dataLabels:{enabled:!0,format:"<b>{point.name}</b> ({point.y:,.0f})",color:"black",softConnector:!0},neckWidth:"25%",neckHeight:"25%"}}},scatter:{chart:{type:"scatter",animation:!1},credits:{enabled:!1},plotOptions:{series:{dataLabels:{}},scatter:{marker:{radius:5}}}},waterfall:{colors:["#0095b8","#f39c10","#983366","#00b763","#0095de","#00c39f","#f6c700","#007ebc","#e54400","#9e21ad","#7c8d8e"],chart:{type:"waterfall",reflow:!0},credits:{enabled:!1},series:{negativeColor:"#df2034"},yAxis:{title:{style:{color:"#505050",fontFamily:"arial",fontSize:12,fontWeight:"bold"}}},title:{style:{fontFamily:"arial",fontSize:16,fontWeight:"normal",color:"#505050"},margin:30},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:"0",itemStyle:{color:"#505050",fontSize:"11"}}}}}])}),define("directives/common/pt-widgetChart",["app","directives/base/pt-chart","configs/chartConfig"],function(a){a.directive("ptWidgetchart",[function(){return{restrict:"A",template:'<div pt-chart class="chartStyle" chart-size="size" chart-config=config></div>',scope:{widgetData:"=widgetData",tabChange:"="},controller:["$scope","$element","$attrs","ChartConfig",function(a,b,c,d){a.$watch("widgetData",function(b,c){if(b){var e,f={},g={},h=a.widgetData.widgetData.displayInfo,i="";h&&(i=h.subtype);var j={type:i,reflow:!0};$.extend(!0,f,d[i]),f.chart&&($.extend(!0,f.chart,h.chart),j=f.chart),f.title?$.extend(!0,f.title,h.title):f.title=h.title,f.xAxis?$.extend(!0,f.xAxis,h.xAxis):f.xAxis=h.xAxis,f.plotOptions?$.extend(!0,f.plotOptions,h.plotOptions):f.plotOptions=h.plotOptions,f.exporting?$.extend(!0,f.exporting,h.exporting):f.exporting=h.exporting;var k=h.seriesMeta.name;if(k&&1===k.length)e={yAxis:{title:{text:k[0],style:{color:"#848484",fontSize:"11"}},labels:{formatter:function(){return this.value>=1e7||this.value<=-1e7?this.value/1e7+"Cr":this.value>=1e5||this.value<=-1e5?this.value/1e5+"Lacs":this.value}}},chart:j,tooltip:{formatter:function(){var a;return a=this.y>=1e7||this.y<=-1e7?Math.round(100*this.y/1e7)/100+"Cr":this.y>=1e5||this.y<=-1e5?Math.round(100*this.y/1e5)/100+"Lacs":this.y,this.series.name+": "+a}}};else if(k&&k.length>1){var l=[];angular.forEach(k,function(a,b){var c={title:{text:a,style:{color:"#848484",fontSize:"11"}},opposite:b%2===0?!1:!0,labels:{formatter:function(){return this.value>=1e7||this.value<=-1e7?this.value/1e7+"Cr":this.value>=1e5||this.value<=-1e5?this.value/1e5+"Lacs":this.value}}};l.push(c)}),e={chart:j,yAxis:l,tooltip:{formatter:function(){var a;return a=this.y>=1e7||this.y<=-1e7?Math.round(100*this.y/1e7)/100+"Cr":this.y>=1e5||this.y<=-1e5?Math.round(100*this.y/1e5)/100+"Lacs":this.y,this.series.name+": "+a}}}}f.legend?$.extend(!0,f.legend,h.legend):f.legend=h.legend,f.tooltip?$.extend(!0,f.tooltip,h.tooltip):f.tooltip=h.tooltip,f.yAxis?$.extend(!0,f.yAxis,h.yAxis):f.yAxis=h.yAxis,f.lang?$.extend(!0,f.lang,h.lang):f.lang=h.lang,f.noData?$.extend(!0,f.noData,h.noData):f.noData=h.noData,$.extend(!0,g,f,e),a.config=g,a.$watch("widgetData.widgetData.displayInfo.tooltip",function(b,c){b&&(a.config.tooltip=a.widgetData.widgetData.displayInfo.tooltip)}),a.$watch("widgetData.widgetData.displayInfo.series",function(b,c){b&&b.length&&(a.config.series=a.widgetData.widgetData.displayInfo.series)},!0),a.$watch("widgetData.widgetData.displayInfo.xAxis.categories",function(b,c){b&&(a.config.xAxis.categories=a.widgetData.widgetData.displayInfo.xAxis.categories)}),a.$watch("widgetData.widgetData.displayInfo.yAxis.plotLines",function(b,c){b!==c&&(a.config.yAxis.plotLines=a.widgetData.widgetData.displayInfo.yAxis.plotLines)}),a.$watch("widgetData.widgetData.displayInfo.yAxis.max",function(b,c){b!==c&&(a.config.yAxis.max=a.widgetData.widgetData.displayInfo.yAxis.max)}),a.size={}}})}],link:function(a,b,c){a.size&&(a.size.width=b.find(".chartStyle").parent().width(),a.$on("dashboardResize",function(c,d){window.setTimeout(function(){a.size.width=b.find(".chartStyle").parent().width()},900)}))}}}])}),define("text!views/directives/common/pt-loading-block.html",[],function(){return'<div class="parent-blocking" data-ng-if="!loadingObject">\n    <div class="loader-info">\n    	<div data-ng-transclude ></div>\n    	<i class="pt pt-icon-cog pt-icon-spin {{iconStylingClass}}"></i>\n        <div class="big-loader">\n            <i class="spinLoader"></i>\n        </div>      \n    </div>        \n</div>\n'}),define("directives/common/pt-loading-block",["app","text!views/directives/common/pt-loading-block.html"],function(a,b){a.directive("ptLoadingBlock",[function(){return{restrict:"A",scope:{loadingObject:"=",iconStylingClass:"@"},transclude:!0,template:b,link:function(a,b,c){a.iconStylingClass=a.iconStylingClass||"",a.$on("$destroy",function(){a.loadingObject=void 0,b.remove()})}}}])}),define("text!views/directives/common/pt-interval.html",[],function(){return'<div class="time-controller-wrap">\n    <button id="" class="btn marginT5 btn-block dropdown-toggle" data-toggle="dropdown" title="Click to choose the Time Period">\n        <span class="put-ellipsis">{{duration.period}} {{duration.title}}</span> <i class="pt  pt-icon-caret-down"></i>\n    </button>\n\n    <div class="dropdown-menu dd-list">\n        <ul tabset class="timeControllerTabs">\n            <li tab heading="Monthly" id="Monthly" data-ng-click="$event.stopPropagation();">\n                <ul class="time-options">\n                    <li data-ng-repeat="period in constant.Monthly.period" data-ng-click="updateDuration($event, period, constant.Monthly)">\n						<i data-ng-class="duration.period == period && duration.key == \'month\' ? \'pt  pt-icon-dot-circle-o\' : \'pt  pt-icon-circle-o\'"></i>\n						Last {{period}} {{constant.Monthly.title}}\n					</li>\n                    <!--li><i class="pt  pt-icon-circle-o" ></i>  Custom</li-->\n                </ul>\n            </li>\n\n            <li tab heading="Quarterly" id="Quarterly" data-ng-click="$event.stopPropagation();" data-ng-show="constant.Quarterly">\n                <ul class="time-options">\n                    <li data-ng-repeat="period in constant.Quarterly.period" data-ng-click="updateDuration($event, period, constant.Quarterly)"><i class="pt  pt-icon-circle-o" ></i>  Last {{period}} {{constant.Quarterly.title}}</li>\n                </ul>\n            </li>\n\n            <li tab heading="Annualy" id="Annualy" data-ng-click="$event.stopPropagation();" data-ng-show="constant.Annualy">\n                <ul class="time-options">\n                    <li data-ng-repeat="period in constant.Annualy.period" data-ng-click="updateDuration($event, period, constant.Annualy)"><i class="pt  pt-icon-circle-o" ></i>  Last {{period}} {{constant.Annualy.title}}</li>\n                </ul>\n            </li>\n        </ul>\n\n        <!--div class="pt_row check-graph-change">\n            <div class="pt_col-1-9">\n                <i class="pt  pt-icon-square-o"></i>\n            </div>\n            <div class="pt_col-8-9">\n                Change time period for all graphs\n            </div>\n        </div-->\n    </div>\n</div>\n\n\n\n'}),define("directives/common/pt-interval",["app","text!views/directives/common/pt-interval.html","services/b2b-constants"],function(a,b){a.directive("ptInterval",["B2BConstants","GoogleAnalyticsService",function(a,c){return{restrict:"EA",scope:{durationChanged:"&",duration:"=?",constant:"=?",gaTitle:"@?",gaCategory:"@?"},template:b,link:function(a,b){},controller:["$scope","$element",function(b,d){if(b.constant||(b.constant=a.TIME_INTERVAL.DURATION),!b.duration){var e=a.TIME_INTERVAL.DEFAULT_DURATION;b.duration={title:b.constant[e.type].title,period:b.constant[e.type].period[e.period],key:b.constant[e.type].key}}b.updateDuration=function(a,d,e){c.gaEventSelectTitlePeriod(b.gaTitle,d,e,b.gaCategory),b.duration={period:d,title:e.title,key:e.key},$(a.target).parent().parent().parent().parent().find("i.pt-icon-dot-circle-o").addClass("pt-icon-circle-o").removeClass("pt-icon-dot-circle-o"),$(a.target).find("i").removeClass("pt-icon-circle-o").addClass("pt-icon-dot-circle-o")},b.$watch("duration",function(a,c){if(a){var d={type:a.key};d.months=a.period,b.durationChanged({data:d})}})}]}}])}),define("directives/b2b/dashboard/key-data-grid",["app","text!views/directives/b2b/dashboard/key-data-grid.html","services/b2b-constants","services/b2b/dataService","parsers/priceTrend","configs/widgetConfig","services/globalService","services/builderService","services/projectService","directives/common/pt-widgetChart","directives/common/pt-loading-block","directives/common/pt-interval"],function(a,b){a.directive("keyDataGrid",["$rootScope","B2BConstants","$modal","$filter","DataService","PriceTrendParser","WidgetConfig","$timeout","GlobalService","BuilderService","ProjectService","GoogleAnalyticsService",function(a,c,d,e,f,g,h,i,j,k,l,m){"use strict";return{restrict:"EA",replace:!0,scope:{detail:"=",cityIds:"=",localityIds:"=",detailCities:"="},template:b,controller:["$scope",function(b){function n(c,d,e,g,h,i,k){var l,n,u,v,w=o(i,"yyyy-MM-dd"),x=b.detail.userType,z=b.durationType,C="city"==x?b.cityIds:b.localityIds,D=C.sort(function(a,b){return a-b}).join(",");switch("city"==x&&void 0!==k&&""!==k?(D=C=[k],b.specificId=k):"locality"==x&&void 0!=k&&""!=k&&(C=b.detailCities[k],D=C.sort(function(a,b){return a-b}).join(","),b.specificId=k),z){case"month":v="MMM `yy";break;case"year":case"financialYear":v={frequency:"year",yearType:b.yearType};break;case"quarter":v={frequency:"quarter",yearType:b.yearType}}if(b.keyDateState[d]={dateEpoch:i,idStr:D,startDate:w,toString:function(){return p(this.dateEpoch,v)}},b.projectData[x][z])if(b.projectData[x][z][d])if(b.projectData[x][z][d][D])if(b.projectData[x][z][d][D][w]){if(b.projectData[x][z][d][D][w][h]&&"all"!==h)return}else b.projectData[x][z][d][D][w]={};else b.projectData[x][z][d][D]={},b.projectData[x][z][d][D][w]={};else b.projectData[x][z][d]={},b.projectData[x][z][d][D]={},b.projectData[x][z][d][D][w]={};else b.projectData[x][z]={},b.projectData[x][z][d]={},b.projectData[x][z][d][D]={},b.projectData[x][z][d][D][w]={};u=b.projectData[x][z][d][D][w],n={type:b.detail.userType,ids:C,unitType:a.userDetails.preference.preference.unitType,extraFilters:{},fields:[e,"builderId","phaseName","projectId","phaseType","projectName","builderName","localityName","constructionStatus","sumLtdSupply","sumUnitsSold","wavgPricePerUnitAreaOnLtdSupply","sumInventory","sumLtdLaunchedUnit","sumRateOfSale"],group:["phaseId",z],extras:{sort:"-"+e}},n.extraFilters[z]=w,g&&n.fields.push(g),"top"===h&&(n.extras.start=0,n.extras.rows=5),"all"===h&&(n.extras.start=0,n.extras.rows=20,u[h]&&(n.extras.start=u[h].length)),l=y(n),f.trendList(l,function(i){if(i){var k=i.data,l=A(k),n=[];m.gaEventDisplayTop5(c,i.data),f.getPropertyUnitTypesByProjectIds(B(l),function(c){angular.forEach(k,function(a,f){var h;g&&(a.extraAttributes[d]=a.extraAttributes[e]*a.extraAttributes[g]),a.projectFullName=a.builderName+" "+a.projectName,a.phaseType&&a.phaseName&&"Actual"===a.phaseType&&(a.projectFullName+=" ("+a.phaseName+")"),h=_.find(c.data,function(b){return b.projectId===a.projectId}),a.extraAttributes.groupConcatDistinctUnitType=h&&h.propertyUnitTypes||[],a.extraAttributes.groupConcatDistinctUnitType.length>0&&(b.enableTypeField=!0),a.extraAttributes.sumRateOfSale&&""!==a.extraAttributes.sumRateOfSale&&a.extraAttributes.sumInventory&&""!==a.extraAttributes.sumInventory?a.extraAttributes.inventoryOverhang=a.extraAttributes.sumInventory/a.extraAttributes.sumRateOfSale:a.extraAttributes.inventoryOverhang=null,n.push(a.phaseId)});var f,i,l={type:b.detail.userType,ids:C,unitType:a.userDetails.preference.preference.unitType,phaseId:n,extraFilters:{},fields:["wavgPricePerUnitAreaOnLtdSupply"],group:["phaseId"]},m={type:b.detail.userType,ids:C,unitType:a.userDetails.preference.preference.unitType,phaseId:n,extraFilters:{},fields:["sumLtdLaunchedUnit","sumInventory"],group:["phaseId"]},o="data/v1/price-trend/current?filters="+y(l),p="data/v1/trend/current?filters="+y(m),v=j.makeCompositeCall([o,p]);v.then(function(a){"all"===h&&(u[h]=u[h]||[],u[h]=u[h].concat(k)),"top"===h&&(u[h]=k),$.each(k,function(b,c){a[o].data[c.phaseId]&&(c.extraAttributes.wavgPricePerUnitAreaOnLtdSupply=a[o].data[c.phaseId][0].extraAttributes.wavgPricePerUnitAreaOnLtdSupply),a[p].data[c.phaseId]&&(c.ltdlaunch=f=a[p].data[c.phaseId][0].extraAttributes.sumLtdLaunchedUnit,c.sumInventory=i=a[p].data[c.phaseId][0].extraAttributes.sumInventory),f&&(c.soldPercentage=Math.round((f-i)/f*100)),c.soldPercentageHover=t(c.soldPercentage,c.sumInventory,c.constructionStatus),
c.soldPercentage=s(c.soldPercentage,c.sumInventory,c.constructionStatus),c.wavgPricePerUnitAreaOnLtdSupplyHover=r(c.extraAttributes.wavgPricePerUnitAreaOnLtdSupply,c.sumInventory,c.constructionStatus),c.extraAttributes.wavgPricePerUnitAreaOnLtdSupply=q(c.extraAttributes.wavgPricePerUnitAreaOnLtdSupply,c.sumInventory,c.constructionStatus)})})})}})}var o=e("dateFormat"),p=e("dateFormatForGraphs"),q=e("formatGraphPrice"),r=e("formatGraphPriceHover"),s=e("formatSoldPercentage"),t=e("formatSoldPercentageHover"),u=c.DASHBOARD,v=a.userDetails.preference.preference;b.enableTypeField=!1,b.timeInterval=c.TIME_INTERVAL,b.yearType=v.yearType;var w=v.dataUnitType;b.yearConstant=b.timeInterval.DURATION[b.yearType.toUpperCase()];var x=function(a,b,c){var d=a.builderId;k.getCard(d,function(e){e&&e.builderAddress?(m.gaEventViewBuilderDetailTooltip(a,d,b,c),a.builderAddress=e.builderAddress,l.getProjectDetail(a.projectId,function(b){b&&b.data&&b.data.projectBuilderContact&&(a.builderAddress+=" ("+b.data.projectBuilderContact+")"),a.clicked=!0})):e&&!e.builderAddress&&(a.builderAddress="contact detail coming soon",a.clicked=!0)})};b.getBuilderInfoFromId=x;var y=function(a){var b=[],c=a.type+"Id";return b[0]="(",$.each(a.ids,function(a,d){b[0]+=c+"=="+d+","}),b[0]=b[0].substring(0,b[0].length-1),b[0]+=")",a.unitType&&(b[0]+=";(",$.each(a.unitType,function(a,c){b[0]+="unitType=="+c+","}),b[0]=b[0].substring(0,b[0].length-1),b[0]+=")"),a.phaseId&&(b[0]+=";(",$.each(a.phaseId,function(a,c){b[0]+="phaseId=="+c+","}),b[0]=b[0].substring(0,b[0].length-1),b[0]+=")"),a.extraFilters&&$.each(a.extraFilters,function(a,c){b[0]+=";"+a+"=="+c}),b.push("&fields="+a.fields.join(",")),b.push("&group="+a.group.join(",")),a.monthDuration&&b.push("&"+a.durationType+"Duration="+a.monthDuration),a.extras&&$.each(a.extras,function(a,c){b.push("&"+a+"="+c)}),b.join("")},z=function(c,d){c.type=c.detail.userType,c.ids="city"===c.type?b.cityIds:b.localityIds,c.fields=u.KEY_DATA.FIELDS,c.unitType=a.userDetails.preference.preference.unitType;var e=y(c);$(".key-data-grid-keyloading").show(),f.trendHitherto(e,function(a){if($(".key-data-grid-keyloading").hide(),a){var d=g.keyData(a,c.group[1],b.yearType);b.tableColomns=Object.keys(d[b.durationType]).length+2,b.data=d,b.cityCount=Object.keys(d.city).length}},d)},A=function(a){var b=[];return angular.forEach(a,function(a){b.push(a.projectId)}),b},B=function(a){var b={paging:{start:0,rows:a.length},fields:["projectId","propertyUnitTypes"],filters:{and:[{equal:{projectId:a}}]}};return JSON.stringify(b)};b._defaults=u.KEY_DATA,b.options=b._defaults[w].OPTIONS,b.duration=b._defaults.DEFAULT_DURATION,b.durationType=b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].key,b.tableColomns=b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].period[b.duration.period]+1,b.intervalDefault={title:b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].title,period:b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].period[b.duration.period],key:b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].key},b.param={detail:b.detail,monthDuration:b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].period[b.duration.period],group:[b._defaults.DEFAULT_GROUP,b.durationType],durationType:b.durationType},b.$watch("detail",function(){z(b.param,!0)},!0),b.periodChanged=function(a){b.param.monthDuration=a.months,b.param.durationType=b.durationType=a.type,b.param.group=[b._defaults.DEFAULT_GROUP,b.durationType],z(b.param,!0);for(var c=0;c<b.options.length;c++){var d=b.options[c];d._display=!1,d._dataClicked=!1}},b.trend={};for(var C=0;C<b.options.length;C++)b.trend[b.options[C].key]=$.extend(!0,{},h.B2BDashBoard.KeyData);b.projectData={city:{},locality:{}},b.keyDateState={},b.topProjectCheck=function(a,b){var c=0;return void 0!==b?($.each(b,function(b,d){null!==d.extraAttributes[a]&&c++}),c>0?!0:!1):void 0},b.displayTopProjects=function(a,c,d){b.data&&"inventoryOverhang"!==a.key&&(a._dataClicked=!0,n(a.title,a.key,a.primaryKey,a.helperKey,"top",c,d))},b.toggleGraph=function(a){if(a._dataClicked=!1,b.data){var c,d,e,f,g=[],h=[],j=b.data.data,k=b.data.sortedIntervals;for(e=0;e<k.length;e++)g.push(b.data[b.durationType][k[e]]);b.trend[a.key].widgetData.displayInfo.xAxis={categories:g};for(f in j){for(c={name:"",cityid:"",data:[]},c.name=b.data.city[f],c.cityid=f,e=0;e<k.length;e++)j[f][k[e]]||(j[f][k[e]]={},j[f][k[e]].sumUnitsSold="NA",j[f][k[e]].sumLaunchedUnit="NA",j[f][k[e]].sumInventory="NA",j[f][k[e]].sumUnitsDelivered="NA",j[f][k[e]].inventoryOverhang="NA"),d=j[f][k[e]][a.key],d&&"NA"!=d?c.data.push(Math.round(d)):c.data.push(null);h.push(c)}b.trend[a.key].widgetData.displayInfo.plotOptions={series:{cursor:"pointer",point:{events:{click:function(c){"inventoryOverhang"!==a.key&&(n(a.title,a.key,a.primaryKey,a.helperKey,"top",this.category.epoch,this.series.data[0].series.options.cityid),i(function(){b.$apply()},10))}}}}},b.trend[a.key].widgetData.displayInfo.series=h;var l=b.trend[a.key].widgetData.displayInfo.xAxis.categories,m="",o=b.cityIds.sort(function(a,b){return a-b});m=o[o.length-1],"inventoryOverhang"!==a.key&&n(a.title,a.key,a.primaryKey,a.helperKey,"top",l[l.length-1].epoch,m)}},b.viewAllProjectsModal=function(a,b,c,e,f,g){var h=d.open({templateUrl:"views/directives/b2b/modal/dashboard-view-all-projects.html",windowClass:"all-localities-pop-up",keyboard:!0,controller:["$scope","$modalInstance",function(d,i){d.opt=a,d.durationData=b,d.epoch=c,d.cityname=f,d.heading=g,b.all||n(a.title,a.key,a.primaryKey,a.helperKey,"all",c,e),d._getBuilderInfoFromId=x,d._showLoader=!0,d.$watch("durationData",function(a,b){a&&a.all&&a.all.length>0&&(d._showLoader=!1),b.all&&b.all.length!==a.all.length&&(d._hideViewMore=!1)},!0),d.viewMore=function(){d._showLoader=!0,d._hideViewMore=!0,n(a.title,a.key,a.primaryKey,a.helperKey,"all",c,e)},d.cancel=function(){h.dismiss("cancel")}}]})}}]}}])}),define("text!views/directives/b2b/dashboard/price-trends-grid.html",[],function(){return'<div class="pr-tr-cntnr">\n    <div class="pr-tr-head">\n        <div class="hdng pt_row">\n            <div class="pt_col-6-19">Price Trend for Apartments in</div>\n            <div class="pt_col-3-19 btn-dd marginT5">\n                    <button class="btn marginT5 btn-block dropdown-toggle" data-toggle="dropdown">\n                        {{ptSelectedCity}} <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu dd-list">\n                        <li data-ng-repeat="city in detail.cities" data-ng-click="cityChanged(city.id, city.name)" once-text="city.name"></li>\n                    </ul>\n            </div>\n           <!-- <div class="pt_col-3-19">\n                <button data-ng-if="userInfo.type == 1" class="btn marginT5 btn-block" title="">{{ptSelectedCity}} <i class="pt  pt-icon-caret-down"></i></button>\n       \n                <div data-ng-if="userInfo.type == 2" class="btn-group">\n                    <button class="btn">{{ptSelectedCity}}</button>\n                    <button class="btn dropdown-toggle" data-toggle="dropdown">\n                        <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu">\n                        <li data-ng-repeat="city in userInfo.city" data-ng-click="cityChanged(city.id, city.name)">{{city.name}}</li>\n                    </ul>\n                </div>\n            </div>-->\n        </div>\n        <div class="pt_row top-line1">\n            <div class="pt_col-1-7"><strong>TOP LOCALITIES BY</strong></div>\n            <div class="pt_col-1-7">&nbsp;</div>\n            <div class="pt_col-1-7">&nbsp;</div>\n            <div class="pt_col-1-7">&nbsp;</div>\n            <div class="pt_col-1-7">&nbsp;</div>\n            <div class="pt_col-2-7"><!--strong>CUSTOM</strong--></div>\n        </div>\n        <div class="pt_row top-line2">\n            <div class="pt_col-1-7 pt_top-margin-10" data-ng-repeat="opt in options"\n                 analytics-on\n                 data-analytics-event="Click_{{opt.title}}_Graph"\n                 data-analytics-category="Dashboard"\n                 data-analytics-label=""\n                 data-ng-click="typeChanged($event, opt.key)">\n                <a data-ng-class="{\'active\' : opt.key== _defaults.DEFAULT_OPTION}" href="javascript:void(0)"\n                   once-text="opt.title" ng-click="updateSelectedPriceTrend(opt.title)"></a></div>\n            <div class="pt_col-1-7">&nbsp;</div>\n            <div class="pt_col-1-7">&nbsp;</div>\n            <div class="pt_col-1-7">\n                <div data-ga-category="Dashboard" pt-interval data-ga-title="Price Trend"  duration-changed="periodChanged(data)"duration="intervalDefault" constant="yearConstant"></div>\n            </div>\n            <div class="pt_col-2-7"><!--a class="" href="javascript:void(0)"><input type="checkbox" class="" /> Custom Localities</a--></div>\n        </div>\n        \n        <!--<div class="pt_row pt_row_pad10rt0 head">\n            &lt;!&ndash;<div data-ng-repeat="mo in data.sortedIntervals" class="pt_col-1-{{tableColomns}}">{{data[type][mo]}}</div>&ndash;&gt;\n            <div class="pt_col-1-{{tableColomns}}">\n            </div>\n        </div>-->\n    </div>\n    \n    <div class="pr-tr-group tabgraph-max" data-ng-attr-tabindex="{{tabIndex}}">\n        <div pt-loading-block class="keyloading price-trend-keyloading" icon-styling-class="loading-icon-size">loading...</div>\n        <div class="sub-link" data-ng-if="displayType !== \'all\'">\n            <!--span class="show-resale" title="Check to Show Resale Prices">\n            	<input id="showre" type="checkbox" /> \n	            <label for="showre" href="javascript:void(0)">Show Resale Prices</label>\n            </span-->\n            <a class="view-all" href="javascript:void(0)" data-ng-click="allLocalities()" title="View all Localities">Change Localities</a>\n            <div class="pt_col-1-{{tableColomns}}">\n                <div class="btn-accordion-wrap pull-right marginR10 marginB10 toggle-graph" style="top:2px;">\n                    <button class="btn btn-lg" data-ng-click="toggleGraph(); _display=!_display;"><i data-ng-class="(_display)?[\'pt pt-icon-list-alt\']:[\'pt pt-icon-bar-chart-o\']"></i></button>\n                </div>\n            </div>\n        </div>\n        <div data-ng-repeat="obj in data.data | limitTo: displayCount" class="loc-set" data-ng-hide="showGraph">\n            <div ng-if="enableLocalitySelect" class="loc-color">\n                <input type="checkbox" ng-model="obj.selectLocality" checked="{{obj.selectCity}}" ng-change="validateSelectedLocalityMaxLimit(obj)">\n            </div>\n            <div class="loc-color" once-text="data.locality[obj.id]"></div>\n            <div class="pt_row pt_row_pad10rt0 row-sale">\n                <div data-ng-repeat="m in data.sortedIntervals" class="pt_col-1-{{tableColomns}}">\n                    <div data-ng-if="obj[\'sale\'][m][\'price\'] !== \'NA\'" once-html="obj[\'sale\'][m][\'price\']"></div>\n                    <div data-ng-if="(!obj[\'sale\'][m][\'price\'] || obj[\'sale\'][m][\'price\'] ===\'NA\') && (obj[\'sale\'][m][\'sumInventory\'] === 0)" >Sold out</div>\n                    <div data-ng-if="(!obj[\'sale\'][m][\'price\'] || obj[\'sale\'][m][\'price\'] ===\'NA\') && (obj[\'sale\'][m][\'sumInventory\'] !== 0)" >Coming soon</div>\n                </div>\n                <div class="pt_col-1-{{tableColomns}}">primary</div>\n            </div>\n            <!--div class="pt_row pt_row_pad10rt0 row-resale">\n                <div class="pt_col-1-{{tableColomns}}">resale</div>\n                <div data-ng-repeat="m in data.sortedIntervals" class="pt_col-1-{{tableColomns}}">\n                    <div data-ng-if="obj[\'sale\'][m][\'resale\']" once-html="obj[\'sale\'][m][\'resale\']"></div>\n                    <div data-ng-if="!obj[\'sale\'][m][\'resale\']" >NA</div>\n                </div>\n                \n            </div-->\n		</div>\n        \n        <div class="pr-tr-graph-wrap" data-ng-show="showGraph">\n            <div pt-widgetchart widget-data="trend" data-ng-if="data"></div>\n        </div>\n    </div>\n</div>\n'}),define("directives/b2b/dashboard/price-trends-grid",["app","text!views/directives/b2b/dashboard/price-trends-grid.html","services/b2b-constants","services/b2b/dataService","parsers/priceTrend","configs/widgetConfig","directives/common/pt-widgetChart","directives/common/pt-loading-block","directives/common/pt-interval"],function(a,b){a.directive("priceTrendsGrid",["$rootScope","B2BConstants","$modal","$filter","DataService","PriceTrendParser","WidgetConfig","GoogleAnalyticsService",function(a,c,d,e,f,g,h,i){return{restrict:"EA",scope:{displayType:"@",detail:"=",cityId:"=?",enableLocalitySelect:"@?",selectedLocalities:"=?"},template:b,link:function(a,b){$(".dd-wrap .dd-toggle").click(function(){$(this).siblings(".dd-menu").is(":visible")?$(".dd-menu").slideUp():$(".dd-menu").slideDown()})},controller:["$scope","$element",function(b,j){var k=0,l=(e("dateFormat"),c.DASHBOARD);b.tabIndex=0,b.timeInterval=c.TIME_INTERVAL,b._display=!0;var m=a.userDetails.preference.preference;b.yearType=m.yearType,b.yearConstant=b.timeInterval.DURATION[b.yearType.toUpperCase()];var n=function(a){b.selectedLocalities=a,angular.forEach(b.selectedLocalities.data,function(a){a.selectLocality=!1})},o=function(a){var c=[];angular.forEach(a.data,function(a){a.selectLocality&&c.push(a)}),0!=c.length&&(a.data=c,b.tableColomns=Object.keys(a[b.type]).length+1,b.displayCount="grid"!==b.displayType?Object.keys(a.data).length:b._defaults.DEFAULT_COUNT,b.data=a)},p=function(a){var b=[];return b[0]="cityId=="+a.cityId,b[1]="&fields="+a.fields.join(","),b[2]="&group="+a.group.join(","),b[3]="&"+a.durationType+"Duration="+a.month,b.join("")},q=function(a){a.fields=l.PRICE_TREND.FIELDS;var c=p(a);$(".price-trend-keyloading").show(),f.priceTrendHitherto(c,function(c){if($(".price-trend-keyloading").hide(),c){var d=g.priceTrendData(c,a.group[1],a.sort,b.yearType);b.tableColomns=Object.keys(d[b.type]).length+1,b.displayCount="grid"!==b.displayType?Object.keys(d.data).length:b._defaults.DEFAULT_COUNT,b.data=d,b.enableLocalitySelect&&n(b.data)}})};return b._defaults=l.PRICE_TREND,b.options=b._defaults.OPTIONS,b.selectedPriceTrend=_.where(b.options,{key:b._defaults.DEFAULT_OPTION})[0].title,b.duration=b._defaults.DEFAULT_DURATION,b.type=b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].key,b.tableColomns=b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].period[b.duration.period]+1,b.ptSelectedCity=b.detail.cities?b.detail.cities[0].name:"",b.intervalDefault={title:b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].title,period:b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].period[b.duration.period],key:b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].key},b.param={cityId:b.cityId?b.cityId:b.detail.cities[0].id,sort:[b._defaults.DEFAULT_OPTION],month:b.timeInterval.DURATION[b.yearType.toUpperCase()][b.duration.type].period[b.duration.period],group:[b._defaults.DEFAULT_GROUP,b.type],durationType:b.type},b.cityChanged=function(a,c){i.gaEventClickPriceTrendsChangeCityType(b.selectedPriceTrend,c),b.ptSelectedCity=c,b.param.cityId=a,b.cityId=a,q(b.param)},b.typeChanged=function(a,c){$(".top-line2 a").removeClass("active"),$(a.target).addClass("active"),b.param.sort=[c],q(b.param)},b.updateSelectedPriceTrend=function(a){b.selectedPriceTrend=a},b.periodChanged=function(a){b.param.month=a.months,b.param.durationType=b.type=a.type,b.param.group=[b._defaults.DEFAULT_GROUP,a.type],q(b.param)},b.allLocalities=function(){d.open({backdrop:"static",keyboard:!1,templateUrl:"views/directives/b2b/modal/price-trend-all-localities.html",windowClass:"all-localities-pop-up",resolve:{data:[function(){return{detail:b.detail,displayType:b.displayType,cityId:b.cityId}}]},controller:["$scope","$modalInstance","data",function(a,b,c){a.detail=c.detail,a.displayType=c.displayType,a.cityId=c.cityId,a.selectedLocalities={},a.cancel=function(){b.dismiss("cancel")},a.onOkClick=function(b){o(b),a.cancel()}}]})},b.validateSelectedLocalityMaxLimit=function(a){a.selectLocality?k++:k--,k>5&&(a.selectLocality=!a.selectLocality,k--)},b.customLocalities=function(){d.open({backdrop:"static",keyboard:!1,templateUrl:"views/directives/b2b/modal/price-trend-custom-localities.html",resolve:{detail:[function(){return b.detail}]},controller:["$scope","$modalInstance","detail",function(a,b,c){a.detail=c,a.cancel=function(){b.dismiss("cancel")}}]})},"grid"!==b.displayType?void(b.tabIndex=1):(b.trend=h.B2BDashBoard.PriceTrend,b.$watch("data",function(a,c){if(a&&a!==c){var d,e,f,g,h,i=[],j={},k=a.sortedIntervals,l=a.data,m=[];for(d=0,g=k.length;g>d;d++)i.push(a[b.type][k[d]]);for(b.trend.widgetData.displayInfo.xAxis={categories:i},f=0,e=l.length;e>f&&f<b.displayCount;f++){for(j={name:"",data:[]},j.name=a.locality[l[f].id],d=0,g=k.length;g>d;d++)h=l[f].sale[k[d]]&&l[f].sale[k[d]].wavgPricePerUnitAreaOnLtdSupply?l[f].sale[k[d]].wavgPricePerUnitAreaOnLtdSupply:void 0,h?j.data.push(parseInt(h)):j.data.push(null);m.push(j)}b.trend.widgetData.displayInfo.series=m}}),b.showGraph=!0,void(b.toggleGraph=function(){b.showGraph=!b.showGraph}))}]}}])}),define("controllers/b2b/dashboardCtrl.91f157c1",["app","services/b2b-constants","directives/b2b/dashboard/key-data-grid","directives/b2b/dashboard/price-trends-grid"],function(a){a.controller("dashboardCtrl",["$rootScope","$scope","B2BConstants","$modal","$q","$timeout","GoogleAnalyticsService","CookieService",function(a,b,c,d,e,f,g,h){"use strict";function i(a,b){var c=b?!1:!0;"city"===a.userType&&$.each(a.cities,function(a,d){c||-1!=b.indexOf(d.id)?d.selected=!0:d.selected=!1}),"locality"===a.userType&&$.each(a.cities,function(a,d){var e=0;$.each(d.localities,function(a,d){c||-1!=b.indexOf(d.id)?(e++,d.selected=!0):d.selected=!1}),e?d.selected=!0:d.selected=!1})}b._constants=c.DASHBOARD;var j=a.userDetails.subscriptions[0],k=a.userDetails.preference.preference,l=k.dataUnitType,m={};"city"===j.userType&&(1===j.cityCount?(m.heading=j.cities[0].name,m.breakup=j.projectCount+" projects"):(m.heading="Multi City",m.breakup=j.localityCount+" localities, ",m.breakup+=j.projectCount+" projects"),m.list=j.cities,m.count=j.cityCount,m.heading+=" Dashboard"),"locality"===j.userType&&(1===j.localityCount?m.heading=j.cities[0].localities[0].name:m.heading="Multi Locality",m.list=[],$.each(j.cities,function(a,b){m.list.concat(b.localities)}),m.count=j.localityCount,m.heading+=" Dashboard",m.breakup=j.projectCount+" projects"),m.untilDate=new Date(j.dataUpdationDate);var n=h.getJson("cityselected");n&&n.length>0?i(j,n):i(j),b.detail=j,b.header=m,b.cityIds=[],b.cityNames=[],b.$watch("detail.cities",function(a,c){for(var d=[],e=[],f=0;f<b.detail.cities.length;f++){var g=b.detail.cities[f];g.selected&&(d.push(g.id),e.push(g.name))}b.cityIds=d,b.cityNames=e},!0),b.localityIds=[],b.$watch("detail.cities",function(a,c){for(var d=[],e={},f=0;f<b.detail.cities.length;f++){var g=b.detail.cities[f];e[g.id]=[];for(var h=0;h<g.localities.length;h++){var i=g.localities[h];i.selected&&(d.push(i.id),e[g.id].push(i.id))}}b.localityIds=d,b.cityLocalityIds=e},!0),b.editAreaModal=function(a){var b={city:"views/directives/b2b/modal/edit-area-city.html",locality:"views/directives/b2b/modal/edit-area-locality.html"},e=d.open({templateUrl:b[a.userType],controller:["$scope","$modalInstance",function(b,d){b.cities=a.cities,b.selected=a.selected,b.allowUpdate=!0,b.cancel=function(){e.dismiss("cancel"),g.gaEventCloseMulticityDashboard()},b.toggle=function(c,d,e){var f=$(d.currentTarget);if(f.hasClass("active")?f.removeClass("active"):f.addClass("active"),"city"===a.userType&&(f=$("."+e+" .active").not(".pt_active")),"locality"===a.userType){if("city-edit"===e&&(f.hasClass("active")?f.parent().find("li").addClass("active"):f.parent().find("li").removeClass("active")),"locality-edit"===e){var g=f.closest(".city-list-item"),h=g.find(".city-elem");g.find(".locality-elem.active").length?h.addClass("active"):h.removeClass("active")}f=$(".locality-edit .active")}b.allowUpdate=!(0==f.length),f.length<b.cities.length?angular.element(".pt_active").removeClass("active"):angular.element(".pt_active").addClass("active")},b.update=function(d){if(b.allowUpdate){var f=$("."+d+" .active"),j=[];$.each(f,function(a,b){var c=$(b).attr("data-area-id");c&&(c=parseInt(c),j.push(c)),h.setJson("cityselected",j)}),g.gaEventUpdateMulticityDashboard(a,j),i(a,j),e.dismiss("cancel");for(var k=c.DASHBOARD.KEY_DATA[l].OPTIONS,m=0;m<k.length;m++){var n=k[m];n._display=!1,n._dataClicked=!1}}},b.selectAll=function(){angular.element("ul.list-level1 li").hasClass("active")?(angular.element("ul.list-level1 li").removeClass("active"),b.allowUpdate=!1):(angular.element("ul.list-level1 li").addClass("active"),b.allowUpdate=!0)};var j=h.getJson("cityselected");j&&j.length===b.cities.length&&f(function(){angular.element(".pt_active").addClass("active")})}]})}}])});