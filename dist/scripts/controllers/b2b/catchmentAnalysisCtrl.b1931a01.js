define("services/catchmentService",["app","services/getHttpService","services/globalService"],function(a){a.config(["$httpProvider",function(a){"use strict";delete a.defaults.headers.common["X-Requested-With"]}]).factory("CatchmentService",["$http","GlobalService","GetHttpService",function(a,b,c){"use strict";var d={"Content-Type":"application/json"},e=b.getAPIURL("data/v1/entity/user/catchment"),f=function(b,c,f,g,h,i){var j,k,l={},m="POST";if(!angular.isString(c)||!c.trim())return{status:"error",msg:"Please provide a valid name"};if(!f||!f.length)return{status:"error",msg:"Please include a project to create a valid catchment"};if(b)for(m="PUT",l.id=b,l.name=c.trim(),l.catchmentProjects=[],j=0,k=f.length;k>j;j++)l.catchmentProjects.push({projectId:f[j]});else for(l.name=c.trim(),l.catchmentProjects=[],j=0,k=f.length;k>j;j++)l.catchmentProjects.push({projectId:f[j]});l.status=g?g:"Active",h&&_.isObject(h)&&(l.metaAttributes=h),a({method:m,url:e,data:l,headers:d}).then(function(a){i(a)})},g=function(a,c){var d="data/v1/entity/user/catchment?filters=id=="+a;return b.makeGetCall(d,"application/json",!0,!0).then(function(a){200===a.status&&c(a.data.data)})},h=function(a,c,d,e){var f="";f+="?sort=-id",a&&(f+="&rows="+a,f+=c?"&start="+c:"&start=0"),d&&(f+="&filters=status=="+d);var g="data/v1/entity/user/catchment"+f;return b.makeGetCall(g,"application/json",!0,!0).then(function(a){200===a.status&&e(a.data.data)})};return{updateCatchment:f,getCatchment:g,getAllCatchment:h}}])}),define("text!views/directives/b2b/analysis/graph.html",[],function(){return'   \n<div class="ga-cntnr">\n    <div class="pt_row tags">\n\n        <div data-ng-repeat="category in catchment" class="pt_col-1-3">\n            <span class="tag-supply">\n                {{category.label}}\n            </span>\n        </div>\n        <!--<div class="pt_col-2-5">\n            <span class="tag-saved"><i class="pt  pt-icon-save"></i></span>\n        </div>-->\n    </div>\n    \n\n    <div class="ga-head pt_row">\n        <div data-ng-repeat=\'category in catchment\' class="pt_col-1-3">\n            <a data-ng-repeat="prime in category.primes" class=""\n               analytics-on\n               data-analytics-event="Select_AnalyseBuilderSearch_Graph View"\n               data-analytics-category="Builder Analysis"\n               data-analytics-label="{{prime.label}}"\n               data-ng-class="{\'active\' : prime == catchment.prime}"\n               data-ng-click="catchment.prime = prime">\n                {{prime.label}}\n            </a>\n        </div>\n    </div>\n\n    <div class="graph-area-wrap">\n        <div class="pt_row">\n            <div class="pt_col-8-8 text-center">\n                <div class="graph-filter">\n                    <a data-ng-repeat=\'split in catchment.splits\' data-ng-class="{\'active\': split == catchment.split}" data-ng-click="activateSplit(split)"> \n                        {{split.label}} \n                    </a>\n                </div>\n            </div>\n        </div>\n\n        <div class="graph-area">\n            <div class="lhs">\n                <div class="data-type one" data-ng-if="catchment.prime.ordinates.length > 1">\n                    <a class="selected dropdown-toggle">\n                        {{catchment.ordinate.label}}&nbsp;\n                        <i class="pt  pt-icon-caret-down"></i> \n                    </a>\n                    <ul class="dropdown-menu dd-list">\n                        <li data-ng-repeat=\'ordinate in catchment.prime.ordinates\' data-ng-click=\'catchment.ordinate = ordinate; assignSplit(ordinate.splits); getGraphData(ordinate)\'>   \n                            {{ordinate.label}}\n                        </li>\n                    </ul>\n                </div>\n\n                <div class="data-type one" data-ng-if="!catchment.prime.ordinates  || catchment.prime.ordinates.length <= 1">\n                    <a class="selected dropdown-toggle">\n                        {{catchment.ordinate.label}}&nbsp;\n                    </a>\n                </div>\n\n                <div class="data-type two" data-ng-if="catchment.measure && catchment.measure.values">\n                    <a class="selected dropdown-toggle">\n                        <strong> {{catchment.measure.label}} </strong>\n                        <span data-ng-if="catchment.measure.values.length > 1"> {{catchment.measureValue.label}}&nbsp; </span>\n                        <i class="pt  pt-icon-caret-down"></i>\n                    </a>\n                    <ul class="dropdown-menu dd-list labelled-list">\n                        <span class="labelled" data-ng-repeat=\'measure in catchment.prime.measures\'>                             \n                            <strong>{{measure.label}}</strong>\n                            <li data-ng-repeat=\'value in measure.values\'\n                                analytics-on\n                                data-analytics-event="Select_AnalyseBuilderPrice_Rate"\n                                data-analytics-category="Builder Analysis"\n                                data-analytics-label="{{value.label}}"\n                                class="clearfix" data-ng-click="justConvertData(measure, value); catchment.measure = measure; catchment.measureValue = value; " >\n                                {{value.label}}\n                            </li>\n                        </span>\n                    </ul>\n                </div>\n\n                <div class="data-type one" data-ng-if="catchment.measure && !catchment.measure.values">\n                    <a class="selected dropdown-toggle">\n                        {{catchment.measure.label}}&nbsp;\n                    </a>\n                </div>\n\n                <div data-ga-title="AnalyseBuilderPrice" data-ga-category="Builder Analysis" pt-interval duration-changed=\'durationChanged(data)\' duration="intervalDefault" constant="yearConstant" class="time-duration" style="display:inline-block;margin:54px 0 0 11px;min-width:110px;" data-ng-show="!catchment.ordinate.isTimeIndependentOrdinate"> </div>\n            </div>\n\n            <div class="rhs paddingTB20">\n                <span data-ng-if="!graphDataCalled">\n                    <div class="graph"></div>\n                </span>\n                <span data-ng-if="graphDataCalled">\n                   <div pt-loading-block></div>\n                </span>\n			</div>\n\n            <!-- <div class="template">\n                <div class="tbl-summary ">\n                    <div class="pt_row" data-ng-repeat = "dataSet in graphData">\n                        <div class="table-cell padding5 put-ellipsis data-name" data-ng-if="dataSet.series">\n\n                            <strong>{{dataSet.name}}</strong>\n\n                            <span data-ng-if="catchment.split.key == \'bedrooms\'">\n                                &nbsp;&nbsp; ({{dataSet.minSize}} - {{dataSet.maxSize}}  \n                                \n                                <span data-ng-if="catchment.measure.key == \'area\'">  \n                                    {{catchment.measureValue.label}}) \n                                </span>\n                                <span data-ng-if="catchment.measure.key != \'area\'">  \n                                    sq ft)\n                                </span>\n                            </span>\n\n                        </div>\n\n                        <div class="data-container">\n                            <div class="pt_col-1-{{dataSet.series.length}} table-cell padding5" data-ng-repeat="dataPoint in dataSet.series track by $index">\n                               <i class="pt  pt-icon-inr" data-ng-if="dataPoint.y != NA && catchment.prime.key === \'price\'"></i>{{dataPoint.y | round | number_in:\'NA\' }} <span data-ng-if="catchment.prime.isPercentageGraph === true && dataPoint.y">%</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div> -->\n\n            \n        </div>\n        <div data-ng-if="showDrillDown" class="drilldown">\n            <div class="title pull-left lh35">\n                 <span data-ng-if=\'projectLength >= 10\'>Top 10</span> Projects \n\n                <span data-ng-if="catchmentId && currentCatchment.status !== \'Inactive\'"> in {{currentCatchment.name}}</span>\n\n                <span data-ng-if="drillForSplit != \'Aggregate\'"> \n                    of  {{catchment.ordinate.label}} - {{drillForSplit}}\n                </span> \n                <span data-ng-if="drillForSplit == \'Aggregate\'"> \n                    of  {{catchment.ordinate.label}}\n                </span> \n\n\n                in {{drillForMonth}}\n    \n                <span data-ng-if="builderId"> for {{builder.data.name}}</span>\n    \n                \n            </div>\n            <div class="btn-accordion-wrap pull-right">\n                <button class="btn btn-lg drillBtn" data-ng-click="toggleDrillDown()" data-ng-class="{\'active\':!drillDownClosed}">\n                    <i class="pt  pt-icon-chevron-down"></i>\n                    <span data-ng-if="drillDownClosed">SHOW SNAPSHOT</span>\n                    <span data-ng-if="!drillDownClosed">HIDE SNAPSHOT</span>\n                </button>\n            </div>\n            <div class="clearfix"></div>\n        </div>\n\n\n        <div class="graph-area last">\n            <div class="lhs" data-ng-if="showDrillDown">\n                <div>{{catchment.ordinate.label}}</div>\n                <div>{{catchment.measure.label}} \n                    <span data-ng-if="catchment.measure.values.length > 1"> {{catchment.measureValue.label}}&nbsp; </span>\n                </div>\n\n            </div>\n\n        	<div class="rhs">\n                <span data-ng-if="!gettingDrillDown" id="drillDown">\n                    \n                    <div class="paddingTB20" data-ng-if="showDrillDown">\n                        <div class="graph-drill-down"> </div>\n\n                    </div>\n                </span>\n                <span data-ng-if="gettingDrillDown">\n                    <div pt-loading-block></div>\n                </span>\n            </div>\n            <div class="clearfix"></div>\n        </div>\n    </div>\n</div>\n    \n'}),define("services/b2b/GraphMappings",["app","services/b2b-constants"],function(a){a.factory("GraphMappings",["B2BConstants",function(a){return{CATCHMENT_ANALYSIS:[{label:"Supply Trends",primes:[{label:"Price",key:"price",graph:"line",measures:[a.MEASURES.rate],splits:[a.GRAPH_SPLITS.aggregate,a.GRAPH_SPLITS.propertyType,a.GRAPH_SPLITS.constructionStatus],ordinates:[{label:"Price",key:"wavgPricePerUnitAreaOnLtdSupply"}]},{label:"Sales",graph:"column",measures:[a.MEASURES.units,a.MEASURES.area],ordinates:[{label:"Units Sold",key:"sumUnitsSold",areaKey:"wavgSizeOnUnitsSold"},{label:"Unsold Inventory",key:"sumInventory",areaKey:"wavgSizeOnInventory"},{label:"Inventory Overhang",key:"sumRateOfSale",extraInfo:"sumInventory",splits:[a.GRAPH_SPLITS.aggregate]}],splits:[a.GRAPH_SPLITS.aggregate,a.GRAPH_SPLITS.propertyType,a.GRAPH_SPLITS.bhk,a.GRAPH_SPLITS.budget,a.GRAPH_SPLITS.constructionStatus]},{label:"Launch & Delivery",graph:"column",measures:[a.MEASURES.units,a.MEASURES.area],ordinates:[{label:"Units Launched",key:"sumLaunchedUnit",areaKey:"wavgSizeOnLaunchedUnit"},{label:"Units Delivered",key:"sumUnitsDelivered",areaKey:"wavgSizeOnUnitsDelivered"},{label:"Unit Delayed",key:"sumLtdLaunchedUnit",baseKey:"sumLtdLaunchedUnit",helperKey:"completionDelayInMonth",areaKey:"wavgSizeOnLtdLaunchedUnit",splits:[a.GRAPH_SPLITS.delayPeriod],isTimeIndependentOrdinate:!0}],splits:[a.GRAPH_SPLITS.aggregate,a.GRAPH_SPLITS.propertyType,a.GRAPH_SPLITS.bhk,a.GRAPH_SPLITS.budget,a.GRAPH_SPLITS.constructionStatus,a.GRAPH_SPLITS.bookingStatus]}]},{label:"Demand Trends",primes:[{label:"Customer Demand",key:"sumCustomerDemand",isPercentageGraph:!0,graph:"column",drillDownGraph:"pie",graphPlot:{column:{stacking:"percent"}},measures:[a.MEASURES.percentage],splits:[a.GRAPH_SPLITS.propertyType,a.GRAPH_SPLITS.bhk,a.GRAPH_SPLITS.budget,a.GRAPH_SPLITS.customerType],ordinates:[{label:"Customer Demand",key:"sumCustomerDemand"}]}]},{label:"Comparison",primes:[{label:"Sales Vs Demand",key:"sumDemand",isPercentageGraph:!0,graph:"column",type:"comparison",primaryField:{key:"sumDemand",label:"Demand"},secondaryField:{key:"sumUnitsSold",label:"Sales"},graphPlot:{column:{stacking:"percent"}},splits:[a.GRAPH_SPLITS.bhk,a.GRAPH_SPLITS.budget],ordinates:[{label:"Percentage"}]}]}],BUILDER_ANALYSIS:[{label:"Supply Trends",primes:[{label:"Price",key:"price",graph:"line",measures:[a.MEASURES.rate],splits:[a.GRAPH_SPLITS.projects],ordinates:[{label:"Price",key:"wavgPricePerUnitAreaOnLtdSupply"}]},{label:"Sales",graph:"column",measures:[a.MEASURES.units,a.MEASURES.area],ordinates:[{label:"Units Sold",key:"sumUnitsSold",areaKey:"wavgSizeOnUnitsSold"},{label:"Unsold Inventory",key:"sumInventory",areaKey:"wavgSizeOnInventory"},{label:"Inventory Overhang",key:"sumRateOfSale",areaKey:"wavgSizeOnInventory",extraInfo:"sumInventory",splits:[a.GRAPH_SPLITS.aggregate]}],splits:[a.GRAPH_SPLITS.aggregate,a.GRAPH_SPLITS.propertyType,a.GRAPH_SPLITS.bhk,a.GRAPH_SPLITS.budget,a.GRAPH_SPLITS.constructionStatus]},{label:"Launch & Delivery",graph:"column",measures:[a.MEASURES.units,a.MEASURES.area],ordinates:[{label:"Units Launched",key:"sumLaunchedUnit",areaKey:"wavgSizeOnLaunchedUnit"},{label:"Units Delivered",key:"sumUnitsDelivered",areaKey:"wavgSizeOnUnitsDelivered"},{label:"Unit Delayed",key:"sumLtdLaunchedUnit",baseKey:"sumLtdLaunchedUnit",helperKey:"completionDelayInMonth",areaKey:"wavgSizeOnLtdLaunchedUnit",splits:[a.GRAPH_SPLITS.delayPeriod],isTimeIndependentOrdinate:!0}],splits:[a.GRAPH_SPLITS.aggregate,a.GRAPH_SPLITS.propertyType,a.GRAPH_SPLITS.bhk,a.GRAPH_SPLITS.budget,a.GRAPH_SPLITS.constructionStatus,a.GRAPH_SPLITS.bookingStatus]}]}]}}])}),define("services/b2b/TrendService",["app","services/globalService","services/getHttpService"],function(a){a.factory("TrendService",["$http","GlobalService","GetHttpService",function(a,b,c){var d="data/v1/trend",e="data/v1/entity/user/catchment/",f="data/v1/price-trend",g=function(a){return a+"/hitherto"},h=function(a){return a+"/current"},i=function(){return g(f)},j=function(){return g(d)},k=function(){return h(d)},l=function(a){return g(e+a+"/trend")},m=function(a){return h(e+a+"/trend")},n=function(d,e){return a({method:"GET",url:b.getAPIURL(d)}).success(function(a){var b=!1;c.commonResponseData(a,"",b),e&&a.statusCode&&"2"===a.statusCode.substring(0,1)&&e(a,200)}).error(function(a){!e||!a||a.statusCode&&"5"!==a.statusCode.substring(0,1)||e(void 0,500)})};return{trendURL:d,priceTrendURL:f,getHithertoURL:g,getCurrentURL:h,getData:n,getPTH:i,getTH:j,getCTH:l,getCTC:m,getTC:k}}])}),define("text!views/directives/common/pt-loading-block.html",[],function(){return'<div class="parent-blocking" data-ng-if="!loadingObject">\n    <div class="loader-info">\n    	<div data-ng-transclude ></div>\n    	<i class="pt pt-icon-cog pt-icon-spin {{iconStylingClass}}"></i>\n        <div class="big-loader">\n            <i class="spinLoader"></i>\n        </div>      \n    </div>        \n</div>\n'}),define("directives/common/pt-loading-block",["app","text!views/directives/common/pt-loading-block.html"],function(a,b){a.directive("ptLoadingBlock",[function(){return{restrict:"A",scope:{loadingObject:"=",iconStylingClass:"@"},transclude:!0,template:b,link:function(a,b,c){a.iconStylingClass=a.iconStylingClass||"",a.$on("$destroy",function(){a.loadingObject=void 0,b.remove()})}}}])}),define("text!views/directives/common/pt-interval.html",[],function(){return'<div class="time-controller-wrap">\n    <button id="" class="btn marginT5 btn-block dropdown-toggle" data-toggle="dropdown" title="Click to choose the Time Period">\n        <span class="put-ellipsis">{{duration.period}} {{duration.title}}</span> <i class="pt  pt-icon-caret-down"></i>\n    </button>\n\n    <div class="dropdown-menu dd-list">\n        <ul tabset class="timeControllerTabs">\n            <li tab heading="Monthly" id="Monthly" data-ng-click="$event.stopPropagation();">\n                <ul class="time-options">\n                    <li data-ng-repeat="period in constant.Monthly.period" data-ng-click="updateDuration($event, period, constant.Monthly)">\n						<i data-ng-class="duration.period == period && duration.key == \'month\' ? \'pt  pt-icon-dot-circle-o\' : \'pt  pt-icon-circle-o\'"></i>\n						Last {{period}} {{constant.Monthly.title}}\n					</li>\n                    <!--li><i class="pt  pt-icon-circle-o" ></i>  Custom</li-->\n                </ul>\n            </li>\n\n            <li tab heading="Quarterly" id="Quarterly" data-ng-click="$event.stopPropagation();" data-ng-show="constant.Quarterly">\n                <ul class="time-options">\n                    <li data-ng-repeat="period in constant.Quarterly.period" data-ng-click="updateDuration($event, period, constant.Quarterly)"><i class="pt  pt-icon-circle-o" ></i>  Last {{period}} {{constant.Quarterly.title}}</li>\n                </ul>\n            </li>\n\n            <li tab heading="Annualy" id="Annualy" data-ng-click="$event.stopPropagation();" data-ng-show="constant.Annualy">\n                <ul class="time-options">\n                    <li data-ng-repeat="period in constant.Annualy.period" data-ng-click="updateDuration($event, period, constant.Annualy)"><i class="pt  pt-icon-circle-o" ></i>  Last {{period}} {{constant.Annualy.title}}</li>\n                </ul>\n            </li>\n        </ul>\n\n        <!--div class="pt_row check-graph-change">\n            <div class="pt_col-1-9">\n                <i class="pt  pt-icon-square-o"></i>\n            </div>\n            <div class="pt_col-8-9">\n                Change time period for all graphs\n            </div>\n        </div-->\n    </div>\n</div>\n\n\n\n'}),define("directives/common/pt-interval",["app","text!views/directives/common/pt-interval.html","services/b2b-constants"],function(a,b){a.directive("ptInterval",["B2BConstants","GoogleAnalyticsService",function(a,c){return{restrict:"EA",scope:{durationChanged:"&",duration:"=?",constant:"=?",gaTitle:"@?",gaCategory:"@?"},template:b,link:function(a,b){},controller:["$scope","$element",function(b,d){if(b.constant||(b.constant=a.TIME_INTERVAL.DURATION),!b.duration){var e=a.TIME_INTERVAL.DEFAULT_DURATION;b.duration={title:b.constant[e.type].title,period:b.constant[e.type].period[e.period],key:b.constant[e.type].key}}b.updateDuration=function(a,d,e){c.gaEventSelectTitlePeriod(b.gaTitle,d,e,b.gaCategory),b.duration={period:d,title:e.title,key:e.key},$(a.target).parent().parent().parent().parent().find("i.pt-icon-dot-circle-o").addClass("pt-icon-circle-o").removeClass("pt-icon-dot-circle-o"),$(a.target).find("i").removeClass("pt-icon-circle-o").addClass("pt-icon-dot-circle-o")},b.$watch("duration",function(a,c){if(a){var d={type:a.key};d.months=a.period,b.durationChanged({data:d})}})}]}}])}),define("configs/widgetConfig",["app"],function(a){a.factory("WidgetConfig",[function(){return{B2BDashBoard:{PriceTrend:{name:"Price Trend",title:{text:"Price Trend"},tag:"",type:"graph",widgetData:{displayInfo:{title:{text:"Graph / Chart"},chart:{type:"spline",backgroundColor:"#e7efef",borderRadius:0},subtype:"line",tooltip:{crosshairs:!0,pointFormat:'<span style="color:{series.color}">{series.name}</span>: ₹{point.y}<br/>'},xAxis:{categories:[],tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{gridLineWidth:0,title:{text:"Price (Rs per sq ft)"},labels:{format:"{value}",formatter:function(){return"₹"+Highcharts.numberFormat(this.value,0,"",",")}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Print",onclick:function(){this.print()}},{text:"Save as PNG",onclick:function(){this.exportChart({type:"image/png"})},separator:!1}]}}},plotOptions:{line:{events:{legendItemClick:function(){return!0}}}},seriesMeta:{name:[],data:"price"},series:[],noData:{style:{fontWeight:"bold",fontSize:"18px",fontFamily:"Lato Bold",color:"#6b727a"}},lang:{noData:"No matching projects found to plot in the graph"}},entities:["price","effectiveDate"]}},KeyData:{name:"Key Data",title:{text:"Key Data"},tag:"",type:"column",widgetData:{displayInfo:{title:{text:"Graph / Chart"},chart:{backgroundColor:"#e7efef",borderRadius:0},subtype:"column",xAxis:{categories:[],tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{gridLineWidth:0,title:{text:""},labels:{format:"{value}",formatter:function(){return Highcharts.numberFormat(this.value,0,"",",")}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Print",onclick:function(){this.print()}},{text:"Save as PNG",onclick:function(){this.exportChart({type:"image/png"})},separator:!1}]}}},plotOptions:{line:{events:{legendItemClick:function(){return!0}}}},seriesMeta:{name:[],data:"price"},series:[],noData:{style:{fontWeight:"bold",fontSize:"18px",fontFamily:"Lato Bold",color:"#6b727a"}},lang:{noData:"No matching projects found to plot in the graph"}},entities:["price","effectiveDate"]}}},GraphAnalysis:{chart:{backgroundColor:"transparent"},xAxis:{},yAxis:{title:{text:null},allowDecimals:!1,gridLineWidth:0,minorGridLineWidth:0,labels:{format:"{value}",formatter:function(){return Highcharts.numberFormat(this.value,0,"",",")}}},exporting:{buttons:{contextButton:{menuItems:[{text:"Print",onclick:function(){this.print()}},{text:"Save as PNG",onclick:function(){this.exportChart({type:"image/png"})},separator:!1}]}}},credits:!1,noData:{style:{fontWeight:"bold",fontSize:"18px",fontFamily:"Lato Bold",color:"#6b727a"}},lang:{noData:"No matching projects found to plot in the graph"}}}}])}),define("directives/b2b/analysis/graph",["app","text!views/directives/b2b/analysis/graph.html","services/b2b/GraphMappings","services/b2b/TrendService","services/b2b-constants","directives/common/pt-loading-block","directives/common/pt-interval","configs/widgetConfig"],function(a,b){a.directive("graph",["GraphMappings","TrendService","$filter","B2BConstants","$q","$timeout","$rootScope","$location","WidgetConfig",function(a,c,d,e,f,g,h,i,j){return{restrict:"EA",template:b,controller:["$scope",function(b){var i=h.userDetails.preference.preference,k=i.expandOtherProjects,l=i.yearType;b.catchmentId?b.catchment=a.CATCHMENT_ANALYSIS:b.catchment=a.BUILDER_ANALYSIS,b.timeInterval=angular.copy(e.TIME_INTERVAL);var m=b.timeInterval;m.DURATION[l.toUpperCase()].Monthly.period=[6,12,18,24],b.yearConstant=b.timeInterval.DURATION[l.toUpperCase()],b.intervalDefault={title:m.DURATION[l.toUpperCase()][m.DEFAULT_DURATION.type].title,period:m.DURATION[l.toUpperCase()][m.DEFAULT_DURATION.type].period[m.DEFAULT_DURATION.period],key:m.DURATION[l.toUpperCase()][m.DEFAULT_DURATION.type].key},e.GRAPH_SPLITS.budget.rangeValue=[i.budgetRange.globalCityMin,i.budgetRange.globalCityMax];var n,o,p,q,r,s,t,u,v,w,x,y=[],z=[],A=[],B=[],C=b.filterArr,D=function(){F($(".graph-area.last").offset().top)},E=function(){F($(".tags").offset().top)},F=function(a){$("html,body").animate({scrollTop:a-50},1e3)},G=function(a){p="group=",p+=a.join(",")},H=function(){y.push(w)},I=function(a,b){var c="";return _.each(a,function(a,d,e){if(a){var f="="!=a.fltrType&&"!"!=a.fltrType?"="+a.fltrType:a.fltrType;c=c+a.fltrKey+f+"="+a.fltrValue,d!=e.length-1&&(c+=b)}}),c},J=function(a,b,c){var d;if(a&&a.y)if(a.baseKey||(a.baseKey=a.y),d="area"==b.key?a.area:a.baseKey,c&&c.key)switch(c.key){case"FEET":a.y=d;break;case"METER":a.y="area"==b.key?d*Math.pow(.3048,2):d/Math.pow(.3048,2);break;case"YARD":a.y="area"==b.key?d*Math.pow(.333333,2):d/Math.pow(.333333,2);break;default:a.y=d}else a.y=d},K=function(a){var b="";return _.each(a,function(a,c,d){a&&(b=b+"("+a+")",c!=d.length-1&&(b+=";"))}),b},L=function(a){var b,c=_.groupBy(a,"key"),d="",e=[],f=["budget","completionDelayInMonth"];for(b in c){var g=_.pluck(c[b],"filter"),h=-1!=f.indexOf(b)?";":",";e.push(I(g,h))}return d=K(e),"filters="+d},M=function(a){var c=b.catchment.ordinate;c&&c.areaKey&&a.push(c.areaKey),c&&c.projectKey&&a.push(c.projectKey),r="fields=",r+=a.join(",")},N=function(a){s="sort=",s+=a.join(",")},O=function(a){a=a.map(function(a){return"-"+a}),N(a)},P=function(){o=w+"Duration=",o+=x},Q=function(){y=[],q="",z=[],A=[],B=[]},R=function(a){var c=a.data,d=[],f=b.catchment.prime,h=b.catchment.split,i=b.catchment.ordinate,k=b.catchment.measure,l=b.catchment.measureValue,m=h.key?b.drillForSplit:"Aggregate";b.drillForSplit=m,b.drillForMonth=t;var n;"quarter"==w&&(c=_.values(c)[0]);for(var o in c){var p;i.extraInfo?(p=c[o][0].extraAttributes[A[1]]/c[o][0].extraAttributes[A[0]],(!c[o][0].extraAttributes[A[0]]||isNaN(p))&&(p=null)):p=c[o][0].extraAttributes[A[0]],p&&(n=c[o][0].phaseName&&c[o][0].phaseName!==e.NO_PHASE?{y:p,name:c[o][0].builderName+" "+c[o][0].projectName+" ("+c[o][0].phaseName+")",projectName:c[o][0].builderName+" "+c[o][0].projectName+" ("+c[o][0].phaseName+")"}:{y:p,name:c[o][0].builderName+" "+c[o][0].projectName,projectName:c[o][0].builderName+" "+c[o][0].projectName},i&&i.areaKey&&(n.area=c[o][0].extraAttributes[i.areaKey]*p),d.push(n))}b.projectLength=d.length,_.each(d,function(a){J(a,k,l)}),d=_.sortBy(d,function(a){return-a.y});var q={xAxis:{categories:_.pluck(d,"projectName")},title:{text:b.catchment.ordinate.label+", "+m},subtitle:{text:t},tooltip:{valueDecimals:0},legend:{enabled:!1},series:[{name:b.catchment.ordinate.label,type:"column",data:d}]},r=$.extend(!0,{},j.GraphAnalysis,q);f.drillDownGraph&&(r.series[0].type="pie"),b.gettingDrillDown=!1,g(function(){r.chart.renderTo=$(".graph-drill-down")[0],new Highcharts.Chart(r),D()},10)},S=function(a){var f,g=new Date(a.month),h=b.catchment,i=h.split,j=h.split.key,k=(a.y,a.series.name,h.ordinate.key),m=(h.measure.key,[]);b.showDrillDown=!0,b.gettingDrillDown=!0,D(),b.drillForSplit=a.series.name,Q(),"quarter"==w&&H(),y.push("phaseId");var o=_.reject(C,function(a){return a.key===j});if(o&&o.length&&(z=z.concat(o)),"specificRange"==i.type){var u=a.rangeValue.split("-");u[0]&&z.push({key:i.rangeField,filter:{fltrType:"ge",fltrKey:i.rangeField,fltrValue:u[0]}}),u[1]?z.push({key:i.rangeField,filter:{fltrType:"lt",fltrKey:i.rangeField,fltrValue:u[1]}}):u.length=1}if("specificRange"!=i.type||"budget"==j){z.push({key:w,filter:{fltrType:"=",fltrKey:w,fltrValue:g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate()}});var v={yearType:l,frequency:w};t=d("dateFormatForGraphs")(g.getTime(),v),j&&"budget"!=j&&z.push({key:j,filter:{fltrType:"=",fltrKey:j,fltrValue:a.split}})}A.push(k),B.push(k),h.ordinate.extraInfo&&A.push(h.ordinate.extraInfo),A.push("projectName"),A.push("phaseName"),A.push("builderName"),b.catchmentId?f="delayPeriod"==i.key?c.getCTC(b.catchmentId):c.getCTH(b.catchmentId):(f="delayPeriod"==i.key?c.getTC():c.getTH(),z.push(n)),q=L(z),M(A),G(y),O(B),m.push(q),m.push(r),m.push(p),m.push(s),m.push("rows="+e.GROUP_PROJECT_COUNT),c.getData(f+"?"+m.join("&"),R)},T=function(a){var c,e,f,h,i,a=a.data,k=b.catchment.prime.graph,m=b.catchment.prime.graphPlot,n=[],o=[],p=(b.catchment.measure,b.catchment.ordinate,b.catchment.split),q=b.catchment.prime,c=[q.primaryField.label,q.secondaryField.label],r=[],s=[];if(b.graphDataCalled=!1,f=_.keys(a),"budget"!=p.key){_.each(f,function(b){var c,d,f,g,h=p.formatter?p.formatter(b):b,i=a[b];if(i){c=i[0].extraAttributes[q.primaryField.key],d=i[0].extraAttributes[q.secondaryField.key],f=i[0].extraAttributes.minSize,g=i[0].extraAttributes.maxSize;var j=[{y:c,split:q.primaryField.label},{y:d,split:q.secondaryField.label},{y:(c-d)/(c+d)*100,split:"Demand Gap (%age)"}],l={name:h,series:j};p&&"bedrooms"==p.key&&(l.minSize=f,l.maxSize=g)}n.push(l),e={type:k,name:h,data:j.slice(0,2)},o.push(e)});var t={yearType:l,frequency:w};b.timePoints=c,b.graphData=da(n,p.key,q.key);var u={xAxis:{categories:c},title:"",subtitle:"",series:o,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: ({point.percentage:.0f}%)<br/>',valueDecimals:0},plotOptions:{}},x=$.extend(!0,{},j.GraphAnalysis,u);v=x,m&&(x.plotOptions.column=m.column)}else{for(var y in a)r.push({range:y,data:a[y]});r=_.sortBy(r,function(a){return parseInt(a.range)});var z=_.pluck(r,"data"),B=["#2f7ed8","#0d233a","#8bbc21"];z&&_.each(z,function(a,b){var c,d=B[b];h=_.map(a,function(a){if(a){var b={month:a[0][w],rangeValue:a[0].rangeValue,y:a[0].extraAttributes[A[0]]};return c=a[0].rangeValue,b}return null}),h=_.sortBy(h,function(a){return parseInt(a.month)}),c&&(n.push({series:{name:p.formatter(c),series:h}}),e={type:k,id:p.formatter(c),name:p.formatter(c),color:d,data:h,stack:"Demand"},o.push(e)),i=_.map(a,function(a){if(a){var b={month:a[0][w],rangeValue:a[0].rangeValue,y:a[0].extraAttributes[A[1]]};return c=a[0].rangeValue,b}return null}),i=_.sortBy(i,function(a){return parseInt(a.month)}),c&&(n.push({name:p.formatter(c),series:i}),e={type:k,linkedTo:p.formatter(c),name:p.formatter(c),color:d,data:i,stack:"Sales"},o.push(e))});var t={yearType:l,frequency:w};_.each(r,function(a){s.push(_.keys(a.data))}),c=_.union.apply(_,s),c=_.sortBy(c,function(a){return a}),c=_.map(c,function(a){var b=p.abscissaFormatter?p.abscissaFormatter:d("dateFormatForGraphs");return b(a,t)}),b.timePoints=c;var u={xAxis:{categories:c},title:"",subtitle:"",series:o,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}</span>: ({point.percentage:.0f}%)<br/>',valueDecimals:0},plotOptions:{}},x=$.extend(!0,{},j.GraphAnalysis,u);v=x,m&&(x.plotOptions.column=m.column)}g(function(){x.chart.renderTo=$(".graph")[0],new Highcharts.Chart(x)},10)},U=function(a){for(var b in a)b&&"-"==b[0]&&delete a[b]},V=function(a){var c,f,h,a=a.data,i=b.catchment.prime.graph,k=b.catchment.prime.graphPlot,m=[],n=[],o=b.catchment.measure,p=o&&"percentage"==o.key,q=[],r=b.catchment.ordinate,s=b.catchment.split,t=b.catchment.prime,u=[];if(b.graphDataCalled=!1,"specificRange"==s.type&&"budget"!=s.key&&U(a),_.isEmpty(a))return void(b.errorMessage="Data Not Available");b.errorMessage="";for(var x in a)q.push({time:x,data:a[x]});if(q=_.sortBy(q,function(a){return parseInt(a.time)}),y.length>1||s&&"Projects"==s.label)h=_.pluck(q,"data"),_.each(h,function(a){u=_.union(u,_.keys(a))}),_.each(u,function(a){function b(a){return a?a.minSize:0}function c(a){return a?a.maxSize:0}var d,g=_.pluck(h,a);d=s.formatter?s.formatter(a):a;var j="";if("Projects"==s.label){var k=_.find(g,function(a){return a&&a[0]});d="Others"===k[0].projectName?"Others":k[0].phaseName===e.NO_PHASE?k[0].builderName+" "+k[0].projectName:k[0].builderName+" "+k[0].projectName+" ("+k[0].phaseName+")",j=k[0].builderName}var l=_.map(g,function(b){if(b&&b.length){var c,e=b[0].extraAttributes[A[0]],f=b[0][w];return c={month:f,rangeValue:b[0].rangeValue,y:e,formattedSplit:d,split:a,minSize:b[0].extraAttributes.minSize,maxSize:b[0].extraAttributes.maxSize},s&&"Projects"==s.label&&(c.split=b[0].projectName),r&&r.areaKey&&(c.area=b[0].extraAttributes[r.areaKey]*e),c}return null}),o={name:d,series:l};j&&(o.builderName=j),s&&"bedrooms"==s.key&&(o.minSize=b(_.min(l,function(a){return b(a)})),o.maxSize=c(_.min(l,function(a){return c(a)}))),m.push(o);var p=_.find(l,function(a){return a?a:void 0});f={type:i,name:p.formattedSplit,data:l},n.push(f)});else if(s&&"Customer Type"==s.label)u=[{key:"sumCustomerDemand",label:"End User Demand"},{key:"sumInvestorDemand",label:"Investor Demand"}],h=_.map(q,function(a){return a.data[0]}),_.each(u,function(a){var b=_.map(h,function(b){if(b){var c={month:b[w],y:b.extraAttributes[a.key],split:a.label};return c}return null});m.push({name:a.label,series:b}),f={type:i,name:b[0].split,data:b},n.push(f)});else if(s&&"budget"==s.key){var z=_.pluck(q,"data");z&&(z=z.reverse(),_.each(z,function(a){var c;h=_.map(a,function(a){if(a){var d={month:a[0][w],rangeValue:a[0].rangeValue,y:a[0].extraAttributes[A[0]],split:b.catchment.ordinate.label};return r&&r.areaKey&&(d.area=a[0].extraAttributes[r.areaKey]*a[0].extraAttributes[A[0]]),c=a[0].rangeValue,d}return null}),h=_.sortBy(h,function(a){
return parseInt(a.month)}),c&&(m.push({name:s.formatter(c),series:h}),f={type:i,name:s.formatter(c),data:h},n.push(f))}))}else h=_.map(_.pluck(q,"data"),function(a){if(a&&!_.isEmpty(a)){s&&"delayPeriod"==s.key&&(a=a[_.keys(a)[0]]);var c;if(r.extraInfo){var d=a[0].extraAttributes[A[1]]/a[0].extraAttributes[A[0]];(!a[0].extraAttributes[A[0]]||isNaN(d))&&(d=null),c={month:a[0][w],rangeValue:a[0].rangeValue,y:d,split:b.catchment.ordinate.label}}else c={month:a[0][w],rangeValue:a[0].rangeValue,y:a[0].extraAttributes[A[0]],split:b.catchment.ordinate.label};return r&&r.areaKey&&(c.area=a[0].extraAttributes[r.areaKey]*a[0].extraAttributes[A[0]]),c}return null}),m.push({name:b.catchment.ordinate.label,series:h}),f={type:i,name:b.catchment.ordinate.label,data:h},n.push(f);var B="Customer Type"==s.label?"comparison":s.key;if(b.graphData=da(m,B,t.key),"budget"!=s.key)c=_.pluck(q,"time");else{var C=[];_.each(q,function(a){C.push(_.keys(a.data))}),c=_.union.apply(_,C),c=_.sortBy(c,function(a){return a}),n&&(n=n.reverse())}var D={yearType:l,frequency:w};c=_.map(c,function(a){var b=s.abscissaFormatter?s.abscissaFormatter:d("dateFormatForGraphs");return b(a,D)}),b.timePoints=c;var E={xAxis:{categories:c},title:"",subtitle:"",series:n,tooltip:{valueDecimals:0},plotOptions:{series:{cursor:"normal",point:{events:{click:function(a){a.point&&"Inventory Overhang"!==a.point.split&&(S(a.point),b.toggleDrillDown(!0))}}}}}},F=$.extend(!0,{},j.GraphAnalysis,E);v=F,"price"==t.key&&(F.tooltip={crosshairs:!0,valueDecimals:0,pointFormat:'<span style="color:{series.color}">{series.name}</span>: ₹{point.y}<br/>'},F.yAxis.labels={formatter:function(){return"₹"+Highcharts.numberFormat(this.value,0,"",",")}}),(y.length>1&&"price"!=t.key||"budget"==s.key)&&(F.plotOptions.column={stacking:"normal"}),s&&"Projects"==s.label&&(F.plotOptions.series.point.events={},F.plotOptions.series.cursor="normal",F.plotOptions.column={stacking:"normal"}),k&&(F.plotOptions.column=k.column),p&&(F.tooltip={pointFormat:'<span style="color:{series.color}">{series.name}</span>: ({point.percentage:.0f}%)<br/>',valueDecimals:0}),s.key||"Customer Type"==s.label||(F.legend={enabled:!1}),g(function(){F.chart.renderTo=$(".graph")[0],new Highcharts.Chart(F)},10)};b.getGraphData=function(){var a,d,g=b.catchment.ordinate,h=b.catchment.split,i=b.catchment.measure,j=b.catchment.prime,l=[];if(b.showDrillDown=!1,b.graphDataCalled=!0,b.catchment.prime.measures&&(b.catchment.measure=b.catchment.prime.measures[0],b.catchment.measure.values&&(b.catchment.measureValue=b.catchment.measure.values[0])),Q(),C&&C.length&&(z=z.concat(C)),"comparison"==j.type&&(A.push(j.primaryField.key),A.push(j.secondaryField.key)),g&&g.key&&(g.baseKey?(A.push(g.baseKey),z.push({key:g.helperKey,filter:{fltrType:"ge",fltrKey:g.helperKey,fltrValue:6}})):g.key&&(A.push(g.key),g.extraInfo&&A.push(g.extraInfo))),h.extraInfo&&(A.push(h.extraInfo),A.push(w)),b.catchmentId?a="delayPeriod"==h.key?c.getCTC(b.catchmentId):c.getCTH(b.catchmentId):(a="delayPeriod"==h.key?c.getTC():c.getTH(),z.push(n)),z.length&&(q=L(z)),d=z,h&&"Projects"==h.label){i.key&&"percentage"!=i.key?B.push(i.key):B.push(g.key),O(B),l.push(s),k&&"0"!==k||(u="rows="+e.PROJECT_SPLIT_COUNT,l.push(u));var m=function(b){var e,g,i;y=[];var j=_.keys(b.data),k=[],m=[];_.each(j,function(a){k.push({key:"phaseId",filter:{fltrType:"=",fltrKey:"phaseId",fltrValue:a}}),m.push({key:"phaseId",filter:{fltrType:"!",fltrKey:"phaseId",fltrValue:a}})}),l=_.without(l,q),l=_.without(l,r),l=_.without(l,"group=phaseId"),l=_.without(l,p),l=_.without(l,s),l=_.without(l,u),A.push("projectName"),A.push("builderName"),A.push("phaseName"),k=k.concat(d),i=L(k),H(),h&&h.key&&y.push(h.key),A=_.uniq(A),G(y),M(A),P(),l.push(i),l.push(p),l.push(r),e=c.getData(a+"?"+l.join("&")),y=[],l=_.without(l,p),l=_.without(l,i),H(),G(y);var n=L(d),o=I(_.pluck(m,"filter"),";");o&&(i=n+";"+o),l.push(i),l.push(p),g=c.getData(a+"?"+l.join("&")),f.all([e,g]).then(function(a,b,c){var d=a[0].data.data,e=a[1].data.data;if(!_.isEmpty(e))for(var f in d)e[f]&&_.isArray(e[f])&&(d[f].others=e[f],d[f].others[0].projectName="Others");V({data:d})})};h&&h.key&&y.push(h.key),G(y),P(),l.push(q),l.push(r),l.push(p),l.push(o),c.getData(a+"?"+l.join("&"),m)}else{if(("comparison"!=j.type||"bedrooms"!=h.key)&&H(),"specificRange"==h.type){l.push("rangeField="+h.rangeField);for(var t=[],v=0;v<h.rangeValue.length;v++)h.rangeValue[v]?t.push(parseInt(h.rangeValue[v])):t.push(h.rangeValue[v]);l.push("rangeValue="+t.join())}else h.key&&y.push(h.key),P(),l.push(o);"budget"!=h.key||"comparison"==j.type&&"Sales Vs Demand"!=j.label||(P(),l.push(o)),M(A),G(y),l.push(r),z.length&&q&&l.push(q),y.length&&l.push(p),"comparison"==j.type?c.getData(a+"?"+l.join("&"),T):c.getData(a+"?"+l.join("&"),V)}ca()},b.assignSplit=function(a){a?(b.catchment.splits=a,b.catchment.split=a[0]):(b.catchment.splits=b.catchment.prime.splits,b.catchment.split=b.catchment.prime.splits[0])},b.builderId&&(n={key:"builderId",filter:{fltrType:"=",fltrKey:"builderId",fltrValue:b.builderId}});var W=function(a){b.catchment.ordinate=a.ordinates[0],a.measures?(b.catchment.measure=a.measures[0],a.measures[0].values&&(b.catchment.measureValue=b.catchment.measure.values[0])):(b.catchment.measure=void 0,b.catchment.measureValue=void 0),b.assignSplit(a.splits)};b.$watch("catchment.prime",function(a,c){a&&a!=c&&(W(a),b.getGraphData(b.catchment.ordinate))}),b.catchment.prime=b.catchment[0].primes[0],W(b.catchment.prime),b.durationChanged=function(a){w=a.type,x=a.months,b.catchment.ordinate&&(E(),b.getGraphData())};var X=function(){C=b.filterArr;var a=b.filters;for(var c in a){var d=a[c];switch(d.type){case"equal":_.each(d.options,function(a){ba(a,d.key)});break;case"range":Y(d)}}},Y=function(a){var c=b.mapping[a.key];if(c)if(C=_.reject(C,function(a){return c==a.key}),a.options){var d=_.find(a.options,function(a){return 1==a.selected});d&&(C=_.reject(C,function(a){return a.key==c}),Z(d,c))}else a.active&&Z(a,c)},Z=function(a,b){a.from&&C.push({key:b,filter:{fltrType:"ge",fltrKey:b,fltrValue:parseInt(a.from)}}),a.to&&C.push({key:b,filter:{fltrType:"le",fltrKey:b,fltrValue:parseInt(a.to)}})},aa=function(a,c){var d=b.mapping[c];if(d){var e=_.find(C,function(b){return b.option==a&&d==b.key});e||(a.values?_.each(a.values,function(b){C.push({option:a,key:d,filter:{fltrType:"=",fltrKey:d,fltrValue:b}})}):C.push({option:a,key:d,filter:{fltrType:"=",fltrKey:d,fltrValue:a.key}}))}},ba=function(a,b){a.selected?aa(a,b):C=_.reject(C,function(c){return c.option==a&&b==c.key})},ca=function(){var a,d=0,e=[],f=function(a){d=b.first(a.data,"countDistinctProjectId"),d instanceof Array&&!d.length&&(d=0),h.matchingProjects=d};b.catchmentId?(a=c.getCTC(b.catchmentId),$.extend(!0,e,C)):b.builderId?(a=c.getTC(),$.extend(!0,e,C,n),e=C.concat(n)):(a=c.getTC(),$.extend(!0,e,C,n)),q=L(e),a+=e.length?"?"+q+"&":"?",c.getData(a+"fields=countDistinctProjectId&group=month",f)};b.$on("FiltersUpdate",function(a,c){w&&!c.hasPathChanged&&(X(),b.getGraphData())}),b.toggleDrillDown=function(a){b.drillDownClosed?($(".graph-area.last").slideDown(),D()):a||$(".graph-area.last").slideUp(),b.drillDownClosed=a?!1:!b.drillDownClosed},b.first=function(a,b){if(a){var c=_.keys(a);return c.length?b?a[c[0]][0].extraAttributes[b]:_.pluck(a[c[0]],"month"):[]}return[]},b.justConvertData=function(a,c){var d=v.series;b.catchment.ordinate,b.showDrillDown=!1,_.each(d,function(b){var d=b.data;_.each(d,function(b){J(b,a,c)})}),"bedrooms"==b.catchment.split.key&&_.each(b.graphData,function(b){switch(b.baseMinSize||(b.baseMinSize=b.minSize,b.baseMaxSize=b.maxSize),c.key){case"FEET":b.minSize=b.baseMinSize,b.maxSize=b.baseMaxSize;break;case"METER":b.minSize="area"==a.key?b.baseMinSize*Math.pow(.3048,2):b.baseMinSize/Math.pow(.3048,2),b.maxSize="area"==a.key?b.baseMaxSize*Math.pow(.3048,2):b.baseMaxSize/Math.pow(.3048,2);break;case"YARD":b.minSize="area"==a.key?b.baseMinSize*Math.pow(.333333,2):b.baseMinSize/Math.pow(.333333,2),b.maxSize="area"==a.key?b.baseMaxSize*Math.pow(.333333,2):b.baseMaxSize/Math.pow(.333333,2);break;default:b.minSize=b.baseMinSize,b.maxSize=b.baseMaxSize}b.minSize&&(b.minSize=parseInt(b.minSize)),b.maxSize&&(b.maxSize=parseInt(b.maxSize))}),v.chart.renderTo=$(".graph")[0],new Highcharts.Chart(v)},b.activateSplit=function(a){b.catchment.split=a,b.getGraphData(b.catchment.ordinate)};var da=function(a,b,c){var d,e=["unitType","bedrooms","budget","comparison"],f=["sumCustomerDemand","sumDemand"],g={},h={};return-1==_.indexOf(f,c)?a:_.indexOf(e,b)>-1?(_.each(a,function(a){_.each(a.series,function(a){null!==a&&(d="sumCustomerDemand"==c?a.month:a.split,!_.isArray(g[d])&&a.y&&(g[d]=[0]),a.y&&_.isArray(g[d])&&g[d].push(a.y))})}),_.each(g,function(a,b){var c=0,d=0;a.length>0?(_.each(a,function(a,b){c+=a}),d=100/c,d&&_.each(a,function(a,c){_.isArray(h[b])||(h[b]=[]),h[b][a]=a*d})):0==a.length&&(h[b]=[],h[b][0]=100)}),_.each(a,function(b,e){_.each(b.series,function(b,f){null!==b&&(d="sumCustomerDemand"==c?b.month:b.split),b&&h[d]?a[e].series[f].y=h[d][b.y]:a[e].series[f]&&(a[e].series[f].y=0)})}),a):void 0}}]}}])}),define("text!views/directives/filters/budget.html",[],function(){return'<div class="dropdown-toggle searchDropInfo">\n    <span data-ng-if=\'filter.active\' ng-bind-html="filter.tempLabel">\n    </span>\n    <span data-ng-if=\'!filter.active\'> {{filter.label}} </span>\n    <i class="pt pt-icon-angle-down iconArrow" data-ng-if=\'filter.dropdown\'></i>\n</div>\n<div data-ga-event="gaEvent" pt-rangemanager data-ga-category="gaCategory" filter="filter"></div>'}),define("text!views/directives/common/pt-rangemanager.html",[],function(){return'<ul class="rightTopClick" ng-click="$event.stopPropagation()" data-ng-class="{\'clickListInfo\' : filter.dropdown, \'disable\' : filter.fromurl}">\n    <li>\n        <div class="dualBoxInfo">\n            <div class="budgetBoxInfo">\n                <i data-ng-if="filter.key == \'primaryOrResaleBudget\'" class="pt pt-icon-inr"></i>\n                <input ng-readonly="filter.fromurl" data-ng-model="filter.tmpFrom" data-ng-keyup="onMinValueEnter(filter.tmpFrom, $event)" data-ng-focus="showMaxRange=false" type="text" placeholder="Min">\n            </div>\n            <div class="budgetLineInfo">&nbsp;</div>\n            <div class="budgetBoxInfo">\n                <i data-ng-if="filter.key == \'primaryOrResaleBudget\'" class="pt pt-icon-inr"></i>\n                <input ng-readonly="filter.fromurl" data-ng-model="filter.tmpTo" ng-keydown="sendRequest($event)" data-ng-keyup="onMaxValueEnter(filter.tmpTo, $event)" data-ng-focus="showMax()" type="text" placeholder="Max">\n            </div>\n        </div>\n        <div class="dualBoxInfo switContInfo">\n            <div class="switDataContInfo minContInfo" data-ng-class="{\'selected\': !showMaxRange}">\n                <div class="switRowContInfo"\n                     data-ng-click="minRangeSelected(item.value)"\n                     data-ng-class="{\'active\' : item.value==from}"\n                     data-ng-repeat="item in filter.range.min">\n                    <i data-ng-if="filter.key == \'primaryOrResaleBudget\'" class="pt pt-icon-inr"></i> {{item.value | priceFormat : null:null:\' L\':null:2}}</div>\n            </div>\n            <div class="switDataContInfo maxContInfo" data-ng-class="{\'selected\': showMaxRange}">\n                <div class="switRowContInfo"\n                     data-ng-class="{\'active\' : item.value==to}"\n                     data-ng-click="maxRangeSelected(item.value)"\n                     data-ng-repeat="item in filter.range.max">\n                    <div ng-if="item.value != \'Any\'">\n                        <i data-ng-if="filter.key == \'primaryOrResaleBudget\'" class="pt pt-icon-inr"></i>\n                        {{item.value | priceFormat : null:null:\' L\':null:2}}\n                    </div>\n                    <div ng-if="item.value == \'Any\'">{{item.value}}</div>\n                </div>\n            </div>\n        </div>\n    </li>\n</ul>\n'}),define("directives/common/pt-rangemanager",["app","text!views/directives/common/pt-rangemanager.html","formatters/common"],function(a,b){a.directive("ptRangemanager",["$timeout","GoogleAnalyticsService",function(a,c){return{restrict:"A",template:b,scope:{filter:"=",gaCategory:"=",gaEvent:"="},controller:["$scope","$rootScope","Formatter",function(b,d,e){b.showMax=function(){b.filter.fromurl||(b.showMaxRange=!0)},b.disabled=!0,b.from=b.filter.from,b.to=b.filter.to,b.amountAny=!1,b.amountZero=!1,b.$on("budgetFilterReset",function(){b.from=b.filter.from,b.to=b.filter.to});var f=function(a,b){switch(a){case 75:b=b.replace(/[k|K]/,"000");break;case 76:b=b.replace(/[l|L]/,"00000");break;case 67:b=b.replace(/[c|C]/,"0000000")}return b};b.onMinValueEnter=function(c,g){b.filter.fromurl||(b.amountZero=0==c?!0:!1,g&&(c=f(g.keyCode,c)),0!==c&&""!==c&&(c=parseInt(c.toString().split(",").join(""))),0===c?(b.filter.from="0",b.filter.tmpFrom="0"):isNaN(c)?(b.filter.from="",b.filter.tmpFrom="",b.filter.active=!0):(b.filter.from=""==c?"":parseInt(c.toString().split(",").join("")),b.filter.tmpFrom=e.formatPriceWithComma(b.filter.from),""!=b.filter.to&&parseInt(b.filter.from)>parseInt(b.filter.to)&&b.onMaxValueEnter("Any",!0)),d.$broadcast("minRangeSelected",b.filter)),g&&13==g.keyCode&&a(function(){angular.element('input[data-ng-model="filter.tmpTo"]').focus(),b.showMaxRange=!0})},b.onMaxValueEnter=function(a,g){b.filter.fromurl||("Any"==a?(b.amountAny=!0,b.filter.amountAny=!0):(b.amountAny=!1,b.filter.amountAny=!1),g&&g.keyCode&&(a=f(g.keyCode,a)),"Any"!==a&&""!==a&&(a=parseInt(a.toString().split(",").join(""))),"Any"===a?(b.filter.to="",b.filter.tmpTo="Any"):isNaN(a)&&""!=a?(b.filter.to="",b.filter.tmpTo="",b.filter.active=!0):(b.filter.to=""==a?"":parseInt(a.toString().split(",").join("")),b.filter.tmpTo=e.formatPriceWithComma(b.filter.to)),d.$broadcast("maxRangeSelected",b.filter)),g||(""!==b.filter.to&&parseInt(b.filter.from)>parseInt(b.filter.to)&&b.onMaxValueEnter("Any"),b.applyFilter()),c.gaEventSelectPropertyType(b.filter,b.gaCategory,b.gaEvent)},b.minRangeSelected=function(c){b.filter.fromurl||a(function(){angular.element('input[data-ng-model="filter.tmpTo"]').focus(),b.showMaxRange=!0,b.onMinValueEnter(c)})},b.maxRangeSelected=function(a){b.filter.fromurl||b.onMaxValueEnter(a)},b.applyFilter=function(){b.filter.to==b.to&&b.filter.from==b.from||!(b.filter.tmpTo||b.filter.tmpFrom||b.amountAny||b.amountZero)||(b.filter.active=!1,b.filter.scrollAmount=!1,a(function(){angular.element(".flitClickInfo.open").length>0&&$(document).trigger("click")}),b.from=b.filter.from,b.to=b.filter.to,b.disabled=!0,b.amountAny=!1,b.amountZero=!1,d.$broadcast("filterChanged",null,b.filter),b.showMaxRange=!1)},b.sendRequest=function(a){(9==a.keyCode||13==a.keyCode)&&(""!==b.filter.to&&parseInt(b.filter.from)>parseInt(b.filter.to)&&b.onMaxValueEnter("Any"),b.applyFilter())}}]}}])}),define("directives/filters/budget",["app","text!views/directives/filters/budget.html","directives/common/pt-rangemanager"],function(a,b){a.directive("budget",["$rootScope","$location",function(a,c){return{restrict:"A",scope:{filter:"=",gaCategory:"@?",gaEvent:"@?"},template:b}}])}),define("text!views/directives/filters/equal-type.html",[],function(){return'<div ng-class="{\'dropdown-toggle\' : isdropdown}" class="searchDropInfo dropdown-toggle">\n    <span data-ng-if=\'filter.activeCount && isdropdown\'> \n        {{filter.tempLabel}}\n    </span>\n    <span data-ng-if=\'!filter.activeCount && isdropdown\'> {{filter.label}} </span>\n    <label data-ng-if=\'!isdropdown\'> {{filter.label}} </label>\n    <i class="pt pt-icon-angle-down iconArrow" data-ng-if=\'isdropdown\'></i>\n</div>\n<ul class="rightTopClick" data-ng-class="{\'filtClickListInfo\' : isdropdown, \'filtMoreContInfo\' : !isdropdown}">\n    <li class="checkboxInfo" data-ng-repeat="option in filter.options" data-ng-class="{\'active\': option.selected || option.selectedFromUrl, \'disable\':option.disable || option.disabledFromUrl}" data-ng-click="filterChanged(option, $event)">\n        <span class="checkIconInfo">\n            <i class="pt pt-icon-square-o"></i>\n            <i class="pt pt-icon-check-square-o"></i>\n        </span>\n        <label>{{option.label}}</label>\n    </li>\n</ul>'}),define("directives/filters/equal-type",["app","text!views/directives/filters/equal-type.html"],function(a,b){a.directive("equalType",["$rootScope","$location","GoogleAnalyticsService",function(a,c,d){return{restrict:"A",scope:{filter:"=",showDropdown:"=?",gaEvent:"@?",gaCategory:"@?"},template:b,controller:["$scope","$rootScope",function(a,b){var e=a.filter;c.search(),a.isdropdown=e.dropdown,0==a.showDropdown?a.isdropdown=!1:1==a.showDropdown&&(a.isdropdown=!0),a.filterChanged=function(c,f){f.stopPropagation(),d.gaEventSelectEqualType(a.gaEvent,a.gaCategory,c),c.disable||c.disabledFromUrl||b.$broadcast("filterChanged",c,e)}}]}}])}),define("controllers/b2b/catchmentAnalysisCtrl.b1931a01",["app","services/catchmentService","directives/b2b/analysis/graph","directives/filters/budget","directives/filters/equal-type"],function(a){a.controller("catchmentAnalysisCtrl",["$scope","$rootScope","$stateParams","$location","CatchmentService",function(a,b,c,d,e){a.catchmentId=c.catchmentId,b.currentCatchment={},a.saveCatchment=function(){b.currentCatchment.state="new",b.$broadcast("saveCatchment")},a.backToCatchment=function(){d.url(b.currentCatchment.attr.url)},function(){b.currentCatchment.id!=a.catchmentId?e.getCatchment(a.catchmentId,function(a){if(a&&a.length){for(var c=[],d=a[0],e=0,f=d.catchmentProjects.length;f>e;e++)c.push(d.catchmentProjects[e].projectId);b.currentCatchment={name:d.name,id:d.id,state:"new",projIds:c,status:d.status,attr:d.metaAttributes}}}):b.currentCatchment.state="new"}()}])});