define("services/b2b/OtpService",["app"],function(a){a.factory("OtpService",["$http",function(a){var b=function(){return a({method:"GET",url:"app/v1/otp"}).then(function(a){return a})},c=function(b){return a({method:"POST",url:"app/v1/otp/validate",data:b,header:{"Content-type":"application/x-www-form-urlencoded"}}).then(function(a){return a})};return{resendOtp:b,submitOtp:c}}])}),define("parsers/gridParser",["app"],function(a){a.factory("GridParser",[function(){return{parse:function(a,b){for(var c=[],d=function(b,c){a.indexOf(b)>-1&&(g[b]=c)},e=0;e<b.length;e++){var f=b[e],g={};$.each(f,d),c.push(g)}return c}}}])}),define("parsers/recentlyViewedParser",["app"],function(a){a.factory("RecentlyViewedParser",[function(){return{parse:function(a,b,c){var d,e=function(a){var b;return b=a>=1e7||-1e7>=a?Math.round(100*a/1e7)/100+"Cr":a>=1e5||-1e5>=a?Math.round(100*a/1e5)/100+"L":a},f={},g=[];for(d=0;d<a.length;d++){var h=a[d];f[a[d].projectId]={projectId:h.projectId,projectName:h.builder.name+", "+h.name,projectLocation:h.address,pricePerSqft:"undefined"==typeof h.minPricePerUnitArea||"undefined"==typeof h.maxPricePerUnitArea?"-":h.minPricePerUnitArea+" / sq ft - "+h.maxPricePerUnitArea+" / sq ft",price:"undefined"==typeof h.minPrice||"undefined"==typeof h.maxPrice?"-":e(h.minPrice)+" - "+e(h.maxPrice),projectUrl:h.URL,imageURL:h.imageURL,city:h.locality.suburb.city.label,locality:h.locality.label,minResaleOrPrimaryPrice:h.minResaleOrPrimaryPrice,maxResaleOrPrimaryPrice:h.maxResaleOrPrimaryPrice,hasPriceOnRequest:h.hasPriceOnRequest,compProject:h,cityId:h.cityId}}for(c>b.length&&(c=b.length),d=0;c>d;d++)f[b[d]]&&g.push(f[b[d]]);return g}}}])}),define("services/userService",["app","parsers/gridParser","formatters/common","parsers/recentlyViewedParser","services/notificationService","services/b2b/CookieService"],function(a){a.config(["$httpProvider",function(a){delete a.defaults.headers.common["X-Requested-With"]}]).factory("UserService",["$http","$cookies","$q","$rootScope","$location","GlobalService","GridParser","Formatter","RecentlyViewedParser","NotificationService","CookieService",function(a,b,c,d,e,f,g,h,i,j,k){var l="",m=function(a,b){if(a){b||(b=0);var c=a.toString(),d=k.get("RECENTLY_VIEWED_2");if(d){var e=d.split("-"),f=e.indexOf(c);0!==f&&(-1!==f&&e.splice(f,1),e.unshift(c)),e=e.slice(0,10),c=e.join("-")}k.set("RECENTLY_VIEWED_2",c)}},n=function(a,b){var d=[],e=k.get("RECENTLY_VIEWED_2");if(e&&(l=_.map(e.split("-"),function(a){return a=a.split(","),d[a[0]]=a[1],a[0]}).filter(function(a){return a.toString().trim()})),l){var h='data/v1/entity/project?selector={"filters":{"and":[{"equal":{"projectId":['+l.join(",")+']}}]},"fields":["cityId","projectId","localityId","name","builder","address","URL","maxPrice","minPrice","minResaleOrPrimaryPrice","maxResaleOrPrimaryPrice","minPricePerUnitArea","maxPricePerUnitArea","imageURL","locality","label","suburb","city","hasPriceOnRequest"]}';return f.makeGetCall(h,!1,!0,!0,!0).then(function(c){var e=i.parse(c.data.data,l,b);return e=_.map(e,function(a){return d[a.projectId]?a.typeId=d[a.projectId]:a.typeId=0,a}),a?g.parse(a,e):e})}var j=c.defer();return j.resolve([]),j.promise},o=function(a){return f.makeGetCall("data/v1/entity/user/{userId}/enquired-property",!1,!0,!0).then(function(b){return $.each(b.data.data,function(a,c){b.data.data[a].url="/"+c.projectUrl,b.data.data[a].name="Visit",c.cityName&&!c.projectName&&(b.data.data[a].url=c.cityName.replace(" ","-").toLowerCase()+"-real-estate",b.data.data[a].projectName="NA")}),g.parse(a,b.data.data)})},p=function(a,b){var c={username:a.trim(),password:b};return f.makePostCall("app/v1/login",c,"",!1,!0)},q=function(a,b,c,d,e){var g={fullName:a.trim(),password:d,confirmPassword:d,email:b,countryId:e,contactNumbers:[{contactNumber:c}]};return f.makePostCall("app/v1/register",g,"application/json",!0,!0)},r=function(a){return f.makePostCall("app/v1/reset-password?email="+encodeURIComponent(a),!1,"application/json",!1,!0)},s=function(a,b){return d.isProvider=!0,f.makePostCall("app/v1/login/"+b,a).then(function(a){return t(a),f.returnUserResp(a)})},t=function(a){if(a&&a.firstName){a.USERNAME=a.firstName+(a.lastName?a.lastName:""),a.CONTACT=a.contactNumber,a.EMAIL=a.email,a.COUNTRY_ID=a.countryId,d.userDetails=a;var b="Hi "+a.USERNAME+"! You have logged in successfully.";d.$broadcast("userLoggedIn"),d.$broadcast("$signupRes"),j.setNotification({msg:b,type:"info"})}},u=function(b){return a({method:"POST",url:"app/v1/login",data:$.param(b),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){return a})},v=function(a){var b="data/v1/entity/user/change-password";return f.makePostCall(b,a,-1,!0,!0,!0)};return{userLogin:p,userRegister:q,resetPassword:r,userInfo:t,checkUser:s,getRecentlyViewed:n,setRecentlyViewed:m,getEnquiredProperty:o,loginB2b:u,changePassword:v}}])}),define("services/b2b/ForgotPasswordService",["app"],function(a){a.factory("ForgotPasswordService",["$http",function(a){var b=function(a){return window.encodeURIComponent?window.encodeURIComponent(a):a},c=function(c){return a.post("/app/v1/reset-password?email="+b(c))};return{forgotPassword:c}}])}),define("controllers/b2b/login.5d9fb35a",["app","services/constants","services/b2b-constants","services/citiesService","services/b2b/OtpService","services/userService","services/b2b/userDetails","services/b2b/TermsAndConditionService","services/b2b/ForgotPasswordService"],function(a){a.controller("loginCtrl",["$rootScope","$scope","$http","$location","Constants","B2BConstants","CityService","OtpService","UserService","$q","userDetails","TermsAndConditionService","ForgotPasswordService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.disableLogin=!1,b.disableButton=!1,b.forgotPasswordMessage={show:!1,text:""},b.user={email:""},b.$on("badCredentials",function(a,c){b.badCredentials=!0,b.badCredentialsMessage=c.error.msg,b.password=""}),b.$on("unknownLoginIP",function(a,c){b.description=c.error.msg}),b.resendOtp=function(){b.disableButton=!0,h.resendOtp().then(function(a){b.disableButton=!1,b.description="New OTP has been sent to your registered email"})},b.otpSubmit=function(){b.otpCode&&(b.disableButton=!0,b.description="",n(h.submitOtp(b.otpCode.trim())))},b.signInSubmit=function(a,c){b.disableLogin=!0,a||(a=document.getElementById("username").value),c||(c=document.getElementById("password").value);var d={username:a,password:c,rememberme:!1};n(i.loginB2b(d))},b.forgotPassword=function(){r();var a=b.user.email;return a.trim()?void m.forgotPassword(a).then(p):void q("User Name left blank")},b.forgotPasswordCancel=function(){r(),d.path("/login")};var n=function(a){j.all([a,g.getLoggedInUserCities()]).then(function(a){var c=a[0],d=a[1],e=!0;b.disableLogin=!1,b.disableButton=!1,!c||200!==c.status||c&&c.data&&"4XX"==c.data.statusCode?b.description="Invalid OTP":200===c.status&&c.data&&c.data.data&&!_.isEmpty(c.data.data.appDetails.B2B)&&(g.getLoggedInUserCities(e),k.updateRootUserDetail(c,d),b.badCredentials=!1,l.verifyTermsAndCondition().then(o))})},o=function(a){a.termsAndConditionAccept?l.resolveNavigation():d.path("/terms-and-condition"),g.getLoggedInUserCities()},p=function(a){a.data&&a.data.data?(q(a.data.data),b.user.email=""):q(a.data&&a.data.error&&a.data.error.msg?a.data.error.msg:"Please try again after sometime.")},q=function(a){b.forgotPasswordMessage={show:!0,text:a}},r=function(){b.forgotPasswordMessage={show:!1,text:""}}}])});