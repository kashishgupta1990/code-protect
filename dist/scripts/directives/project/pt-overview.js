define(["app","text!views/directives/project/overview.html","services/constants","services/localityService","directives/common/pt-discussions","directives/common/pt-rating"],function(a,b){a.directive("ptProjectoverview",[function(){return{restrict:"A",template:b,controller:["$scope","$element","$attrs","Constants","$rootScope","LocalityService","ProjectService",function(a,b,c,d,e,f,g){a.$watch("project",function(b,c){if(b&&!angular.equals(b,c)){a.val=a.project,f.getRatingOnly(a.project.localityId).then(function(b){a.localityRatings={},a.locationRating="Not rated",a.safetyRating="Not rated",a.transportRating="Not rated",a.restRating="Not rated",a.localityRatingsLength=0,b&&_.keys(b.avgRatingsByCategory).length>0&&((b.numberOfUsersByRating||b.averageRating||b.ratingsCount)&&(a.localityRatings={numberOfUsersByRating:b.numberOfUsersByRating,averageRating:b.averageRating,ratingsCount:b.ratingsCount}),a.localityRatingsLength=_.keys(a.localityRatings).length),e.$broadcast("ratingChanged",b)}),a.val.possessionDateTstamp&&new Date(a.val.possessionDateTstamp)<new Date?a.possessionString="COMPLETED":a.possessionString="POSSESSION";var g=[];for(var h in a.val.neighborhood)a.val.neighborhood[h].count>0&&g.push(a.val.neighborhood[h]);a.val.neighborhood=g,c.projectId&&b.projectId===c.projectId||(a.moreFlag=!1),a.showStatusRibbon=!1,a.updateFlag=function(b){a.moreFlag=b},a.expandAmenities=function(){e.$broadcast("expand_amenities")},d.VALID_PROJECT_STATUS.indexOf(a.val.projectStatus)>-1&&(a.showStatusRibbon=!0),a.project.amenities&&a.project.amenities.length>0?(a.amenityLength=a.project.amenities?a.project.amenities.slice(0,-1).length+a.project.amenities.slice(-1)[0].amenityDisplayName.split(", ").length:0,a.amenitiesAvailable=a.project.amenities.slice(0,-1),a.amenitiesAvailableDisplay=a.amenitiesAvailable.slice(0,6)):a.amenityLength=0,a.showNeighborhood=_.keys(a.val.neighborhood).length>0,"On Hold"==a.val.projectStatus?a.availability="None":a.val.isSoldOut?a.availability="Only available in Resale":a.val.isPrimary&&a.val.isResale?a.availability="Available from Builder as well as in Resale":a.val.isPrimary&&!a.val.isResale?a.availability="Only available from Builder":!a.val.isPrimary&&a.val.isResale&&(a.availability="Only available in Resale")}},!0),a.isPropertyPage||a.isResalePropertyPage||a.$watch("seoData.h2",function(b,c){b&&g.getPropguideLink(b).then(function(b){b.length&&(a.propGuideLink=b[0].guid)})}),a.propGuideClicked=function(){}}],link:function(a,b,c){}}}])});