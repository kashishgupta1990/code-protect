test("backend",function(){ok(!!$.jStorage.currentBackend(),$.jStorage.currentBackend())}),test("flush/index",function(){ok($.jStorage.flush()),$.jStorage.set("test","value"),deepEqual($.jStorage.index(),["test"]),ok($.jStorage.flush()),deepEqual($.jStorage.index(),[]),ok(!$.jStorage.get("test"))}),module("set"),test("missing",function(){ok(null===$.jStorage.get("test")),$.jStorage.flush()}),test("use default",function(){$.jStorage.set("value exists","value"),ok("def"===$.jStorage.get("no value","def")),ok("value"===$.jStorage.get("value exists","def")),$.jStorage.flush()}),test("string",function(){ok("value"==$.jStorage.set("test","value")),ok("value"==$.jStorage.get("test")),$.jStorage.flush()}),test("boolean",function(){ok($.jStorage.set("test true",!0)===!0),ok($.jStorage.get("test true")===!0),ok($.jStorage.set("test false",!1)===!1),ok($.jStorage.get("test false")===!1),$.jStorage.flush()}),test("number",function(){ok(10.01===$.jStorage.set("test",10.01)),ok(10.01===$.jStorage.get("test")),$.jStorage.flush()}),test("obejct",function(){var e={arr:[1,2,3]};deepEqual($.jStorage.set("test",e),e),deepEqual($.jStorage.get("test"),e),ok($.jStorage.get("test")!=e),$.jStorage.flush()}),asyncTest("XML",function(){var e;expect(3),e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&(ok($.jStorage.set("jskey_xml",e.responseXML)),ok($.jStorage.get("jskey_xml")!=e.responseXML),ok("Pealkiri"==$.jStorage.get("jskey_xml").getElementsByTagName("title")[0].firstChild.nodeValue),$.jStorage.flush(),start())},e.open("GET","data.xml",!0),e.send()}),asyncTest("TTL",function(){expect(2),$.jStorage.set("ttlkey","value",{TTL:500}),setTimeout(function(){ok("value"==$.jStorage.get("ttlkey")),setTimeout(function(){ok(null===$.jStorage.get("ttlkey")),$.jStorage.flush(),start()},500)},250)}),module(),asyncTest("setTTL",function(){expect(2),$.jStorage.set("ttlkey","value"),$.jStorage.setTTL("ttlkey",500),setTimeout(function(){ok("value"==$.jStorage.get("ttlkey")),setTimeout(function(){ok(null===$.jStorage.get("ttlkey")),$.jStorage.flush(),start()},500)},250)}),asyncTest("getTTL",function(){expect(2),$.jStorage.set("ttlkey","value",{TTL:500}),setTimeout(function(){ok($.jStorage.getTTL("ttlkey")>0),setTimeout(function(){ok(0===$.jStorage.getTTL("ttlkey")),$.jStorage.flush(),start()},500)},250)}),test("deleteKey",function(){deepEqual($.jStorage.index(),[]),$.jStorage.set("test","value"),deepEqual($.jStorage.index(),["test"]),ok($.jStorage.deleteKey("test")),ok(!$.jStorage.deleteKey("test")),deepEqual($.jStorage.index(),[]),$.jStorage.flush()}),asyncTest("publish/subscribe",function(){expect(2),$.jStorage.subscribe("testchannel",function(e,t){ok("testchannel"==e),deepEqual(t,{arr:[1,2,3]}),$.jStorage.flush(),start()}),setTimeout(function(){$.jStorage.publish("testchannel",{arr:[1,2,3]})},100)}),module("listenKeyChange"),asyncTest("specific key - updated",function(){$.jStorage.listenKeyChange("testkey",function(e,t){ok("testkey"==e),ok("updated"==t),$.jStorage.stopListening("testkey"),start()}),setTimeout(function(){$.jStorage.set("testkey","value")},100)}),asyncTest("specific key - deleted",function(){$.jStorage.listenKeyChange("testkey",function(e,t){ok("testkey"==e),ok("deleted"==t),$.jStorage.stopListening("testkey"),$.jStorage.flush(),start()}),setTimeout(function(){$.jStorage.deleteKey("testkey")},100)}),asyncTest("all keys - updated",function(){$.jStorage.listenKeyChange("*",function(e,t){ok("testkey"==e),ok("updated"==t),$.jStorage.stopListening("*"),start()}),setTimeout(function(){$.jStorage.set("testkey","value")},100)}),asyncTest("specific key - deleted",function(){$.jStorage.listenKeyChange("*",function(e,t){ok("testkey"==e),ok("deleted"==t),$.jStorage.stopListening("*"),$.jStorage.flush(),start()}),setTimeout(function(){$.jStorage.deleteKey("testkey")},100)});