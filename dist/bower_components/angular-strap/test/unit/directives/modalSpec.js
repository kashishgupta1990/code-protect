describe("modal",function(){function a(a,d){a=a?n[a]:n["default"],a=$(a).appendTo(e),d||l.expectGET("partials/modal.html").respond(t.modal);var i=o(a)(t);return d||l.flush(),t.$digest(),i}var t,e,o,d,l;beforeEach(module("$strap.directives")),beforeEach(inject(function(a,n,i,c,r){t=n,o=i,d=c,l=r,e=$('<div id="sandbox"></div>').appendTo($("body")),t.content="World<br />Multiline Content<br />",t.modal='Hello <span ng-bind-html-unsafe="content"></span>'})),afterEach(function(){e.remove(),t.$destroy(),$(".modal-backdrop, .modal").remove()});var n={"default":'<a class="btn" bs-modal="\'partials/modal.html\'"></a>',extra:'<a class="btn" bs-modal="\'partials/modal.html\'" data-backdrop="0" data-keyboard="0" data-modal-class="modal-wide"></a>',cached:'<script type="text/ng-template" id="cached-modal">Hello <span ng-bind-html-unsafe="content"></span></script><a class="btn" bs-modal="\'cached-modal\'" data-unique="1" data-title="aTitleBis" data-placement="left"></a>'};it("should fetch the partial and build the modal",function(){var e=a();expect(e.attr("data-toggle")).toBe("modal"),expect(e.attr("data-target")).toBeDefined();var o=$(e.attr("data-target"));expect(o.hasClass("modal")).toBe(!0),expect(o.html()).toBe(t.modal)}),it("should handle extra attributes",function(){var t=a("extra"),e=$(t.attr("data-target"));expect(e.hasClass("modal-wide")).toBe(!0)}),it("should fetch the partial from cache and build the modal",function(){a("cached",!0),expect(t.$$asyncQueue.length).toBe(0);var e=$("a[bs-modal]");expect(e.attr("data-target")).toBeDefined();var o=$(e.attr("data-target"));expect(o.hasClass("modal")).toBe(!0),expect(o.html()).toBe(t.modal)}),it("should correctly call $.fn.modal",function(){var t=$.fn.modal,e=angular.extend(spyOn($.fn,"modal"),t).andCallThrough(),o=a();o.modal("show"),expect(e).toHaveBeenCalled()}),it("should resolve scope variables in the external partial",function(){var e=a(),o=$(e.attr("data-target"));o.modal("show"),d.flush(),expect(o.text()).toBe("Hello "+t.content.replace(/<br \/>/g,""))}),it("should show the modal on click",function(){var t=a(),e=$(t.attr("data-target"));expect(e.hasClass("hide")).toBe(!0),t.trigger("click")}),describe("events",function(){var e,o,d;beforeEach(function(){e=a(),o=$(e.attr("data-target")),d=jasmine.createSpy("event")}),it("should emit an event on show",function(){t.$on("modal-show",d),o.modal("show"),expect(d).toHaveBeenCalled()}),it("should emit an event on shown",function(){t.$on("modal-shown",d),o.modal("show")}),it("should emit an event on hide",function(){t.$on("modal-hide",d),o.modal("hide"),expect(d).toHaveBeenCalled()}),it("should emit an event on hidden",function(){t.$on("modal-hidden",d),o.modal("hide")})})});