describe("popover",function(){function e(e,n){e=e?r[e]:r["default"],angular.extend(t,e.scope);var i=$(e.element).appendTo(o);return n||a.expectGET("partials/popover.html").respond(e.popover),i=p(i)(t),n||a.flush(),t.$digest(),i}var t,o,p,n,a,i;beforeEach(module("$strap.directives")),beforeEach(inject(function(e,r,l,s,c,d){t=r,p=l,n=s,a=c,i=d,o=$('<div id="sandbox"></div>').appendTo($("body"))})),afterEach(function(){o.remove(),t.$destroy()});var r={"default":{scope:{content:"World<br />Multiline Content<br />"},popover:'Hello <span ng-bind-html-unsafe="content"></span>',element:'<a class="btn" bs-popover="\'partials/popover.html\'" data-title="aTitle" data-placement="left"></a>'},unique:{scope:{content:"World<br />Multiline Content<br />"},popover:'Hello <span ng-bind-html-unsafe="content"></span>',element:'<a class="btn" bs-popover="\'partials/popover.html\'" data-title="aTitle" data-unique="1"></a>'},hide:{scope:{content:"World<br />Multiline Content<br />",foo:{hide:!1}},popover:'Hello <span ng-bind-html-unsafe="content"></span>',element:'<a class="btn" bs-popover="\'partials/popover.html\'" data-title="aTitle" data-hide="foo.hide"></a>'},show:{scope:{content:"World<br />Multiline Content<br />",foo:{show:!1}},popover:'Hello <span ng-bind-html-unsafe="content"></span>',element:'<a class="btn" bs-popover="\'partials/popover.html\'" data-title="aTitle" data-show="foo.show"></a>'},object:{scope:{popover:{title:"aTitle",content:"World<br />Multiline Content<br />"}},element:'<a class="btn" bs-popover="popover"></a>'},cached:{scope:{content:"World<br />Multiline Content<br />"},element:'<script type="text/ng-template" id="cached-popover">Hello <span ng-bind-html-unsafe="content"></span></script><a class="btn" bs-popover="\'cached-popover\'" data-title="aTitle"></a>'},ngRepeatWithoutTitle:{scope:{things:[{name:"A"},{name:"B"},{name:"C"}]},popover:'<ul><li ng-repeat="thing in things">{{thing.name}}</li></ul>',element:'<a class="btn" bs-popover="\'partials/popover.html\'"></a>'},placement:{scope:{content:"World<br />Multiline Content<br />"},popover:'Hello <span ng-bind-html-unsafe="content"></span>',element:'<a class="btn" bs-popover="\'partials/popover.html\'" data-title="aTitle" data-placement="right"></a>'},trigger:{scope:{content:"World<br />Multiline Content<br />"},popover:'Hello <span ng-bind-html-unsafe="content"></span>',element:'<a class="btn" bs-popover="\'partials/popover.html\'" data-title="aTitle" data-trigger="hover"></a>'}};it("should fetch the partial with $http and build the popover",function(){var t=e();expect(t.data("popover")).toBeDefined(),expect(t.data("popover").options.content).toBe(r["default"].popover)}),it("should fetch the partial from cache and build the popover",function(){e("cached",!0),expect(t.$$asyncQueue.length).toBe(0);var o=$("a[bs-popover]");expect(o.data("popover")).toBeDefined(),expect(o.data("popover").options.content).toBe(r["default"].popover)}),it("should support a plain object and build the popover",function(){e("object",!0);var t=$("a[bs-popover]");expect(t.data("popover")).toBeDefined(),expect(t.data("popover").options.content).toBe(r.object.scope.popover.content)}),it("should correctly call $.fn.popover",function(){var t=$.fn.popover,o=angular.extend(spyOn($.fn,"popover"),t).andCallThrough();e();expect(o).toHaveBeenCalled()}),it("should define a correct title",function(){var t=e();t.popover("show"),expect(t.data("popover").tip().find(".popover-title").text()).toBe("aTitle")}),it("should define a correct trigger",function(){var t=e("trigger");t.trigger("mouseover"),expect(t.data("popover").tip().hasClass("in")).toBe(!0),t.trigger("mouseleave"),expect(t.data("popover").tip().hasClass("in")).toBe(!1)}),it("should define a correct placement",function(){var t=e("placement");t.popover("show"),expect(t.data("popover").tip().hasClass("right")).toBe(!0)}),it("should resolve scope variables in the external partial",function(){var o=e();o.popover("show"),expect(o.data("popover").tip().find(".popover-content").text()).toBe("Hello "+t.content.replace(/<br \/>/g,""))}),it("should define the popover reference on the tip",function(){var t=e();t.trigger("click"),expect(t.data("popover").tip().data("popover")).toBeDefined(),expect(t.data("popover")).toBe(t.data("popover").tip().data("popover"))}),it("should show/hide the popover on click",function(){var t=e();t.trigger("click"),expect(t.data("popover").tip().hasClass("in")).toBe(!0),t.trigger("click"),expect(t.data("popover").tip().hasClass("in")).toBe(!1)}),it("should support data-unique attribute",function(){var t=e(),o=e("unique",!0);t.trigger("click"),expect(t.data("popover").tip().hasClass("in")).toBe(!0),o.trigger("click")}),it("should support data-hide attribute",function(){var o=e("hide");o.trigger("click"),expect(o.data("popover").tip().hasClass("in")).toBe(!0),t.foo.hide=!0,t.$digest(),expect(o.data("popover").tip().hasClass("in")).toBe(!1)}),it("should support data-show attribute",function(){var o=e("show");expect(o.data("popover").tip().hasClass("in")).toBe(!1),t.foo.show=!0,n(function(){expect(o.data("popover").tip().hasClass("in")).toBe(!0)})}),it("should correctly compile ng-repeat without a title",function(){var t=e("ngRepeatWithoutTitle");t.popover("show"),expect(t.data("popover").tip().find(".popover-content").text()).toBe("ABC")}),describe("events",function(){var o,p;beforeEach(function(){o=e(),p=jasmine.createSpy("event")}),it("should emit an event on show",function(){t.$on("popover-show",p),o.popover("show"),expect(p).toHaveBeenCalled()}),it("should emit an event on shown",function(){t.$on("popover-shown",p),o.popover("show")}),it("should emit an event on hide",function(){t.$on("popover-hide",p),o.popover("hide"),expect(p).toHaveBeenCalled()}),it("should emit an event on hidden",function(){t.$on("popover-hidden",p),o.popover("hide")})})});