angular.module("$strap.directives").directive("bsDatepicker",function(e,a){var t=/(iP(a|o)d|iPhone)/g.test(navigator.userAgent),r=function(e){return $.fn.datepicker.dates[e]&&e||(e="en"),{"/":"[\\/]","-":"[-]",".":"[.]"," ":"[\\s]",dd:"(?:(?:[0-2]?[0-9]{1})|(?:[3][01]{1}))",d:"(?:(?:[0-2]?[0-9]{1})|(?:[3][01]{1}))",mm:"(?:[0]?[1-9]|[1][012])",m:"(?:[0]?[1-9]|[1][012])",DD:"(?:"+$.fn.datepicker.dates[e].days.join("|")+")",D:"(?:"+$.fn.datepicker.dates[e].daysShort.join("|")+")",MM:"(?:"+$.fn.datepicker.dates[e].months.join("|")+")",M:"(?:"+$.fn.datepicker.dates[e].monthsShort.join("|")+")",yyyy:"(?:(?:[1]{1}[0-9]{1}[0-9]{1}[0-9]{1})|(?:[2]{1}[0-9]{3}))(?![[0-9]])",yy:"(?:(?:[0-9]{1}[0-9]{1}))(?![[0-9]])"}},n=function(e,a){var t,n=e,i=r(a);return t=0,angular.forEach(i,function(e,a){n=n.split(a).join("${"+t+"}"),t++}),t=0,angular.forEach(i,function(e,a){n=n.split("${"+t+"}").join(e),t++}),new RegExp("^"+n+"$",["i"])},i=/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/;return{restrict:"A",require:"?ngModel",link:function(e,r,d,o){var l=angular.extend({autoclose:!0},a.datepicker||{}),s=d.dateType||l.type||"date",c=function(e,a,t){return e&&"iso"===s&&i.test(e)?$.fn.datepicker.DPGlobal.parseDate(new Date(e),$.fn.datepicker.DPGlobal.parseFormat(a),t):e&&"date"===s&&angular.isString(e)?$.fn.datepicker.DPGlobal.parseDate(e,$.fn.datepicker.DPGlobal.parseFormat(a),t):e},f=function(){l=angular.extend({autoclose:!0},a.datepicker||{}),s=d.dateType||l.type||"date",angular.forEach(["format","weekStart","calendarWeeks","startDate","endDate","daysOfWeekDisabled","autoclose","startView","minViewMode","todayBtn","todayHighlight","keyboardNavigation","language","forceParse"],function(e){angular.isDefined(d[e])&&(l[e]=d[e])});var i=l.language||"en",f=d.dateFormat||l.format||$.fn.datepicker.dates[i]&&$.fn.datepicker.dates[i].format||"mm/dd/yyyy",p=t?"yyyy-mm-dd":f,u=n(p,i);o&&(o.$formatters.unshift(function(e){return c(e,f,i)}),o.$parsers.unshift(function(e){return e?"date"!==s&&"iso"!==s||!angular.isDate(e)?angular.isString(e)&&u.test(e)?(o.$setValidity("date",!0),t?new Date(e):"string"===s?e:$.fn.datepicker.DPGlobal.parseDate(e,$.fn.datepicker.DPGlobal.parseFormat(p),i)):void o.$setValidity("date",!1):(o.$setValidity("date",!0),e):(o.$setValidity("date",!0),null)}),o.$render=function(){if(t){var e=o.$viewValue?$.fn.datepicker.DPGlobal.formatDate(o.$viewValue,$.fn.datepicker.DPGlobal.parseFormat(p),i):"";return r.val(e),e}return o.$viewValue||r.val(""),r.datepicker("update",o.$viewValue)}),t?r.prop("type","date").css("-webkit-appearance","textfield"):(o&&r.on("changeDate",function(a){e.$apply(function(){o.$setViewValue("string"===s?r.val():a.date)})}),r.datepicker(angular.extend(l,{format:p,language:i})),e.$on("$destroy",function(){var e=r.data("datepicker");e&&(e.picker.remove(),r.data("datepicker",null))}),d.$observe("startDate",function(e){r.datepicker("setStartDate",e)}),d.$observe("endDate",function(e){r.datepicker("setEndDate",e)}));var k=r.siblings('[data-toggle="datepicker"]');k.length&&k.on("click",function(){r.prop("disabled")||r.trigger("focus")})};f(),e.$watch(function(){return d.language},function(e,a){if(e!==a){var t=$.fn.datepicker.dates[a]?a:"en",n=d.dateFormat||l.format||$.fn.datepicker.dates[t]&&$.fn.datepicker.dates[t].format||"mm/dd/yyyy",i=$.fn.datepicker.DPGlobal.parseDate(r.val(),$.fn.datepicker.DPGlobal.parseFormat(n),t),s=$.fn.datepicker.dates[e]?e:"en",p=$.fn.datepicker.dates[s]&&$.fn.datepicker.dates[s].format||"mm/dd/yyyy",u=$.fn.datepicker.DPGlobal.formatDate(i,$.fn.datepicker.DPGlobal.parseFormat(p),s);r.datepicker("remove"),r.val(""),f();var k=c(u,p,s);o.$modelValue=k,o.$viewValue=u}})}}});