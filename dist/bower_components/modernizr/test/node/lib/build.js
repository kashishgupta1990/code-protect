var root=require("find-parent-dir").sync(__dirname,"package.json"),build=require(root+"lib/build"),expect=require("expect.js");describe("cli/build",function(){it("should build without error",function(){expect(function(){build()}).to.not.throwError()}),describe("custom builds",function(done){it("should build without errors when using a custom build",function(){expect(function(){build({"feature-detects":["css/boxsizing"]},done)}).to.not.throwError()}),it("should include the requested options",function(e){build({"feature-detects":["css/boxsizing"]},function(i){expect(i).to.contain("boxsizing"),e()})}),it("should exclude options that are not requested",function(e){build({"feature-detects":["dom/classlist"]},function(i){expect(i).to.contain("classlist"),expect(i).to.not.contain("boxsizing"),e()})}),it("should strip out DOC comments when `uglify`ing",function(e){var i={minify:!0,"feature-detects":["css/boxsizing"]};build(i,function(i){expect(i).to.not.contain("Box Sizing"),e()})}),it("should inject the proper classPath when configured",function(e){var i="TEST_PREFIX",t={classPrefix:i,setClasses:!0},n=/_config:\s*?({[^}]*})/m;build(t,function(t){var o=t.match(n);o=JSON.parse(o[1].replace(/'/g,'"')),expect(o.classPrefix).to.be(i),e()})}),it("should inject the proper classPath when configured and minified",function(done){var prefix="TEST_PREFIX",config={classPrefix:prefix,setClasses:!0,minify:!0},configRE=/_config:\s*?({[^}]*})/m;build(config,function(file){var parsedConfig=file.match(configRE);parsedConfig=eval("("+parsedConfig[1].replace(/'/g,'"')+")"),expect(parsedConfig.classPrefix).to.be(prefix),done()})}),describe("unminified",function(){var e;before(function(i){var t={"feature-detects":["css/boxsizing"]};build(t,function(t){e=t,i()})}),it("strips out the modernizr-init/build `define` section",function(){var i=/define\("modernizr-(init|build)"\)/m;expect(i.test(e)).to.be(!1)}),it("strips out the `define` section",function(){var i=/define\(.*?\{/;expect(i.test(e)).to.be(!1)}),it("strips out the `require` section",function(){var i=/require[^\{\r\n]+\{/;expect(i.test(e)).to.be(!1)}),it("replaces __VERSION__ ",function(){expect(e).to.not.contain("__VERSION__")})}),describe("minified",function(){var e;before(function(i){var t={"feature-detects":["css/boxsizing"],minify:!0};build(t,function(t){e=t,i()})}),it("strips out the modernizr-init/build `define` section",function(){var i=/define\("modernizr-(init|build)"\)/m;expect(i.test(e)).to.be(!1)}),it("strips out the `define` section",function(){var i=/define\(.*?\{/;expect(i.test(e)).to.be(!1)}),it("strips out the `require` section",function(){var i=/require[^\{\r\n]+\{/;expect(i.test(e)).to.be(!1)}),it("replaces __VERSION__ ",function(){expect(e).to.not.contain("__VERSION__")})})})});