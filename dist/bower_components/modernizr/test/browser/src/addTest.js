describe("addTest",function(){var e,t,o,c,n,i,a;before(function(e){(a=requirejs.config({context:Math.random().toString().slice(2),baseUrl:"../src",paths:{cleanup:"../test/cleanup",sinon:"../test/js/lib/sinon"}}))(["cleanup","sinon"],function(t,o){n=t,i=o,e()})}),beforeEach(function(n){e={},o={_q:[],_config:{}},t=i.spy(),define("ModernizrProto",[],function(){return e}),define("Modernizr",[],function(){return o}),define("setClasses",[],function(){return t}),define("package",[],function(){return{}}),a(["addTest"],function(e){c=e,n()})}),afterEach(function(){a.undef("ModernizrProto"),a.undef("setClasses"),a.undef("Modernizr"),a.undef("package"),a.undef("addTest")}),describe("setup",function(){it("adds an object for test listeners",function(){expect(e._l).to.be.an("object")}),it("should define the `ModernizrProto._trigger` function",function(){expect(e._trigger).to.be.an("function")}),it("should push the Modernizr.addTest definition to the `_q`",function(){expect(o._q).to.have.length(1),expect(o._q[0]).to.be.a("function")}),it("should define Modernizr.addTest at the end of the _q",function(){o._q[0](),expect(e.addTest).to.be(c)})}),describe("Modernizr.on",function(){var t=function(){};it("keeps track of requests",function(){e.on("fakeDetect",t),expect(e._l.fakeDetect).to.be.an("array"),expect(e._l.fakeDetect[0]).to.be(t)}),it("does not recreate the queue with duplicate requests",function(){e.on("fakeDetect",t),e.on("fakeDetect",t),expect(e._l.fakeDetect.length).to.be(2)}),it("triggers results if the detect already ran",function(c){o.fakeDetect="fake",o._trigger=i.spy(),e.on("fakeDetect",t),setTimeout(function(){expect(o._trigger.calledOnce).to.be(!0),expect(o._trigger.calledWith("fakeDetect",o.fakeDetect)).to.be(!0),c()},0)})}),describe("Modernizr._trigger",function(){it("skips the callback if it does not exist",function(){expect(function(){e._trigger("fakeDetect")}).to.not.throwError()}),it("runs the listener calledback if it does exist",function(t){var o=i.spy();e.on("fakeDetect",o),e._trigger("fakeDetect","fakeRes"),setTimeout(function(){expect(o.calledOnce).to.be(!0),t()})}),it("deletes the listener after it runs",function(t){e.on("fakeDetect",function(){}),expect(e._l.fakeDetect).to.be.an("array"),e._trigger("fakeDetect","fakeRes"),setTimeout(function(){expect(e._l.fakeDetect).to.be(void 0),t()})})}),describe("Modernizr.addTest",function(){beforeEach(function(){o._trigger=i.spy(),o._trigger=i.spy(),expect(o.fakedetect).to.be(void 0),expect(o.fake).to.be(void 0),expect(o.detect).to.be(void 0)}),it("sets the proper bool on the Modernizr object with a function",function(){c("fakedetect",function(){return!0}),expect(o.fakedetect).to.be(!0)}),it("sets the proper bool on the Modernizr object with a bool",function(){c("fakedetect",!1),expect(o.fakedetect).to.be(!1)}),it("does not cast to a bool on the Modernizr object with a truthy value",function(){c("fakedetect",function(){return 100}),expect(o.fakedetect).to.be(100)}),it("sets a true class for a true value",function(){c("fakedetect",function(){return 100}),expect(t.callCount).to.be(1),expect(t.calledWith(["fakedetect"])).to.be(!0)}),it("sets a truthy class for a truthy value",function(){c("fakedetect",function(){return 100}),expect(t.callCount).to.be(1),expect(t.calledWith(["fakedetect"])).to.be(!0)}),it("sets a negative class for a false value",function(){c("fakedetect",function(){return!1}),expect(t.callCount).to.be(1),expect(t.calledWith(["no-fakedetect"])).to.be(!0)}),it("sets a negative class for a falsey value",function(){c("fakedetect",function(){}),expect(t.callCount).to.be(1),expect(t.calledWith(["no-fakedetect"])).to.be(!0)}),it("does not cast to a bool on the Modernizr object with a falsy value",function(){c("fakedetect",function(){}),expect("fakedetect"in o).to.be(!0),expect(o.fakedetect).to.be(void 0)}),it("forces detect names are lowercase",function(){c("FaKeDeTeCt",!0),expect(o.fakedetect).to.be(!0)}),it("supports nested properties with a bool base",function(){c("fake",new Boolean(!0)),c("fake.detect",!0),expect(o.fake).to.be.an("object"),expect(o.fake.detect).to.be(!0)}),it("supports nested properties",function(){c("fake",!0),c("fake.detect",!0),expect(o.fake).to.be.an("object"),expect(o.fake.detect).to.be(!0)}),it("does not overwrite values once they are set",function(){c("fakeDetect",!1),expect(o.fakedetect).to.be(!1),expect(o._trigger.calledOnce).to.be(!0),c("fakeDetect",!0),expect(o.fakedetect).to.be(!1),expect(o._trigger.calledOnce).to.be(!0)}),it("allows feature to be an object of features",function(){c({fake:!0,detect:!1}),expect(o.fake).to.be(!0),expect(o.detect).to.be(!1),expect(t.callCount).to.be(2),expect(t.calledWith(["fake"])).to.be(!0),expect(t.calledWith(["no-detect"])).to.be(!0)}),it("properly filters out monkey patched object properties",function(){var e=function(){};Object.prototype.MOD_FAKE_VALUE=e;var n={detect:!1};expect(n.MOD_FAKE_VALUE).to.be(e),c(n),delete Object.prototype.MOD_FAKE_VALUE,expect(o.MOD_FAKE_VALUE).to.be(void 0),expect(o.mod_fake_value).to.be(void 0),expect(o.detect).to.be(!1),expect(t.callCount).to.be(1)}),it("returns an instance of Modernizr for chaining",function(){expect(c("fakeDetect",!0)).to.be(o)})}),after(function(){n()})});