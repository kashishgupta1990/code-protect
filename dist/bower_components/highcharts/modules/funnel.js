/*
 
 Highcharts funnel module

 (c) 2010-2014 Torstein Honsi

 License: www.highcharts.com/license
*/

!function(t){var e=t.getOptions(),n=e.plotOptions,i=t.seriesTypes,r=t.merge,s=function(){},o=t.each;n.funnel=r(n.pie,{center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,dataLabels:{connectorWidth:1,connectorColor:"#606060"},size:!0,states:{select:{color:"#C0C0C0",borderColor:"#000000",shadow:!1}}}),i.funnel=t.extendClass(i.pie,{type:"funnel",animate:s,singularTooltips:!0,translate:function(){var t,e,n,i,r,a,l,h,p,c,d,u=function(t,e){return/%$/.test(t)?e*parseInt(t,10)/100:parseInt(t,10)},f=0,g=this.chart,y=this.options,b=y.reversed,k=g.plotWidth,v=g.plotHeight,C=0,g=y.center,m=u(g[0],k),w=u(g[0],v),L=u(y.width,k),W=u(y.height,v),H=u(y.neckWidth,k),T=u(y.neckHeight,v),Y=W-T,u=this.data,A="left"===y.dataLabels.position?1:0;this.getWidthAt=e=function(t){return t>W-T||W===T?H:H+(L-H)*((W-T-t)/(W-T))},this.getX=function(t,n){return m+(n?-1:1)*(e(b?v-t:t)/2+y.dataLabels.distance)},this.center=[m,w,W],this.centerX=m,o(u,function(t){f+=t.y}),o(u,function(o){d=null,i=f?o.y/f:0,a=w-W/2+C*W,p=a+i*W,t=e(a),r=m-t/2,l=r+t,t=e(p),h=m-t/2,c=h+t,a>Y?(r=h=m-H/2,l=c=m+H/2):p>Y&&(d=p,t=e(Y),h=m-t/2,c=h+t,p=Y),b&&(a=W-a,p=W-p,d=d?W-d:null),n=["M",r,a,"L",l,a,c,p],d&&n.push(c,d,h,d),n.push(h,p,"Z"),o.shapeType="path",o.shapeArgs={d:n},o.percentage=100*i,o.plotX=m,o.plotY=(a+(d||p))/2,o.tooltipPos=[m,o.plotY],o.slice=s,o.half=A,C+=i})},drawPoints:function(){var t=this,e=t.options,n=t.chart.renderer;o(t.data,function(i){var r=i.graphic,s=i.shapeArgs;r?r.animate(s):i.graphic=n.path(s).attr({fill:i.color,stroke:e.borderColor,"stroke-width":e.borderWidth}).add(t.group)})},sortByAngle:function(t){t.sort(function(t,e){return t.plotY-e.plotY})},drawDataLabels:function(){var t,e,n,r,s,o=this.data,a=this.options.dataLabels.distance,l=o.length;for(this.center[2]-=2*a;l--;)n=o[l],e=(t=n.half)?1:-1,s=n.plotY,r=this.getX(s,t),n.labelPos=[0,s,r+(a-5)*e,s,r+a*e,s,t?"right":"left",0];i.pie.prototype.drawDataLabels.call(this)}}),e.plotOptions.pyramid=t.merge(e.plotOptions.funnel,{neckWidth:"0%",neckHeight:"0%",reversed:!0}),t.seriesTypes.pyramid=t.extendClass(t.seriesTypes.funnel,{type:"pyramid"})}(Highcharts);