/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2011 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license) 
	Version: 1.3
*/

!function(e){var t=(e.browser.msie?"paste":"input")+".mask",n=void 0!=window.orientation;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"},e.fn.extend({caret:function(e,t){if(0!=this.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}});if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var n=document.selection.createRange();e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},isMaskValid:function(){return e(this).data("mask-isvalid")},mask:function(a,r){if(!a&&this.length>0){var i=e(this[0]),o=i.data(e.mask.dataName);if("function"!=typeof o)throw new Error("The Mask widget is not correctly set up");return o()}r=e.extend({placeholder:"_",completed:null},r);var c=e.mask.definitions,l=[],s=a.length,u=null,f=a.length;return e.each(a.split(""),function(e,t){"?"==t?(f--,s=e):c[t]?(l.push(new RegExp(c[t])),null==u&&(u=l.length-1)):l.push(null)}),this.trigger("unmask").each(function(){function i(e){for(;++e<=f&&!l[e];);return e}function o(e){for(;--e>=0&&!l[e];);return e}function h(e,t){if(!(0>e)){for(var n=e,a=i(t);f>n;n++)if(l[n]){if(!(f>a&&l[n].test(y[a])))break;y[n]=y[a],y[a]=r.placeholder,a=i(a)}k(),w.caret(Math.max(u,e))}}function d(e){for(var t=e,n=r.placeholder;f>t;t++)if(l[t]){var a=i(t),o=y[t];if(y[t]=n,!(f>a&&l[a].test(o)))break;n=o}}function m(e){var t=e.which;if(8==t||46==t||n&&127==t){var a=w.caret(),r=a.begin,c=a.end;return c-r==0&&(r=46!=t?o(r):c=i(r-1),c=46==t?i(c):c),g(r,c),h(r,c-1),p(),!1}return 27==t?(w.val(R),w.caret(0,b()),!1):void 0}function v(e){var t=e.which,n=w.caret();if(e.ctrlKey||e.altKey||e.metaKey||32>t)return!0;if(t){n.end-n.begin!=0&&(g(n.begin,n.end),h(n.begin,n.end-1),p());var a=i(n.begin-1);if(f>a){var o=String.fromCharCode(t);if(l[a].test(o)){d(a),y[a]=o,k();var c=i(a);w.caret(c),p(),r.completed&&c>=f&&r.completed.call(w)}}return!1}}function g(e,t){for(var n=e;t>n&&f>n;n++)l[n]&&(y[n]=r.placeholder)}function k(){return w.val(y.join("")).val()}function p(){for(var e=w.val(),t=-1,n=0,a=0;f>n;n++)if(l[n]){for(y[n]=r.placeholder;a++<e.length;){var i=e.charAt(a-1);if(l[n].test(i)){y[n]=i,t=n;break}}if(a>e.length)break}else y[n]==e.charAt(a)&&n!=s&&(a++,t=n);var o=t+1>=s;return w.data("mask-isvalid",o),o}function b(e){for(var t=w.val(),n=-1,a=0,i=0;f>a;a++)if(l[a]){for(y[a]=r.placeholder;i++<t.length;){var o=t.charAt(i-1);if(l[a].test(o)){y[a]=o,n=a;break}}if(i>t.length)break}else y[a]==t.charAt(i)&&a!=s&&(i++,n=a);return!e&&s>n+1?(w.val(""),g(0,f)):(e||n+1>=s)&&(k(),e||w.val(w.val().substring(0,n+1))),s?a:u}var w=e(this),y=e.map(a.split(""),function(e,t){return"?"!=e?c[e]?r.placeholder:e:void 0}),R=w.val();w.data(e.mask.dataName,function(){return e.map(y,function(e,t){return l[t]&&e!=r.placeholder?e:null}).join("")}),w.attr("readonly")||w.one("unmask",function(){w.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){R=w.val();var t=b();k();var n=function(){t==a.length?w.caret(0,t):w.caret(t)};(e.browser.msie?n:function(){setTimeout(n,0)})()}).bind("blur.mask",function(){b(),w.val()!=R&&w.change()}).bind("keydown.mask",m).bind("keypress.mask",v).bind(t,function(){setTimeout(function(){w.caret(b(!0))},0)}),b()})}})}(jQuery);