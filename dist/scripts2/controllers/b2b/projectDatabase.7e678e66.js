define("controllers/b2b/projectDatabase.7e678e66",["app","services/citiesService","services/searchService","services/projectService","services/localityService"],function(a){a.controller("projectDatabase",["$scope","$rootScope","$location","$stateParams","CityService","LocalityService","ProjectService","SearchService","GoogleAnalyticsService",function(a,b,c,d,e,f,g,h,i){var j=function(b){if(b&&a.localities.data){var c=a.localities.data;a.filteredLocalities=_.filter(c,function(a){return-1!=a.label.toLowerCase().indexOf(b.toLowerCase())})}else a.filteredLocalities=a.localities.data};a.getItems=function(a){i.gaEventProjectDatabaseSearchLocality(a),j(a)},e.getMainCities().then(function(b){a.cities=b.data;var c=e.getCityForSingleCityUserAccess(a.cities);c&&(a.pdSelectedCity=c)}),a.$watch("pdSelectedCity",function(b,c){if(b){i.gaEventProjectDatabaseSelectCity(b);var d={filters:{and:[{equal:{cityId:b.id}}]},paging:{start:0,rows:999},fields:["label","projectCount","localityId"]};a.localities={inFlight:!0},a.showLocalityLoad=!0,f.getLocalityList(JSON.stringify(d),function(b){a.showLocalityLoad=!1,a.localities.inFlight=!1,a.localities.data=b.data,a.filteredLocalities=b.data},!0,!0)}}),a.getLocalityProjects=function(b){if(b){if(b.localityId==a.clickedLocalityId&&a.showProjectLoad)return;var c={filters:{and:[{equal:{localityId:b.localityId}}]},paging:{start:0,rows:9999}};a.showProjectLoad=!0,a.clickedLocalityId=b.localityId,g.getProjectList(JSON.stringify(c),void 0,function(c){a.showProjectLoad=!1,b.projects=c.data.items,i.gaEventProjectDatabaseSearchProjectListing(b)},!1,!1,!0)}}}])});