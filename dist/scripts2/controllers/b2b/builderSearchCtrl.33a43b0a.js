define("services/b2b/BuilderService",["app","services/getHttpService","services/b2b-constants","services/globalService"],function(a){a.factory("B2BBuilderService",["$http","GlobalService","B2BConstants","GetHttpService",function(a,b,c,d){var e=function(a,b){return a+"&fields="+b.join()},f=function(a,b){return a+"&group="+b.join()},g=function(c,d){var e=c+"&typeAheadType=builder";return d&&(e=e+"&city="+d),a.get(b.getAPIURL("columbus/app/v4/typeahead?query="+e)).then(function(a){return a.data.data})},h=function(a,b,c){var d,e="string"==typeof a||"number"==typeof a;return e?(d="builderId=="+a,c&&(d+=";cityId=="+c)):(d="",_.each(a,function(b,c){d+="builderId=="+b,c!=a.length-1&&(d+=",")})),b&&(d=d+";("+b+")"),"?filters="+d},i=function(a,b){var c=(a.length,[]);return _.each(a,function(a,d){var e="app/v1/user/builder-trend?filters=(";e+="builderId=="+a.builderId+(a.cityId?";cityId=="+a.cityId:"")+")",b&&(e=e+";("+b+")"),c.push({url:e,builderAndCityId:a})}),c},j=function(a,c){if(a){var d=i(a,c),e=[];return b.makeCompositeCall(_.pluck(d,"url")).then(function(a){for(var b in a){var c=_.find(d,function(a){return a.url==b});a[b].data[0].cityId=c.builderAndCityId.cityId,e.push(a[b].data[0])}return e.reverse()})}},k=function(d,g,i){if(d){var j=h(d,i,g);return j=e(j,c.BUILDER_SEARCH.BUILDER_TREND_FIELDS),j=f(j,c.BUILDER_SEARCH.GROUPING),j="data/v1/trend/current"+j,a.get(b.getAPIURL(j)).then(function(a){return a.data.data})}},l=function(c,d,g,i){if(c){var j=h(c,d);return j=e(j,g),j=f(j,i),j="data/v1/trend-list/current"+j,a.get(b.getAPIURL(j)).then(function(a){return a.data.data})}},m=function(c,e,f){var g="data/v2/entity/builder/"+c.toString()+"?fields="+e.join();return a.get(b.getAPIURL(g)).then(function(a){d.commonResponse(a),200===a.status&&f(a.data.data)})};return{getBuilders:g,getBuilderTrend:j,getSpecificTrend:k,getBuilderCardInfo:m,getTrendList:l}}])}),define("services/b2b/dataService",["app"],function(a){a.config(["$httpProvider",function(a){delete a.defaults.headers.common["X-Requested-With"]}]).factory("DataService",["GlobalService","$http","GetHttpService","$q",function(a,b,c,d){"use strict";var e=function(d,e,f,g){return g||(g=!1),b({method:"GET",cache:g,url:a.getAPIURL(d+e)}).success(function(a){var b=!1;c.commonResponseData(a,"",b),f&&a.statusCode&&"2"===a.statusCode.substring(0,1)&&f(a,200)}).error(function(a){!f||!a||a.statusCode&&"5"!==a.statusCode.substring(0,1)||f(void 0,500)})},f=function(a,b){var c="data/v1/price-trend/hitherto?filters=";return e(c,a,b)},g=function(a,b,c){var d="data/v1/trend/hitherto?filters=";return e(d,a,b,c)},h=function(a,b){var c="data/v1/trend-list?filters=";return e(c,a,b)},i=function(a,b){var c="data/v1/trend-list/hitherto?filters=";return e(c,a,b)},j=function(a,b){var c="data/v1/trend/current?filters=";return e(c,a,b)},k=function(a,b){var c="data/v1/entity/project?selector=";return e(c,a,b)};return{trendList:h,trendHitherto:g,trendListHitherto:i,priceTrendHitherto:f,trendCurrent:j,getPropertyUnitTypesByProjectIds:k}}])}),define("text!views/directives/b2b/builderSearch/grid-head.html",[],function(){return"<div class=\"pt_row bl-head\">\n	<div grid-head-unit unit='unit' update-table='updateTable' sort='sort' data-ng-repeat='unit in units'></div>                \n</div>\n\n            "}),define("text!views/directives/b2b/builderSearch/grid-head-unit.html",[],function(){return'<div class="ta-center {{unit.class}}">\n	<span data-ng-class="{\'showHand\': unit.sortable}" data-ng-click="sort(unit)"> \n		<span data-ng-if="!unit.options">\n			{{unit.label}}  {{$index}} <small data-ng-if="unit.isPricePerUnitArea">(<i class="pt  pt-icon-inr"></i>/sq ft)</small>\n			<i data-ng-if="unit.sortOrder"  data-ng-class="{\'pt  pt-icon-chevron-up\': unit.sortOrder==\'ASC\', \'pt  pt-icon-chevron-down\': unit.sortOrder==\'DESC\'}"> </i>\n\n			<!-- Help text -->\n			<span data-ng-if=\'unit.helpText\'>\n				<i class="pt  pt-icon-question-circle" tooltip="{{unit.helpText}}"> </i>\n			</span>\n			<!-- Sort arrows -->\n			<a href="javascript:void(0)" class="sorter" data-ng-if="unit.sortable && !unit.sortOrder">\n				<i class="pt pt-icon-sort"></i>\n			</a>\n		</span>\n\n		<span data-ng-if="unit.options">\n			<span>\n			{{unit.selected(unit.options).label}} <small data-ng-if="unit.isPricePerUnitArea">(<i class="pt pt-icon-inr"></i>/sq ft)</small>\n				<i data-ng-if="unit.selected(unit.options).sortOrder" data-ng-class="{\'pt pt-icon-chevron-up\': unit.selected(unit.options).sortOrder==\'ASC\', \'pt  pt-icon-chevron-down\': unit.selected(unit.options).sortOrder==\'DESC\'}"> </i> \n			</span>\n			\n			<a href="javascript:void(0)" class="sorter" data-ng-if="unit.sortable && !unit.selected(unit.options).sortOrder">\n				<i class="pt pt-icon-sort"></i>\n			</a>\n		</span>\n		\n	<span>\n\n\n	<!-- Options section -->\n    <div class="toggle-cols" data-ng-if="unit.options">\n        <i class="pt  pt-icon-caret-square-o-down dropdown-toggle" data-toggle="dropdown"></i>\n        <ul class="dropdown-menu dd-list">\n        	<li data-ng-repeat=\'option in unit.options\' data-ng-click="unit.selected(unit.options).selected = false; option.selected = true; updateTable(unit, option)">{{option.label}} </li>\n        </ul>\n	</div>\n</div>	\n'}),define("directives/b2b/builderSearch/grid-head-unit",["app","text!views/directives/b2b/builderSearch/grid-head-unit.html"],function(a,b){a.directive("gridHeadUnit",[function(){return{scope:{unit:"=",updateTable:"=",sort:"="},template:b}}])}),define("directives/b2b/builderSearch/grid-head",["app","text!views/directives/b2b/builderSearch/grid-head.html","directives/b2b/builderSearch/grid-head-unit"],function(a,b){a.directive("gridHead",[function(){return{scope:{units:"=",updateTable:"=",sort:"="},template:b}}])}),define("text!views/directives/common/pt-loading-block.html",[],function(){return'<div class="parent-blocking" data-ng-if="!loadingObject">\n    <div class="loader-info">\n    	<div data-ng-transclude ></div>\n    	<i class="pt pt-icon-cog pt-icon-spin {{iconStylingClass}}"></i>\n        <div class="big-loader">\n            <i class="spinLoader"></i>\n        </div>      \n    </div>        \n</div>\n'}),define("directives/common/pt-loading-block",["app","text!views/directives/common/pt-loading-block.html"],function(a,b){a.directive("ptLoadingBlock",[function(){return{restrict:"A",scope:{loadingObject:"=",iconStylingClass:"@"},transclude:!0,template:b,link:function(a,b,c){a.iconStylingClass=a.iconStylingClass||"",a.$on("$destroy",function(){a.loadingObject=void 0,b.remove()})}}}])}),define("services/b2b/DownloadService",["app","formatters/common"],function(a){a.factory("DownloadService",["$http","GlobalService","$window","Formatter",function(a,b,c,d){var e="app/v1/report/price-and-absorption",f=function(c){return a({method:"GET",url:b.getAPIURL(e+h(c)),timeout:1e4}).then(function(a){return a})},g=function(a){var b=c.location;b.href=b.protocol+"//"+b.host+"/app/v1/report/download?key="+a},h=function(a){var b,c=new Date(a.fromDate),e=new Date(a.toDate),f=[],g=[];c.setDate(1),e.setDate(1),f.push("(month=ge="+d.getYYYYMMDD(c,"-")+")"),f.push("(month=le="+d.getYYYYMMDD(e,"-")+")");for(var h=0,i=a.projectIds.length;i>h;h++)g.push("(projectId=="+a.projectIds[h]+")");return f.push("("+g.join(",")+")"),b=a.aggregated?"?aggregatedOnly=true&filters=("+f.join(";")+")":"?filters=("+f.join(";")+")"};return{getCatchmentInfoFileName:f,getCatchmentInfoFile:g}}])}),define("text!views/directives/b2b/builderSearch/base-info.html",[],function(){return'<div class="builder-listitem">\n    <div class="pt_row parent-row">\n        <div class="pt_col-2-18 ta-left b-name">\n            <span class="name put-ellipsis" tooltip="{{info.builderName}}">{{info.builderName}}</span>\n            <div class="b-info-wrap for-search">\n                <a href="javascript:void(0)" title="Click here to view a brief information about the builder" class="b-info dropdown-toggle" data-toggle="dropdown" data-ng-click=\'getBuilderDetail()\'><i class="pt  pt-icon-info-circle"></i></a>\n                \n                <div builder-detail builder=\'detail\'></div>\n\n            </div>\n            <div class="clearfix"></div>\n        </div>\n        <div class="pt_col-2-18 ta-center">\n            {{ info.cityName?info.cityName:\'All\' }}\n        </div>\n        <div class="pt_col-2-18 ta-center">\n            {{info.builderHeadquarterCity?info.builderHeadquarterCity:\'\'}}\n        </div>\n        <div class="pt_col-1-18 ta-center t-deco" data-ng-click="builderProjectsModal()">\n\n            <span data-ng-repeat = "option in info.projectCountSet.options">\n                <span data-ng-if="option.selected">\n					<span data-ng-if="info[option.key]"><a>{{info[option.key] | number | figureFMT}}</a>\n                        <span data-ng-if="option.key == \'totalArea\'"> sq ft</span>\n                    </span>\n					<span data-ng-if="!info[option.key]">NA</span>\n                </span>\n            </span>\n\n        </div>\n        <div class="pt_col-2-18 ta-center">\n			    <span tooltip="{{info.minMaxPriceHtmlHover}}" once-html="info.minMaxPriceHtml"></span>\n            \n        </div>\n        <div class="pt_col-2-18 ta-center">\n            {{info.soldPercentage | round}}<span data-ng-if="info.soldPercentage !== \'NA\'">%</span>\n        </div>\n        <div class="pt_col-1-18 ta-center b-p-type">\n            <i class="pt-icon-{{unitType | lowercase}}" tooltip="{{detail.supply}} Units Launched" data-ng-repeat=\'(unitType,detail) in info.unitTypesDetails\'></i>\n        </div>\n        <div class="pt_col-1-18 ta-center b-price">\n            <span class="rise" tooltip="{{info.projectCountHavingPriceAppreciation}} projects appreciated" data-ng-if="info.projectCountHavingPriceAppreciation"><i class="pt  pt-icon-arrow-up"></i>{{info.projectCountHavingPriceAppreciation}}</span> &nbsp;\n            <span class="fall" tooltip="{{info.projectCountHavingPriceDepreciation}} projects depreciated" data-ng-if="info.projectCountHavingPriceDepreciation"><i class="pt  pt-icon-arrow-down"></i>{{info.projectCountHavingPriceDepreciation}}</span>\n        </div>\n        <div class="pt_col-2-18 ta-center b-rate">\n            <span class="rise" tooltip="{{info.projectCountHavingPriceMoreThanLocAvg}} projects above avg. locality rate"><i class="pt  pt-icon-arrow-up"></i>{{info.projectCountHavingPriceMoreThanLocAvg}}</span> &nbsp;\n            <span class="fall" tooltip="{{info.projectCountHavingPriceLessThanLocAvg}} project below avg. locality rate"><i class="pt  pt-icon-arrow-down"></i>{{info.projectCountHavingPriceLessThanLocAvg}}</span>\n        </div>\n        <div class="pt_col-3-18 ta-right">\n            <button class="btn small-btn btn-default toggleBtn"\n                    analytics-on\n                    data-analytics-event="Click_Details_Builder Search"\n                    data-analytics-category="Builder Analysis"\n                    data-analytics-label="{{expanded ? \'View details\' : \'Hide details\'}}"\n                    data-ng-click=\'toggle()\'\n                    tooltip="{{expanded ? \'Hide details\' : \'View details\'}}">\n                <i class="fa" data-ng-class="{\'pt-icon-caret-down\':!expanded, \'pt-icon-caret-up\':expanded}" ></i>\n            </button>\n            <span ><a href="/analysis/builder/{{info.builderId}}"\n                      analytics-on\n                      data-analytics-event="Click_Analyse"\n                      data-analytics-category="Builder Analysis"\n                      data-analytics-label="Builder Id: {{info.builderId}}"\n                      class="btn btn-primary small-btn"> Analyse </a></span>\n            <span pt-alv-download-data builder-id="info.builderId"></span>\n        </div>\n    </div>\n    <div class="builder-slideDown">\n        <div class="pt_row" data-ng-if=\'trendInfoCalled && !trendInfoFetched\'>\n            <div class="pt_col-4-18 ta-right">\n                <i class="pt  pt-icon-spinner pt-icon-spin"></i>    \n            </div>\n        </div>\n\n    	<div class="pt_row" data-ng-repeat=\'(status, data) in info.trendData\' data-ng-if=\'trendInfoFetched\'>\n            <div class="pt_col-4-18">&nbsp</div>\n            <div class="pt_col-2-18 ta-center">\n            	{{status}}\n            </div>\n            <div class="pt_col-1-18 ta-center">\n                <span data-ng-repeat = "option in data[0].extraAttributes.projectCountSet.options">\n                    <span data-ng-if="option.selected">\n    					<span class="t-deco" data-ng-if="data[0].extraAttributes[option.key]" data-ng-click="builderProjectsModal({\'status\' : status})"><a>{{data[0].extraAttributes[option.key] | number | figureFMT}}<span data-ng-if="option.key == \'size\'"> sq ft</span></a></span>\n    					<span data-ng-if="!data[0].extraAttributes[option.key]">NA</span>\n                    </span>\n                </span>\n            </div>\n            <div class="pt_col-2-18 ta-center" >\n                <span tooltip="{{data[0].extraAttributes.minMaxPriceHtmlHover}}" once-html="data[0].extraAttributes.minMaxPriceHtml"></span>\n                \n            </div>\n            <div class="pt_col-2-18 ta-center">\n            	{{data[0].extraAttributes.soldPercentage | round}}<span data-ng-if="data[0].extraAttributes.soldPercentage !== \'NA\'">%</span>\n            </div>\n		</div>\n\n        <div class="pt_row" data-ng-if=\'info.trendData || trendInfoReceived\'>\n            <div class="pt_col-4-18">&nbsp</div>\n            <div class="pt_col-2-18 ta-center">\n                Delayed\n            </div>\n            <div class="pt_col-1-18 text-center t-deco" data-ng-click="builderProjectsModal({\'delayed\' : true})">\n                <a>{{info.delayed.selected}}</a>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("parsers/builderParser",["app","services/globalService"],function(a){a.factory("BuilderParser",["GlobalService","$filter",function(a,b){var c=function(a){var b=a,c=["on hold","cancelled","not launched","occupied","ready for possession","completed"];if(b.onGoingProjects=0,b.totalProjects=0,b.experience=0,b.establishedDate){var d=new Date(b.establishedDate),e=new Date;b.experience=e.getFullYear()-d.getFullYear()}if(b.experience=b.experience?b.experience+" Years":"",b.projectCountByCity&&(b.projectCountByCityString="",b.cities=[],_.each(b.projectCountByCity,function(a,c){b.projectCountByCityString+=c.substring(0,1).toUpperCase()+c.substring(1)+"("+a+"), ",b.cities.push(c.substring(0,1).toUpperCase()+c.substring(1))}),b.projectCountByCityString=b.projectCountByCityString.replace(/\,+$/,"")),b.projectStatusCount)for(var f in b.projectStatusCount)b.projectStatusCount[f]&&(-1===c.indexOf(f)&&(b.onGoingProjects+=b.projectStatusCount[f]),b.totalProjects+=b.projectStatusCount[f]);return b},d=function(b,c){var d=a.getHomeCity();c||(c=4);for(var e=[],f=0;f<b.length&&c>f;f++)e.push({id:b[f].id,propertyId:b[f].id,name:b[f].name,url:b[f].url,imageUrl:b[f].imageURL,citySpecUrl:d&&d.label?d.label.replace(" ","-").toLowerCase()+"/"+b[f].url:""});return e};return{parsePopular:d,parseBuilder:c}}])}),define("text!views/directives/b2b/builderSearch/builder-detail.html",[],function(){return'<div class="dropdown-menu dd-list">\n    <div pt-loading-block data-ng-if="builder.called && !builder.loaded"></div>\n    <div data-ng-if="builder.loaded">\n        <div class="img-wrap">\n            <img alt="" data-ng-src="{{builder.data.imageURL}}" />\n        </div>\n        <ul class="builder-info">\n            <li>\n                <h4 class="bldr-name">{{builder.data.name}}</h4>\n                <p>{{builder.data.builderAddress}}</p>\n            </li>\n            <li class="website" data-ng-if="builder.data.builderWebsite">\n                <h5>Website</h5>\n                <p>\n				 <a href="//{{builder.data.builderWebsite}}" target="_blank" title="" >{{builder.data.builderWebsite}}</a>\n                </p>\n            </li>\n            <li class="cities">\n                <h5>Cities</h5>\n                <p>{{builder.data.projectCountByCityString}}</p>\n            </li>\n            <li class="xprnc">\n                <h5>Experience</h5>\n                <p>{{builder.data.experience}}</p>\n            </li>\n            <li class="avg-time">\n                <h5>Avg. project completion time</h5>\n                <p>{{builder.data.avgCompletionTimeMonths}} Months</p>\n            </li>\n            <li class="clearfix">\n                <h5>Info</h5>\n                <p data-ng-bind-html="builder.data.description"></p>\n            </li>\n        </ul>\n    </div>\n</div>\n'}),define("directives/b2b/builderSearch/builder-detail",["app","text!views/directives/b2b/builderSearch/builder-detail.html","directives/common/pt-loading-block"],function(a,b){a.directive("builderDetail",[function(){return{replace:!0,scope:{builder:"="},template:b}}])}),define("text!views/directives/b2b/maps/downloadAlvData.html",[],function(){return'<div class="pull-right relativePostion" data-ng-click="downloadAlvList()">\n	<a class="inblk" tooltip="{{tooltip}}">\n		<i class="pt pt-icon-arrow-circle-down"></i>\n	</a>\n</div>'}),define("directives/b2b/maps/downloadAlvData",["app","text!views/directives/b2b/maps/downloadAlvData.html"],function(a,b){a.directive("ptAlvDownloadData",["$modal",function(a){return{restrict:"AE",template:b,scope:{builderId:"="},link:function(b,c,d){b.builderId?b.tooltip="Download builder's project data.":b.tooltip="Download the data of selected projects.",b.downloadAlvList=function(){a.open({backdrop:"static",templateUrl:"views/directives/b2b/modal/download-catchment-listing.html",controller:["$scope","$modalInstance","$rootScope",function(a,c,d){b.builderId?a.title="Download Builder Information":a.title="Download Catchment Information",a.listing={},a.listing.fromDate=new Date,a.listing.toDate=new Date,a.msg="",a.disableDownload=!1,a.aggregated,a.setAggregated=function(){$("#aggregatedCheckbox").prop("checked")?a.aggregated=!0:a.aggregated=void 0},a.cancel=function(){h()},a.validateAndProcess=function(){var c=(a.listing.fromDate,a.listing.toDate,i());return c?void(a.msg=c):void d.$broadcast("alvDownloadDataValid",{fromDate:a.listing.fromDate,toDate:a.listing.toDate,builderId:b.builderId,aggregated:a.aggregated})};var e=a.$on("alvDownloadDataValidationError",function(b,c){a.msg=c,a.disableDownload=!1}),f=a.$on("dismissAlvDownloadDataModal",function(a){h()}),g=a.$on("disableDownloadButton",function(b,c){a.disableDownload=c}),h=function(){a.disableDownload=!1,e(),f(),g(),c.dismiss("cancel")},i=function(){var b=a.listing.fromDate,c=a.listing.toDate;return b&&c?angular.isDate(b)&&angular.isDate(c)?b>c?"Please ensure the From Date is of earlier duration than the To Date":c>new Date?"Please choose a date before today's date":void 0:"Please provide a valid Date":"Please provide valid Date"}}]})}}}}])}),define("text!views/directives/b2b/builderSearch/pt-project-listing.html",[],function(){return'<div class="pt-scroll">\n	<div class="view-all-wrapper v-projs" id="projDiv">\n        <span grid-head units=\'headerUnits\' sort=\'sort\'></span>\n        <div class="pt_row body" data-ng-repeat="proj in projects">\n            <div class="pt_col-2-9">\n                <a href="/phase-detail?projectId={{proj.projectId}}" target="_blank">\n                    <span class="put-ellipsis w85" once-text="proj.projectName" tooltip="{{proj.projectName}}" tooltip-placement="right"></span>\n                </a>\n            </div>\n            <div class="pt_col-1-12" once-text="proj.cityName"></div>\n            <div class="pt_col-1-12 put-ellipsis w85" once-text="proj.localityName" tooltip="{{proj.localityName}}"></div>\n            <div class="pt_col-1-12" once-text="proj.constructionStatus"></div>\n            <div class="pt_col-1-12" ><i class="pt-icon-{{proj.unitType | lowercase}}" once-title="proj.unitType"></i></div>\n            <div class="pt_col-1-12" tooltip="{{proj.displayPriceunitsHtmlHover}}" once-html="proj.displayPriceunitsHtml"></div>\n            <!-- <div class="pt_col-1-12" tooltip="{{proj.wavgPricePerUnitAreaOnLtdSupply}}" once-html="proj.wavgPricePerUnitAreaOnLtdSupply"></div> -->\n            <div class="pt_col-1-12" tooltip="{{proj.sumLtdLaunchedUnitHover}}" once-text="proj.sumLtdLaunchedUnitText"></div>\n            <div class="pt_col-1-12" tooltip="{{proj.totalSoldHover}}" once-text="proj.totalSold"></div>\n            <div class="pt_col-1-12" once-text="proj.launchDate"></div>\n            <div class="pt_col-1-12" once-text="proj.completionDate"></div>\n        </div>\n    </div>\n</div>'}),define("directives/b2b/builderSearch/pt-project-listing",["app","text!views/directives/b2b/builderSearch/pt-project-listing.html","directives/b2b/builderSearch/grid-head"],function(a,b){a.directive("ptProjectListing",[function(){return{restrict:"AE",scope:{sort:"=",projects:"=",headerUnits:"="},template:b,link:function(a){}}}])}),define("directives/b2b/builderSearch/builder-base-info",["app","text!views/directives/b2b/builderSearch/base-info.html","parsers/builderParser","services/b2b/BuilderService","services/b2b-constants","services/b2b/dataService","directives/b2b/builderSearch/grid-head","directives/b2b/builderSearch/builder-detail","directives/b2b/maps/downloadAlvData","directives/b2b/builderSearch/pt-project-listing"],function(a,b){a.directive("builderBaseInfo",["B2BBuilderService","BuilderParser","B2BConstants","$filter","$modal","DataService","Formatter","DownloadService","$rootScope","CityService",function(a,c,d,e,f,g,h,i,j,k){return{scope:{info:"="},template:b,link:function(b,h){var i={};b.detail=i;var j=e("priceFormat");b.info.cityId?k.getMainCities().then(function(a){var c=k.cityIdAndNameMapping(a.data);b.info.cityName=c[b.info.cityId].label}):b.info.cityName="",b.toggle=function(){b.expanded?h.find(".builder-slideDown").slideUp("fast"):(b.trendInfoCalled||(a.getSpecificTrend(b.info.builderId,b.info.cityId,b.info.preferenceFilters).then(function(a){var c=a[b.info.builderId];for(var d in c){var e=c[d][0].extraAttributes;e.sumLtdSupply&&(e.soldPercentage=(100*(e.sumLtdSupply-e.sumInventory)/e.sumLtdSupply).toFixed(2)),isNaN(e.soldPercentage)&&(e.soldPercentage=0),e.minMaxPriceHtmlHover="",e.soldPercentage&&e.minPricePerUnitArea&&e.maxPricePerUnitArea?e.minMaxPriceHtml='<i class="pt pt-icon-inr"></i>'+j(e.minPricePerUnitArea,void 0,void 0,void 0,-1)+' - <i class="pt pt-icon-inr"></i>'+j(e.maxPricePerUnitArea,void 0,void 0,void 0,-1):0==e.maxPricePerUnitArea&&0==e.minPricePerUnitArea?e.minMaxPriceHtml="Sold out":(e.minMaxPriceHtmlHover="Coming soon",e.minMaxPriceHtml="NA"),e.wavgSizeOnLtdSupply&&e.sumLtdSupply&&(e.size=e.wavgSizeOnLtdSupply*e.sumLtdSupply,e.size=e.size.toFixed(0)),e.projectCountSet={key:"projectCountSet",options:[{parentKey:"projectCount",key:"countDistinctProjectId"},{key:"sumLtdLaunchedUnit",parentKey:"launchedUnit"},{key:"size",parentKey:"totalArea"}],selected:function(a){return _.find(a,function(a){return a.selected})}};var f=b.info.projectCountSet,g=f.selected(f.options),h=_.find(e.projectCountSet.options,function(a){return a.parentKey==g.key});h.selected=!0}b.info.trendData=c,b.trendInfoFetched=!0}),b.trendInfoCalled=!0),h.find(".builder-slideDown").slideDown("fast")),b.expanded=!b.expanded},b.getBuilderDetail=function(){if(!i.called){var e=function(a){i.data=c.parseBuilder(a),i.loaded=!0};a.getBuilderCardInfo(b.info.builderId,d.BUILDER_API.FIELDS,e),i.called=!0}},b.builderProjectsModal=function(a){var c=b.info.builderId,d=b.info.cityId,h=b.info.preferenceFilters;a=a||{},f.open({templateUrl:"views/directives/b2b/modal/builder-projects-listing.html",windowClass:"builder-model",controller:["$scope","$modalInstance",function(b,f){b.headerUnits=[{label:"Project",key:"projectName",sortable:!0,"class":"pt_col-2-9 ta-left"},{label:"City",key:"cityName",sortable:!0,"class":"pt_col-1-12  ta-center"},{label:"Locality",key:"localityName",sortable:!0,"class":"pt_col-1-12  ta-center"},{label:"Status",key:"constructionStatus",sortable:!0,"class":"pt_col-1-12  ta-center"},{label:"Type","class":"pt_col-1-12  ta-center"},{label:"Rate",key:"wavgPricePerUnitAreaOnLtdSupply",sortable:!0,isPricePerUnitArea:!0,"class":"pt_col-1-12  ta-center"},{label:"Units Launched","class":"pt_col-1-12  ta-center"},{label:"Total Sold(%)","class":"pt_col-1-12  ta-center"},{label:"Launch Date",key:"launchDateTstamp",sortable:!0,"class":"pt_col-1-12  ta-center"},{label:"Completion Date",key:"completionDateTstamp",sortable:!0,"class":"pt_col-1-12  ta-center"}],b.sort=function(a){var c,d,e=a.options?a.selected(a.options):a;d=b.headerUnits,a.sortable&&(_.each(d,function(b){b!=a&&void 0!=b.sortOrder&&(b.sortOrder=void 0)}),c=_.sortBy(b.projects,function(a){return a[e.key]}),e.sortOrder&&"ASC"==e.sortOrder?(b.projects=c.reverse(),e.sortOrder="DESC"):(b.projects=c,e.sortOrder="ASC"))},b.cancel=function(){f.dismiss("cancel")};var i=function(a){var b=[];return a.builderId&&(b[0]="builderId=="+a.builderId),a.cityId&&(b[0]+=";cityId=="+a.cityId),a.unitType&&(b[0]+=";("+a.unitType+")"),a.constructionStatus&&(b[0]+=";(constructionStatus=="+a.constructionStatus+")"),a.delayed&&(b[0]+=";(completionDelayInMonth=ge=6)"),b[1]="&fields="+a.fields.join(","),b[2]="&group="+a.group,b.join("")},k={builderId:c,cityId:d,unitType:h,fields:"bedrooms,sumLtdLaunchedUnit,sumInventory,wavgPricePerUnitAreaOnLtdSupply,wavgSecondaryPricePerUnitAreaOnLtdSupply,projectName,builderName,unitType,constructionStatus,completionDate,launchDate,cityName,localityName".split(","),group:"projectId",constructionStatus:a.status,delayed:a.delayed},l=function(a){var b=[],c=e("dateFormat"),d=e("formatGraphPriceHover"),f=e("formatGraphPrice"),g=e("formatSoldPercentage"),h=e("formatSoldPercentageHover");return _.each(a.data,function(a,e){var i=a[0].extraAttributes,k=a[0];i.sumLtdLaunchedUnit&&(k.totalSold=Math.round((i.sumLtdLaunchedUnit-i.sumInventory)/i.sumLtdLaunchedUnit*100)),k.totalSold=g(k.totalSold,i.sumInventory,k.constructionStatus),k.totalSoldHover=h(k.totalSold,i.sumInventory,k.constructionStatus),k.displayPriceunitsHtml=f(i.wavgPricePerUnitAreaOnLtdSupply,i.sumInventory,k.constructionStatus,i.wavgSecondaryPricePerUnitAreaOnLtdSupply),isNaN(k.displayPriceunitsHtml)||(i.wavgPricePerUnitAreaOnLtdSupply?k.displayPriceunitsHtml=j(k.displayPriceunitsHtml,void 0,void 0,void 0,-1):k.displayPriceunitsHtml=j(k.displayPriceunitsHtml,void 0,void 0,void 0,-1)+" (R)"),b.push({projectId:k.projectId,projectName:k.builderName+" "+k.projectName,constructionStatus:k.constructionStatus,launchDate:c(k.launchDate),launchDateTstamp:k.launchDate,completionDate:c(k.completionDate),completionDateTstamp:k.completionDate,unitType:k.unitType,wavgPricePerUnitAreaOnLtdSupply:i.wavgPricePerUnitAreaOnLtdSupply,wavgSecondaryPricePerUnitAreaOnLtdSupply:i.wavgSecondaryPricePerUnitAreaOnLtdSupply,sumInventory:i.sumInventory,sumLtdLaunchedUnit:i.sumLtdLaunchedUnit,displayPriceunitsHtmlHover:d(i.wavgPricePerUnitAreaOnLtdSupply,i.sumInventory,k.constructionStatus,k.wavgSecondaryPricePerUnitAreaOnLtdSupply),displayPriceunitsHtml:k.displayPriceunitsHtml,sumLtdLaunchedUnitText:i.sumLtdLaunchedUnit?i.sumLtdLaunchedUnit:"NA",sumLtdLaunchedUnitHover:i.sumLtdLaunchedUnit?"":"Coming Soon",totalSold:k.totalSold,totalSoldHover:k.totalSoldHover,cityName:k.cityName,localityName:k.localityName})}),b},m=i(k);g.trendCurrent(m,function(a){b.projects=l(a)})}]})}}}}])}),define("controllers/b2b/builderSearchCtrl.33a43b0a",["app","services/b2b/BuilderService","services/citiesService","services/b2b/dataService","directives/b2b/builderSearch/grid-head","directives/common/pt-loading-block","services/b2b/DownloadService","directives/b2b/builderSearch/builder-base-info"],function(a){a.controller("builderSearchCtrl",["$scope","$rootScope","B2BBuilderService","$location","$stateParams","CityService","$filter","DownloadService","GoogleAnalyticsService",function(a,b,c,d,e,f,g,h,i){var j=[{unitType:b.userDetails.preference.preference.unitType}],k=[{label:"Builder Name",key:"builderName","class":"pt_col-2-18 ta-center lft-p5",sortable:!0},{label:"City",key:"cityName",sortable:!0,"class":"pt_col-2-18 ta-center"},{label:"Headquarter",key:"builderHeadquarterCity",sortable:!0,"class":"pt_col-2-18 ta-center"},{sortable:!0,key:"projectCountSet","class":"pt_col-1-18 ta-center",options:[{label:"Total Area",key:"totalArea"},{label:"No. of Units",key:"launchedUnit"},{label:"No. of Projects",selected:!0,key:"projectCount"}],selected:function(a){return _.find(a,function(a){return a.selected})}},{label:"Rate Range","class":"pt_col-2-18 ta-center"},{sortable:!0,label:"% Sold",key:"soldPercentage","class":"pt_col-2-18 ta-center"},{label:"Type","class":"pt_col-1-18 ta-center"},{label:"Price Movement",helpText:"No. of projects with positive / negative price movements in last 6 months","class":"pt_col-1-18 ta-center"},{label:"Rate Comparison",helpText:"No. of projects higher or lower than their locality price average","class":"pt_col-2-18 ta-center"},{label:" ","class":"pt_col-3-18 ta-center"}],l=g("priceFormat");a.headerUnits=k;var m=[];_.each(k,function(a){m.push({unit:a})});var n=[],o=function(){var a=_.pluck(n,"id"),b=[];return angular.forEach(a,function(a){(""+a).match("TYPEAHEAD-BUILDERCITY-")?b.push(""+a.replace("TYPEAHEAD-BUILDERCITY-","")):(""+a).match("TYPEAHEAD-BUILDER-")?b.push(""+a.replace("TYPEAHEAD-BUILDER-","")):b.push(""+a)}),b},p=function(){a.Builders.length?d.search({ids:o().join()}):d.search({})},q=function(a){var b="";return _.each(a,function(a){var c=_.keys(a)[0];_.each(a[c],function(d,e){b+=c+"=="+d,e!=a[c].length-1&&(b+=",")})}),b},r=function(b){if(b.info){b.info.preferenceFilters=q(j),void 0!=b.info.delayed&&b.info.delayed.wavgSizeOnLtdSupply&&b.info.delayed.supply&&(b.info.delayed.totalArea=b.info.delayed.wavgSizeOnLtdSupply*b.info.delayed.supply+" sq ft"),b.info.supply&&(b.info.soldPercentage=(100*(b.info.supply-b.info.inventory)/b.info.supply).toFixed(2)),isNaN(b.info.soldPercentage)&&(b.info.soldPercentage=0),b.info.minMaxPriceHtmlHover="",b.info.soldPercentage&&b.info.minPricePerUnitArea&&b.info.maxPricePerUnitArea?b.info.minMaxPriceHtml='<i class="pt pt-icon-inr"></i>'+l(b.info.minPricePerUnitArea,void 0,void 0,void 0,-1)+' - <i class="pt pt-icon-inr"></i>'+l(b.info.maxPricePerUnitArea,void 0,void 0,void 0,-1):0==b.info.maxPricePerUnitArea&&0==b.info.minPricePerUnitArea?b.info.minMaxPriceHtml="Sold out":(b.info.minMaxPriceHtmlHover="Coming soon",b.info.minMaxPriceHtml="NA"),b.info.projectCountSet={key:"projectCountSet",options:[{key:"projectCount",selected:!0},{key:"launchedUnit"},{key:"totalArea"}],selected:function(a){return _.find(a,function(a){return a.selected})},setSelected:function(a,b){var c=_.find(a,function(a){return a.key==b}),d=_.find(a,function(a){return a.selected});d&&(d.selected=!1),c&&(c.selected=!0)}};var c=_.find(a.headerUnits,function(a){return"projectCountSet"==a.key}),d=c.selected(c.options),e=b.info.projectCountSet;e.setSelected(e.options,d.key),b.info.delayed&&(b.info.delayed.selected=b.info.delayed[d.key])}};a.updateTable=function(a,b){var c=a.key;_.each(n,function(a){var d,e,f=a.info[c];d=f.selected(f.options),d&&(d.selected=!1),e=_.find(f.options,function(a){return a.key==b.key}),e&&(e.selected=!0),a.info.delayed.selected=a.info.delayed[e.key];var g=a.info.trendData;if(g)for(var h in g){var f=g[h][0].extraAttributes.projectCountSet;d=f.selected(f.options),d&&(d.selected=!1),e=_.find(f.options,function(a){return a.parentKey==b.key}),e&&(e.selected=!0)}})},f.getMainCities().then(function(b){a.cities=b.data;var c=f.getCityForSingleCityUserAccess(a.cities);c&&a.selectCity(c.label)});var s=[];if(e.ids){var t=_.uniq(e.ids.split(","));angular.forEach(t,function(a){var b=a.split("-"),c={builderId:b[0],cityId:b[1]||""};s.push(c)}),c.getBuilderTrend(s,q(j)).then(function(a){for(var b in a){var c={id:a[b].builderId,displayText:a[b].builderName};c.info=a[b],r(c),n.push(c)}})}a.Builders=n,a.BuildersError="",a.getBuilders=function(a,b){return c.getBuilders(a,b);
},a.clearAll=function(){a.BuildersError="",a.Builders=n=[],p()},a.addBuilder=function(b){var d=[],e={builderId:"",cityId:""};i.gaEventSearchBuilder(b),a.builderLoad=!0,a.bsSelectedCity?(e.builderId=b.builderId,e.cityId=b.entityId):e.builderId=b.id.replace("TYPEAHEAD-BUILDER-",""),d.push(e),c.getBuilderTrend(d,q(j)).then(function(c){a.builderLoad=!1,c&&c[0]?(a.BuildersError="",a.Builders.push(b),b.info=c[0],r(b),p()):a.BuildersError="Builder Information not available"}),a.searchedBuilder=void 0},a.removeBuilder=function(b){a.Builders.splice(a.Builders.indexOf(b),1),p()},a.selectCity=function(b){a.bsSelectedCity=b},a.sort=function(b){var c,d,e=b.options?b.selected(b.options):b;if(b.sortable){_.each(k,function(a){a!=b&&void 0!=a.sortOrder&&(a.sortOrder=void 0),_.each(a.options,function(a){a!=e&&void 0!=a.sortOrder&&(a.sortOrder=void 0)})}),c=e.sortOrder,d=e.key;var f=_.sortBy(a.Builders,function(a){return a.info[e.key]});e.sortOrder&&"ASC"==e.sortOrder?(a.Builders=f.reverse(),e.sortOrder="DESC"):(a.Builders=f,e.sortOrder="ASC")}},a.$on("alvDownloadDataValid",function(a,d){c.getTrendList(d.builderId,q(j),["projectId"],["projectId"]).then(function(a){var c=a&&a.length;return c?(d.projectIds=_.pluck(a,"projectId"),b.$broadcast("disableDownloadButton",!0),void h.getCatchmentInfoFileName(d).then(function(a){var a=a.data;return a&&a.statusCode&&"2"===a.statusCode.substring(0,1)?(h.getCatchmentInfoFile(a.data),void b.$broadcast("dismissAlvDownloadDataModal")):void(a&&a.statusCode&&"5"!==a.statusCode.substring(0,1)&&a.error&&a.error.msg?b.$broadcast("alvDownloadDataValidationError",a.error.msg):b.$broadcast("alvDownloadDataValidationError","There was an error while processing your request. Please try again later."))})):void b.$broadcast("alvDownloadDataValidationError","There are no projects to download data.")})})}])});