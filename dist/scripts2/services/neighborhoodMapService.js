define(["require","app","parsers/projectParser"],function(a,b,c){b.factory("neighborhoodMapService",["$modal","ProjectParser",function(b,c){var d=[],e={flag:!1},f=function(f,g){var h;h="project"===f.type?c.parseProject(f,!1):f,e.flag=!0,a(["utils/mapNeighbourhoodScript"],function(){var a=b.open({templateUrl:"views/modal/neighborhoodMap.html",windowClass:"modalGallery",controller:["$scope","$modalInstance","$rootScope","$timeout","markerFactory",function(a,b,c,e,i){var j=function(a,b){b&&b()};d&&d.length&&$.each(d,j),a.data=h,a.mapUrl=g,d=[],a.sharedObj={};var k=a.$on("amenityClickedComplete",function(a,b){c.$broadcast("addNeighbourhood",b)});d.push(k);var l=a.$on("readyToDrawNeighbourhoodMarkers",function(a,b){c.$broadcast("drawNeighbourhoodMarkers",b)});d.push(l);var m=a.$on("amenityClicked",function(a,b){c.$broadcast("removeNeighbourhood",{types:b.type,level:b.level})});d.push(m);var n=a.$on("mapZoomIn",function(){c.$broadcast("mapZoomin")});d.push(n);var o=a.$on("mapZoomOut",function(){c.$broadcast("mapZoomout")});d.push(o);var p=new i.marker("project",a.data);e(function(){c.$broadcast("mapResize"),c.$broadcast("setDefaultZoomLevel",13),c.$broadcast("addActiveProjectMarker",p),c.$broadcast("showNearbyAmenities",{latitude:f.latitude,longitude:f.longitude,projectId:f.projectId})},0),e(function(){c.$broadcast("updateCenter",{lat:f.latitude,lng:f.longitude}),c.$broadcast("activateFirstAmenity")},1e3),a.cancel=function(){b.dismiss("cancel")},a.tracking=function(a,b,c){},a.exploreTracking=function(){},a.tracking("searchMap","clicked","Search on Map Clicked")}]});a.opened.then(function(){e.flag=!1})})};return{openNeighborhoodMapModal:f,disableButton:e}}])});