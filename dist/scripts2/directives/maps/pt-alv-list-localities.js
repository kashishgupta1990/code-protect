define(["app","text!views/directives/maps/pt-alv-list-localities.html","directives/maps/pt-alv-listitem-locality","services/pageSettings"],function(a,b,c){a.directive("ptAlvListLocality",["$parse","$rootScope","pageSettings","$timeout","$filter",function(a,c,d,e,f){return{restrict:"EA",scope:{},template:b,link:function(a,b){var g=[];a.localities=a.localities||[],a.projectCount=0,a.perPageItem=d.defaultSettings.perPageCount||20;var h={relevance:"",projectLivabilityScore:"-livabilityScore",minResaleOrPrimaryPrice:void 0,possessionDate:void 0};a.alvSortOptions=[{key:"",label:"Sort by Popularity"},{key:"label",label:"Sort A to Z"},{key:"orgAvgPricePerUnitArea",label:"Sort by Rate (Low to High)"},{key:"-orgAvgPricePerUnitArea",label:"Sort by Rate (High to Low)"},{key:"-projectCount",label:"Sort by Count of Projects"},{key:"-livabilityScore",label:"Sort by Livability (High to Low)"}],a.alvSortingValue="",a.$on("$destroy",function(){g=void 0,b.remove()}),a.sortResults=function(){var b={label:"AToZ",orgAvgPricePerUnitArea:"PriceLowToHigh","-orgAvgPricePerUnitArea":"PriceHighToLow","-projectCount":"projectCount","-livabilityScore":"projectLivabilityScore","":"relevance"};if("orgAvgPricePerUnitArea"==a.alvSortingValue||"-orgAvgPricePerUnitArea"==a.alvSortingValue){var c=f("filter")(a.localities,{orgAvgPricePerUnitArea:"!"});a.localities=f("orderBy")(g,a.alvSortingValue),a.localities=f("filter")(a.localities,{orgAvgPricePerUnitArea:"!!"}),a.localities=a.localities.concat(c)}else a.alvSortingValue?a.localities=f("orderBy")(g,a.alvSortingValue):a.localities=g;"undefined"!=typeof a.alvSortingValue&&b[a.alvSortingValue]},a.$on("showAlvListItemLocality",function(b,d){g=angular.copy(d.localities),a.localities=d.localities,a.projectCount=d.projectCount,d.sortBy&&h[d.sortBy]&&(a.alvSortingValue=h[d.sortBy],a.sortResults()),c.$broadcast("updateScroll")}),a.$on("info:scrollUpdate",function(){a.localities.length>a.perPageItem&&(a.perPageItem+=d.defaultSettings.perPageCount,c.$broadcast("updateScroll",{dontScrollToTop:!0}),e(function(){a.$apply()},0))})}}}])});